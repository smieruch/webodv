var p01_count=0;var l04_terms={water:true,sediment:true,biota:true};var this_collection_is="";var eutro_hidden_vars=[];var removed_top_level_nodes=[];if(dev_pass_server=="1"){var remove_top_level_nodes=false}else{var remove_top_level_nodes=true}$(document).ready(function(){$.each(l04_terms,function(i,e){if(collectionName.includes(i)){this_collection_is=i;return true}});var treeview_worker;var treeview_worker_path=window.location.protocol+"//"+window.location.hostname+http_port+"/js/webodv/";function startWorker(){if(typeof Worker!=="undefined"){if(typeof treeview_worker=="undefined"){treeview_worker=new Worker(treeview_worker_path+"treeview_worker.js")}treeview_worker.onmessage=function(event){}}else{}}function stopWorker(){treeview_worker.terminate();treeview_worker=undefined}if(contaminants==true&&project=="EMODnet Chemistry"){$("#set_x_var,#set_y_var").on("rendered.bs.select",function(){$(this).next("button").removeAttr("title")})}window.treeview_emodnet_contaminants_connect=function(){treeview_emodnet_contaminants_connect_go=false;if(localStorage.getItem(storage_name)!==null){Xstatus=JSON.parse(localStorage.getItem(storage_name));if(contaminants==true&&project=="EMODnet Chemistry"){p01_count=0;$.each(W_get_collection_information.datavar_comments,function(i,e){var p01_code=e.match(/(?<=P01::).*(?= SDN:P06)/g);var treeview_tool_tip=$(treeview_vars_id).find("input[data-id="+p01_code[0]+"]").parent("label").attr("data-original-title");p01_list[p01_code[0]]={p01:p01_code[0],num:i+1,avail:false,tooltip:treeview_tool_tip};p01_num[i+1]=p01_code});webodv_status[storage_name]["p01_num"]=p01_num;webodv_status[storage_name]["p01_list"]=p01_list;localStorage.setItem(storage_name,JSON.stringify(webodv_status[storage_name]));if(remove_top_level_nodes){var top_level_nodes=$(treeview_vars_id).children("li").children("label");$.each(top_level_nodes,function(i,e){var top_level_text=$(this).text();var l04_includes=false;$.each(l04_terms,function(i,e){if(top_level_text.includes(i)){l04_includes=true}});if(l04_includes==false){var p01s_below=$(this).parent("li").find("input:checkbox.hummingbird-end-node");$.each(p01s_below,function(i,e){if(typeof p01_list[$(this).attr("data-id")]!="undefined"){removed_top_level_nodes.push(p01_list[$(this).attr("data-id")].num)}})}if($(this).text().includes(this_collection_is)==false){$(this).parent("li").remove()}})}else{$(".bg-center").css("background-color","#97d097").children("div.emodnet-func-dark-blue").prepend("<div><h3>Development mode</h3></div>");var treeview_labels=$(treeview_vars_id).find("label");$.each(treeview_labels,function(i,e){var this_data_vocab=$(this).attr("data-vocab");var this_input=$(this).children("input");$(this).after('<span style="color:red;">'+this_data_vocab+"</span>")});$(treeview_vars_id).hummingbird()}var end_nodes=$(treeview_vars_id).find("input:checkbox.hummingbird-end-node");$.each(end_nodes,function(i,e){var end_nodes_data_id=$(this).attr("data-id");var end_nodes_li=$(this).parent("label").parent("li");if(contaminants==true&&project=="EMODnet Chemistry"){if(typeof p01_list[end_nodes_data_id]=="undefined"){end_nodes_li.remove()}else{p01_count++}}});$(".num_variables_total").text(p01_count);localStorage.setItem(storage_name,JSON.stringify(webodv_status[storage_name]));remove_childless_tree_nodes();if(typeof Xstatus.OutVar=="undefined"){treeview_default()}$(treeview_vars_id).trigger("CheckUncheckDone");var final_top_level_node=$(treeview_vars_id).children("li").children("label").children("input").attr("id");$(treeview_vars_id).hummingbird("expandNode",{attr:"id",name:final_top_level_node})}}set_window_height()};window.treeview_data_available=function(){var n=0;var ns="";var ms="";var OutVar=webodv_status[storage_name]["OutVar"];if(typeof OutVar!="undefined"){if(OutVar.length==0){use_all_vars=true}else{use_all_vars=false}}else{use_all_vars=true}var all_checkboxes=$(treeview_vars_id).find("input:checkbox:disabled");all_checkboxes.prop("indeterminate",false).prop("disabled",false).css({cursor:"pointer"}).parent("label").css({cursor:"pointer",color:"rgb(1,46,88)"});var treeview_data_ids=$(treeview_vars_id).find("input:checkbox.hummingbird-end-node");var anz=0;var n=0;var ns="";var change_node_mode="";$.each(treeview_data_ids,function(i){if(typeof mandatory_output_vars[ns]=="undefined"){}var that_data_id=$(this).attr("data-id");if(contaminants==true&&project=="EMODnet Chemistry"){that_data_id=p01_list[that_data_id].num.toString()}var ex=that_data_id.split("|");var exLength=ex.length;var one_enable=false;$.each(ex,function(f,g){n=Number(g)-1;ns=n.toString();anz=W_get_data_availability_information.station_set[n];if(anz=="-"){change_node_mode="disableNode"}else{change_node_mode="enableNode";one_enable=true}});if(one_enable){change_node_mode="enableNode"}if(change_node_mode=="disableNode"){$(this).prop("checked",false).prop("disabled",true).css({cursor:"not-allowed"}).parent("label").css({color:"#c8c8c8",cursor:"not-allowed","background-color":""})}if(use_all_vars==true){if(anz!="-"){if(contaminants==true&&project=="EMODnet Chemistry"){var_x_dropdown=var_x_dropdown+'<option value="'+i+'">'+p01_num[n]+"</option>"}else{var_x_dropdown=var_x_dropdown+'<option value="'+i+'">'+W_get_collection_information.datavar_unames[i]+"</option>"}}}});$(treeview_vars_id).hummingbird("triState");treeview_mandatory();$(treeview_vars_id).trigger("CheckUncheckDone");if(contaminants==true&&project=="EMODnet Chemistry"){if(localStorage.getItem(storage_name)!==null){Xstatus=JSON.parse(localStorage.getItem(storage_name));if(typeof Xstatus.OutVarState!="undefined"){$(treeview_vars_id).hummingbird("restoreState",{restore_state:Xstatus.OutVarState})}}}};window.treeview_mandatory=function(){$.each(mandatory_output_vars,function(i,e){$(treeview_vars_id).hummingbird("disableNode",{attr:"data-id",name:i,state:true,disableChildren:false})})};window.treeview_default=function(){$(treeview_vars_id).hummingbird("uncheckAll");if(default_output_vars==-1){$(treeview_vars_id).hummingbird("checkAll")}else{$.each(default_output_vars,function(i,e){$(treeview_vars_id).hummingbird("checkNode",{attr:"data-id",name:e})})}};window.required_vars_restore=function(){if(localStorage.getItem(storage_name)!==null){Xstatus=JSON.parse(localStorage.getItem(storage_name));if(typeof Xstatus.ReqVarList!="undefined"){if(Xstatus.ReqVarList!=""){$.each(Xstatus.ReqVarList,function(i,e){$("#required_vars_modal").find("#treeview_requested_vars").hummingbird("checkNode",{attr:"data-id",name:'"'+e+'"',collapseChildren:false})})}}}};window.remove_childless_tree_nodes=function(){var groups=$(treeview_vars_id).find('input:checkbox:not(".hummingbird-end-node")');$.each(groups,function(i,e){var num_end_nodes=$(this).parent("label").parent("li").find("input:checkbox.hummingbird-end-node").length;if(num_end_nodes==0){$(this).parent("label").parent("li").remove()}})};window.hide_childless_tree_nodes=function(){var groups=$(treeview_vars_id).find('input:checkbox:not(".hummingbird-end-node")');$.each(groups,function(i,e){var num_end_nodes=$(this).parent("label").parent("li").find("input.hummingbird-end-node:not([type='hidden'])");if(num_end_nodes.length==0){$(treeview_vars_id).hummingbird("uncheckNode",{attr:"data-id",name:$(this).attr("data-id")});$(treeview_vars_id).hummingbird("hideNode",{attr:"data-id",name:$(this).attr("data-id")})}});if(contaminants==true&&project=="EMODnet Chemistry"){count_treeview_end_nodes(treeview_vars_id)}};get_treeview_from_server=function(){if(contaminants==true&&project=="EMODnet Chemistry"){var get_treeview_url="/contaminants/treeview/get"}else{var get_treeview_url="/"+datasetname+"/service/DataExtraction/create_treeview"}$.ajax({type:"GET",url:window.location.protocol+"//"+window.location.hostname+http_port+get_treeview_url,cache:"false",func:"get_treeview",error:function(data){},success:function(data){}})};get_treeview_from_server();$(document).ajaxComplete(function(e,xhr,settings){if(settings.func=="dev_emodnet_variables_dev"){responseText=JSON.parse(xhr.responseText);if(responseText=="true"){window.location.reload(true)}}if(settings.func=="get_treeview"){responseText=JSON.parse(xhr.responseText);var init_required_tree=true;$("#required_vars_modal").on("shown.bs.modal",function(){if(reset_clicked){$(this).find("#treeview_requested_vars").hummingbird("uncheckAll");reset_clicked=false}if(init_required_tree){init_required_tree=false;if(contaminants==true&&project=="EMODnet Chemistry"){$(this).find("#treeview_vars").attr("id","treeview_requested_vars")}else{$(this).find("#treeview_requested_vars").append(responseText)}$.fn.hummingbird.defaults.checkboxes="enabled";$.fn.hummingbird.defaults.clickGroupsToggle="disabled";$.fn.hummingbird.defaults.checkboxesGroups="disabled";$.fn.hummingbird.defaults.singleGroupOpen=-1;$.fn.hummingbird.defaults.hoverColorBg2="white";$(this).find("#treeview_requested_vars").hummingbird();$(this).find("#treeview_requested_vars").hummingbird("expandNode",{sel:"data-id",vals:["0"]});$(this).find("#treeview_requested_vars").hummingbird("search",{treeview_container:"treeview_container",search_input:"search_input",search_output:"search_output",search_button:"search_button",scrollOffset:-250,onlyEndNodes:false,dialog:".modal-dialog"});$(this).find("#treeview_requested_vars").on("CheckUncheckDone",function(){List={id:[],dataid:[],text:[]};$("#required_vars_modal").find("#treeview_requested_vars").hummingbird("getChecked",{list:List,onlyEndNodes:true});var L=List.dataid.length;if(L==1){required_vars_text=L+" variable selected"}else{required_vars_text=L+" variables selected"}webodv_status[storage_name]["ReqVarNum"]=L;localStorage.setItem(storage_name,JSON.stringify(webodv_status[storage_name]));var required_vars_list='<div class="table-responsive table_wrapper" style="overflow-y:scroll;"><table class="table table-sm table-striped table-condensed" style="white-space:nowrap;">';if(List.id!=""){$.each(List.text,function(i,e){required_vars_list=required_vars_list+'<tr class="var_name"><td>'+e+"</td></tr>"})}required_vars_list=required_vars_list+"</table></div>";$("#required_vars_modal").find(".h4_selected_variables").children("div").remove();$("#required_vars_modal").find(".h4_selected_variables").append(required_vars_list)});required_vars_restore()}});if(contaminants==true&&project=="EMODnet Chemistry"){treeview_vars_id="#treeview2_vars";treeview_container_search_div="treeview_container2"}else{$("#treeview_vars").append(responseText);treeview_vars_id="#treeview_vars";treeview_container_search_div="treeview_container_vars"}var treeview_labels=$(treeview_vars_id).find("label");$.each(treeview_labels,function(i,e){if(eutrophication){var nodes_remove=["Depth","temperature","salinity","time","Pressure"];for(var i in nodes_remove){if($(this).text().includes(nodes_remove[i])!==false){eutro_hidden_vars.push($(this).children("input").attr("data-id"));$(this).parent("li").remove()}}}var output_var_data_id=$(this).children("input").attr("data-id");output_vars_list[output_var_data_id]=$(this).text()});init_outvar_treeview();if(websocket_login){send_wsODV_msg("get_data_availability_information")}}});window.init_outvar_treeview=function(){$.fn.hummingbird.defaults.checkboxes="enabled";$.fn.hummingbird.defaults.clickGroupsToggle="disabled";$.fn.hummingbird.defaults.checkboxesGroups="enabled";$.fn.hummingbird.defaults.singleGroupOpen=-1;$(treeview_vars_id).hummingbird();window.count_treeview_end_nodes=function(the_treeview_id){var TL=$(the_treeview_id).find("input:checkbox.hummingbird-end-node").length;webodv_status[storage_name]["treeview_num_end_nodes"]=TL;localStorage.setItem(storage_name,JSON.stringify(webodv_status[storage_name]));$(".num_variables_total").text(TL)};if(contaminants==true&&project=="EMODnet Chemistry"){if(localStorage.getItem(storage_name)!==null){Xstatus=JSON.parse(localStorage.getItem(storage_name));$(".num_variables_total").text(Xstatus.treeview_num_end_nodes)}}else{count_treeview_end_nodes(treeview_vars_id)}$(treeview_vars_id).hummingbird("expandNode",{sel:"data-id",vals:["0"]});$("#collapse_all").on("click",function(){$(treeview_vars_id).hummingbird("collapseAll")});$("#expand_all").on("click",function(){$(treeview_vars_id).hummingbird("expandAll")});$("#check_all").on("click",function(){$(treeview_vars_id).hummingbird("checkAll")});$("#uncheck_all").on("click",function(){$(treeview_vars_id).hummingbird("uncheckAll")});$(treeview_vars_id).hummingbird("search",{treeview_container:treeview_container_search_div,search_input:"search_input_vars",search_output:"search_output_vars",search_button:"search_button_vars",scrollOffset:-250,onlyEndNodes:false});$(treeview_vars_id).on("CheckUncheckDone",function(){OutVarState={};$(treeview_vars_id).hummingbird("saveState",{save_state:OutVarState});webodv_status[storage_name]["OutVar"]=[];List={id:[],dataid:[],text:[]};$(treeview_vars_id).hummingbird("getChecked",{list:List,onlyEndNodes:true});var L=List.dataid.length;if(contaminants==true&&project=="EMODnet Chemistry"){if(typeof webodv_status[storage_name]["p01_list"]!="undefined"){$(".num_variables").text(L)}}else{$(".num_variables").text(L)}var p01_encoding_test="";var p01_encoding_num="";var localStorage_contaminants_exists=false;if(contaminants==true&&project=="EMODnet Chemistry"){if(localStorage.getItem(storage_name)!==null){Xstatus=JSON.parse(localStorage.getItem(storage_name));localStorage_contaminants_exists=true}}var vars_list='<div class="table-responsive table_wrapper" style="overflow-y:scroll; height:'+selected_variables_vars_height+';"><table class="table table-sm table-striped table-condensed" style="white-space:nowrap;">';if(List.id!=""){$.each(List.text,function(i,e){var te=e.trim();if(remove_top_level_nodes==false){var res=te.match(/.*(?=---)/g);te=res[0]}if(localStorage_contaminants_exists){if(typeof Xstatus.p01_list!="undefined"){p01_list=Xstatus.p01_list;p01_num=Xstatus.p01_num}if(typeof p01_list[te]!="undefined"){p01_encoding_num=p01_encoding_num+","+p01_list[te].num}vars_list=vars_list+'<tr class="var_name"><td data-toggle="tooltip" data-placement="auto" title="'+p01_list[te].tooltip+'">'+e+"</td></tr>"}else{vars_list=vars_list+'<tr class="var_name"><td>'+te+"</td></tr>"}});if(localStorage.getItem(storage_name)!==null){var p01_encoding_num_arr=p01_encoding_num.split(",");p01_encoding_num_arr.shift();if(contaminants==true&&project=="EMODnet Chemistry"){webodv_status[storage_name]["OutVar"]=p01_encoding_num_arr}else{webodv_status[storage_name]["OutVar"]=List.dataid}localStorage.setItem(storage_name,JSON.stringify(webodv_status[storage_name]))}}vars_list=vars_list+"</table></div>";$(".h4_selected_variables_vars").children("div").remove();$(".h4_selected_variables_vars").append(vars_list);var OutVarExStr=webodv_status[storage_name]["OutVar"];var OutVarEx="";var e_num=0;$.each(OutVarExStr,function(i,e){e_num=Number(e)-1;if(e_num!==primary_var_id){OutVarEx=OutVarEx+","+e_num}});OutVarEx=OutVarEx.substring(1);webodv_status[storage_name]["OutVarEx"]=OutVarEx;webodv_status[storage_name]["OutVarState"]=OutVarState;localStorage.setItem(storage_name,JSON.stringify(webodv_status[storage_name]));if(treeview_mode==0){var use_or_logic="T"}if(treeview_mode==1){var use_or_logic="F"}webodv_status[storage_name]["use_or_logic"]=use_or_logic;var view_snippet="<StationSelectionCriteria>"+'<RequiredVars var_ids="'+OutVarEx+'" use_or_logic="'+use_or_logic+'"/>'+"</StationSelectionCriteria>";var required_vars_option={view_snippet:view_snippet};if(websocket_login){send_wsODV_msg("modify_view",required_vars_option)}if(pager_num==2){var get_canvas_window_options={win_id:-1,extended_rect:false};send_wsODV_msg("get_canvas_window",get_canvas_window_options)}});if(localStorage.getItem(storage_name)!==null){Xstatus=JSON.parse(localStorage.getItem(storage_name));if(typeof Xstatus.OutVarState!="undefined"){$(treeview_vars_id).hummingbird("restoreState",{restore_state:Xstatus.OutVarState})}$(treeview_vars_id).trigger("CheckUncheckDone")}else{}init_outvar_treeview_done=true}});