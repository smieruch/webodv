"use strict";class View{constructor(t){let e,i,a,s;this.syncAxisRanges=true;this.mapWin=new MapWindow(t);this.section=new Section(t);i=$$(t,"DataWindow");this.dataWinArr=[];for(e=0;e<i.length;++e)this.dataWinArr.push(new DataWindow(i[e]));i=$$(t,"DerivedVariables");this.drvdVarArr=[];if(i.length>0){a=$$(i[0],"Variable");for(e=0;e<a.length;++e)this.drvdVarArr.push(new DrvdVar(a[e]))}this.isoVarSet=new IsoVarSet(t);i=$$(t,"PickedStations");this.pickedStatArr=[];if(i.length>0){a=$$(i[0],"Station");for(e=0;e<a.length;++e)this.pickedStatArr.push(new PickedStat(a[e]))}i=$$(t,"Canvas");if(i.length>0)this.gObjSet=new GObjectSet(i[0]);else this.gObjSet=new GObjectSet;this.statFilter=new StatFilter(t);i=$$(t,"BasicVariables");this.rangesVarIdArr=[];this.rangesMinValArr=[];this.rangesMaxValArr=[];if(i.length>0){a=$$(i[0],"Variable");for(e=0;e<a.length;++e){s=a[e].attributes;this.rangesVarIdArr.push(xmlNum(s,"var_id",-1));this.rangesMinValArr.push(xmlNum(s,"min_value",missDOUBLE));this.rangesMaxValArr.push(xmlNum(s,"max_value",largeDOUBLE))}}i=$$(t,"VariableDisplayOrder");if(i.length>0)this.varDispOrder=toNumericArray(i[0].innerHTML);else this.varDispOrder=[]}static dataVarQfSetId(t){return t<VID_FIRSTDRVD?dataVarQfSetIds[t]:0}static derivedVarType(t,e=view.drvdVarArr){let i=View.indexOfDrvdVar(t,e);return i>-1?e[i].type:-1}gObjectSet(t){if(t==0)return this.mapWin.gObjSet;else if(t>0)return this.dataWinArr[t-1].gObjSet;else return this.gObjSet}static indexOfDrvdVar(t,e=view.drvdVarArr){return indexOf(e,"varId",t)}legendGobj(t){if(t==0)return this.mapWin.legend;else if(t>0)return this.dataWinArr[t-1].legend}metaVarFullLabels(t,e,i,a){let s=[];metaVarUNames.map((l,r)=>{if(this.metaVarIsMatch(r,t,e,i,a))s.push(fullVarLabel(l,metaVarUUnits[r]))});return s}metaVarIds(t,e,i,a){let s=[];metaVarUNames.map((l,r)=>{if(this.metaVarIsMatch(r,t,e,i,a))s.push(r)});return s}metaVarIsMatch(t,e,i,a,s){let l=metaVarExtendedIds.includes(t+1);let r=metaVarValTypes[t]=="INDEXED_TEXT"||metaVarValTypes[t]=="TEXT";let n=e&&!l||i&&l;let o=a&&!r||s&&r;return n&&o}static nextDrvdVarId(t){let e=VID_FIRSTDRVD;while(View.indexOfDrvdVar(e,t)>-1){++e}return e}setDataWinDispStyleGridded(t,e,i,a,s,l,r,n,o){let d,m=t-1,c=m;if(t==-1){m=0;c=this.dataWinArr.length-1}for(d=m;d<=c;++d){let t=this.dataWinArr[d];t.plotMode=e;t.autoScale=i;t.xScale=a;t.yScale=s;t.isopycnicGridding=l;t.drawShaded=r;t.hideBad=n;t.hideDistance=o}}setDataWinDispStyleOrig(t,e,i,a,s){let l,r=t-1,n=r;if(t==-1){r=0;n=this.dataWinArr.length-1}for(l=r;l<=n;++l){let t=this.dataWinArr[l];t.plotMode=e;t.symbSize=i;t.symbColor=a;t.lineWidth=s}}setDataWinGeneralProps(t,e,i,a,s,l,r,n){let o,d=t-1,m=d;if(t==-1){d=0;m=this.dataWinArr.length-1}for(o=d;o<=m;++o){let t=this.dataWinArr[o];t.palName=e;t.fontSizeFac=i;t.bckColor=a;t.gridColor=s;t.drawGrid=l;t.autoCreateLabels=r;if(n!=undefined)t.highlightStyle=n}}setDataWinMarkProps(t,e,i,a){let s,l=t-1,r=l;if(t==-1){l=0;r=this.dataWinArr.length-1}for(s=l;s<=r;++s){let t=this.dataWinArr[s];t.drawMarks=e;t.markSize=i;t.markColor=a}}setDataWinVars(t,e,i,a,s,l,r,n){let o=View.varGroupId(e);let d,m=t-1,c=m;if(t==-1){m=0;c=this.dataWinArr.length-1}for(d=m;d<=c;++d){let t=this.dataWinArr[d];t.scope=e;if(i!=t.xvId){t.xLeft=missDOUBLE;t.xRight=largeDOUBLE}if(a!=t.yvId){t.yBottom=missDOUBLE;t.yTop=largeDOUBLE}if(s!=t.zvId){t.zBottom=missDOUBLE;t.zTop=largeDOUBLE}t.xvId=i;t.yvId=a;t.zvId=s;t.xvLst=o;t.yvLst=o;t.zvLst=o;t.xRev=l;t.yRev=r;t.zRev=n}}toXml(){let t="<?xml version='1.0' encoding='UTF-8' standalone='yes'?> <View collection='"+collectionName+"' xview='0.20'>";t+=this.mapWin.toXmlGeogrMap();t+=this.mapWin.toXml();t+=this.section.toXml();if(this.pickedStatArr.length>0)t+=this.toXmlPickedStatSet();let e,i=this.dataWinArr.length;for(e=0;e<i;++e)t+=this.dataWinArr[e].toXml(e+1);if(this.gObjSet.gObjArr.length>0)t+=" <Canvas>"+this.gObjSet.toXml()+" </Canvas>";if(this.varDispOrder.length>0)t+=" <VariableDisplayOrder>"+this.varDispOrder.join(",")+" </VariableDisplayOrder>";if(this.drvdVarArr.length>0)t+=this.toXmlDrvdVarSet();if(this.isoVarSet.isoVarArr.length>0)t+=this.isoVarSet.toXml();t+=this.statFilter.toXml();let a=this.rangesVarIdArr,s=this.rangesMinValArr;let l=this.rangesMaxValArr;i=a.length;t+=" <BasicVariables>";for(e=0;e<i;++e)t+=" <Variable max_value='"+l[e]+"' min_value='"+s[e]+"' var_id='"+a[e]+"'/>";t+="</BasicVariables>";return t+" </View>"}toXmlDrvdVarSet(){let t=" <DerivedVariables> ";for(let e=0;e<this.drvdVarArr.length;++e)t+=this.drvdVarArr[e].toXml();return t+" </DerivedVariables>"}toXmlPickedStatSet(){let t=" <PickedStations> ";for(let e=0;e<this.pickedStatArr.length;++e)t+=this.pickedStatArr[e].toXml();return t+" </PickedStations>"}uarrowGobj(t){if(t==0)return this.mapWin.uarrow;else if(t>0)return this.dataWinArr[t-1].uarrow}udotGobj(t){if(t==0)return this.mapWin.udot;else if(t>0)return this.dataWinArr[t-1].udot}static varGroupId(t){return t==3?2:1}winIdsWithVar(t){let e=[],i=0,a=this.dataWinArr.length;for(i=0;i<a;++i){let a=this.dataWinArr[i];if(a.scope!=3&&(a.xvId==t||a.yvId==t||a.zvId==t))e.push(i+1)}return e}}class Contour{constructor(t,e,i,a,s,l,r,n){if(arguments.length==1){let e=t.attributes;this.zVal=xmlNum(e,"z_value",0);this.fntSiz=xmlNum(e,"font_size",10);this.lblCol=xmlNum(e,"label_color",0);this.lblCount=xmlNum(e,"label_count",1);this.lCol=xmlNum(e,"line_color",0);this.lWidth=xmlNum(e,"line_width",1);this.lStyle=xmlNum(e,"line_style",0);this.fCol=xmlNum(e,"fill_color",-1)}else{this.zVal=t;this.fntSiz=e;this.lblCol=i;this.lblCount=a;this.lCol=s;this.lWidth=l;this.lStyle=r;this.fCol=n}}toXml(){return" <Contour z_value='"+this.zVal+"' font_size='"+this.fntSiz+"' label_color='"+this.lblCol+"' label_count='"+this.lblCount+"' line_color='"+this.lCol+"' line_width='"+this.lWidth+"' line_style='"+this.lStyle+"' fill_color='"+this.fCol+"'/>"}}class GObjectSet{constructor(t){this.gObjArr=[];if(t==undefined)return;let e=$$(t,"GraphicsObjects");if(e.length>0){let t=$$(e[0],"GObject");for(let e=0;e<t.length;++e)this.gObjArr.push(new GObject(t[e]))}}toXml(){let t=" <GraphicsObjects>";for(let e=0;e<this.gObjArr.length;++e)t+=this.gObjArr[e].toXml();return t+" </GraphicsObjects>"}}class GObject{constructor(){let t=arguments.length,e=arguments[0],i=t==2?true:false;if(t==3){this.setDefaults(arguments[0],arguments[1],arguments[2]);return}let a=1,s=1,l,r=i?null:e.attributes;this.type=i?e.type:xmlNum(r,"type",1);if(e.tagName=="Legend")this.type=40;else if(e.tagName=="UnitDot")this.type=41;else if(e.tagName=="UnitArrow")this.type=42;this.postData=i?e.postData:xmlStr(r,"post_data","T");this.dragging=i?"T":xmlStr(r,"dragging","T");this.clipping=i?e.clipping:xmlStr(r,"clipping","F");this.ownCoords=i?e.ownCoords:xmlStr(r,"own_coordinates","T");this.isAuto=i?"F":xmlStr(r,"is_automatic","F");switch(this.type){case 1:case 40:case 42:if(!i&&this.type!=40&&this.type!=42){l=$$(e,"Annotation")[0];r=l.attributes}this.xCoord=i?e.xCoord+a:xmlNum(r,"x_coordinate",0);this.yCoord=i?e.yCoord+s:xmlNum(r,"y_coordinate",0);this.text=i?e.text:xmlStr(r,"text","");this.txtColor=i?e.txtColor:xmlNum(r,"text_color",0);this.ptSize=i?e.ptSize:xmlNum(r,"font_size",-1);this.angle=i?e.angle:xmlNum(r,"angle",0);this.align=i?e.align:xmlNum(r,"text_alignment",0);this.fColor=i?e.fColor:xmlNum(r,"background_color",-1);this.bColor=i?e.bColor:xmlNum(r,"frame_color",-1);this.bWidth=i?e.bWidth:xmlNum(r,"frame_width",-1);this.bStyle=i?e.bStyle:xmlNum(r,"frame_type",0);this.arrLen=i?e.arrLen:xmlNum(r,"arrow_length",1);this.arrColor=i?e.arrColor:xmlNum(r,"arrow_color",0);break;case 5:if(!i){l=$$(e,"Symbol")[0];r=l.attributes}this.xCoord=i?e.xCoord+a:xmlNum(r,"x_coordinate",0);this.yCoord=i?e.yCoord+s:xmlNum(r,"y_coordinate",0);this.symbTyp=i?e.symbTyp:xmlNum(r,"symbol_type",0);this.symbSize=i?e.symbSize:xmlNum(r,"symbol_size",2);this.fColor=i?e.fColor:xmlNum(r,"fill_color",-1);this.bWidth=i?e.bWidth:xmlNum(r,"border_width",0);this.bColor=i?e.bColor:xmlNum(r,"border_color",0);this.bStyle=i?e.bStyle:xmlNum(r,"border_type",0);break;case 11:case 12:if(!i){l=$$(e,"Path")[0];r=l.attributes}this.doSmooth=i?e.doSmooth:xmlStr(r,"smoothing","F");this.fColor=i?e.fColor:xmlNum(r,"fill_color",-1);this.lColor=i?e.lColor:xmlNum(r,"line_color",0);this.lWidth=i?e.lWidth:xmlNum(r,"line_width",3);this.lStyle=i?e.lStyle:xmlNum(r,"line_type",0);this.startSymbType=i?e.startSymbType:xmlNum(r,"symbol_type_at_start",-1);this.endSymbType=i?e.endSymbType:xmlNum(r,"symbol_type_at_end",-1);this.startSymbSize=i?e.startSymbSize:xmlNum(r,"symbol_size_at_start",3);this.endSymbSize=i?e.endSymbSize:xmlNum(r,"symbol_size_at_end",3);if(!i)l=$$(e,"xValues")[0];this.xCoords=i?[...e.xCoords]:toNumericArray(l.textContent);if(!i)l=$$(e,"yValues")[0];this.yCoords=i?[...e.yCoords]:toNumericArray(l.textContent);if(i){let t,e=this.xCoords.length;for(t=0;t<e;++t){this.xCoords[t]+=a;this.yCoords[t]+=s}}break;case 15:if(!i){l=$$(e,"CdtFile")[0];r=l.attributes}this.fileName=xmlStr(r,"file_name","");this.fColor=xmlNum(r,"fill_color",-1);this.lColor=xmlNum(r,"line_color",0);this.lWidth=xmlNum(r,"line_width",1);this.lStyle=xmlNum(r,"line_style",0);this.symbTyp=xmlNum(r,"symbol_type",-1);this.symbSize=xmlNum(r,"symbol_size",0);this.bWidth=xmlNum(r,"border_width",-1);this.bColor=xmlNum(r,"border_color",0);this.bStyle=xmlNum(r,"border_style",0);break;case 30:if(!i){l=$$(e,"SymbolSet")[0];r=l.attributes}this.text=xmlStr(r,"legend_text","");this.addLgd=xmlStr(r,"add_to_legend","F");this.lColor=xmlNum(r,"line_color",-1);this.lWidth=xmlNum(r,"line_width",-1);this.lStyle=xmlNum(r,"line_type",0);this.symbTyp=xmlNum(r,"symbol_type",0);this.symbSize=xmlNum(r,"symbol_size",2);this.fColor=xmlNum(r,"fill_color",-1);this.bWidth=xmlNum(r,"border_width",0);this.bColor=xmlNum(r,"border_color",0);this.bStyle=xmlNum(r,"border_style",0);l=$$(e,"xValues")[0];this.xCoords=toNumericArray(l.textContent);l=$$(e,"yValues")[0];this.yCoords=toNumericArray(l.textContent);break}}static isTemplate(t){return t==40||t==41||t==42}setDefaults(t,e,i){let a,s=e.length,l=s-1;for(a=0;a<s;++a){e[a]=toOdvCanvasX(e[a]);i[a]=toOdvCanvasY(i[a])}this.type=t;this.postData="T";this.dragging="T";this.clipping="F";this.ownCoords="T";this.isAuto="F";switch(t){case 1:this.pxCoord=e[0];this.pyCoord=i[0];this.text="";this.txtColor=0;this.ptSize=12;this.angle=0;this.align=0;this.fColor=-1;this.bColor=-1;this.bWidth=-1;this.bStyle=0;break;case 5:this.pxCoord=e[0];this.pyCoord=i[0];this.symbTyp=0;this.symbSize=2;this.fColor=-1;this.bWidth=0;this.bColor=0;this.bStyle=0;break;case 11:case 12:if(t==12&&(e[0]!=e[l]||i[0]!=i[l])){e.push(e[0]);i.push(i[0])}this.doSmooth="F";this.fColor=-1;this.lColor=0;this.lWidth=3;this.lStyle=0;this.startSymbType=-1;this.endSymbType=-1;this.startSymbSize=3;this.endSymbSize=3;this.pxCoords=[...e];this.pyCoords=[...i];break}}toXml(){if(GObject.isTemplate(this.type))return"";let t=" <GObject type='"+this.type+"'"+this.toXmlGen()+">";switch(this.type){case 1:t+="<Annotation"+this.toXmlXy()+this.toXmlText()+" background_color='"+this.fColor+"' text_alignment='"+this.align+"' frame_width='"+this.bWidth+"' frame_color='"+this.bColor+"' angle='"+this.angle+"' frame_type='"+this.bStyle+"'/>";break;case 5:t+="<Symbol"+this.toXmlXy()+this.toXmlSymb()+" fill_color='"+this.fColor+"' border_width='"+this.bWidth+"' border_type='"+this.bStyle+"' border_color='"+this.bColor+"'/>";break;case 11:case 12:t+="<Path fill_color='"+this.fColor+"' smoothing='"+this.doSmooth+"' line_type='"+this.lStyle+"' line_color='"+this.lColor+"' line_width='"+this.lWidth+"' symbol_type_at_start='"+this.startSymbType+"' symbol_type_at_end='"+this.endSymbType+"' symbol_size_at_start='"+this.startSymbSize+"'symbol_size_at_end='"+this.endSymbSize+"'/>";if(this.xCoords!=undefined){t+="<xValues>"+this.xCoords.join()+"</xValues>";t+="<yValues>"+this.yCoords.join()+"</yValues>"}else if(this.pxCoords!=undefined){t+="<pxValues>"+this.pxCoords.join()+"</pxValues>";t+="<pyValues>"+this.pyCoords.join()+"</pyValues>"}break;case 15:t+="<CdtFile"+this.toXmlSymb()+" fill_color='"+this.fColor+"' file_name='"+this.fileName+"' border_width='"+this.bWidth+"' line_style='"+this.lStyle+"' line_color='"+this.lColor+"' border_color='"+this.bColor+"' border_style='"+this.bStyle+"' line_width='"+this.lWidth+"'/>";break;case 30:t+="<SymbolSet"+this.toXmlSymb()+" fill_color='"+this.fColor+"' border_width='"+this.bWidth+"' legend_text='"+this.text+"' line_type='"+this.lStyle+"' line_color='"+this.lColor+"' border_color='"+this.bColor+"' border_style='"+this.bStyle+"' add_to_legend='"+this.addLgd+"' line_width='"+this.lWidth+"'/>";t+="<xValues>"+this.xCoords.join()+"</xValues>";t+="<yValues>"+this.yCoords.join()+"</yValues>";break}return t+" </GObject>"}toXmlGen(){return" dragging='"+this.dragging+"' clipping='"+this.clipping+"' own_coordinates='"+this.ownCoords+"' post_data='"+this.postData+"' is_automatic='"+this.isAuto+"'"}toXmlLegend(){return" <Legend"+this.toXmlGen()+this.toXmlXy()+this.toXmlText()+" background_color='"+this.fColor+"' frame_width='"+this.bWidth+"' frame_color='"+this.bColor+"'/>"}toXmlSymb(){return" symbol_type='"+this.symbTyp+"' symbol_size='"+this.symbSize+"'"}toXmlText(){return" text='"+this.text+"' text_color='"+this.txtColor+"' font_size='"+this.ptSize+"'"}toXmlUArrow(){return" <UnitArrow"+this.toXmlGen()+this.toXmlXy()+this.toXmlText()+" arrow_length='"+this.arrLen+"' arrow_color='"+this.arrColor+"' background_color='"+this.fColor+"' frame_width='"+this.bWidth+"' frame_color='"+this.bColor+"'/>"}toXmlUDot(){return" <UnitDot"+this.toXmlGen()+this.toXmlXy()+this.toXmlText()+" arrow_length='"+this.arrLen+"' arrow_color='"+this.arrColor+"' background_color='"+this.fColor+"' frame_width='"+this.bWidth+"' frame_color='"+this.bColor+"'/>"}toXmlXy(){return this.xCoord!=undefined?" x_coordinate='"+this.xCoord+"' y_coordinate='"+this.yCoord+"'":" px_coordinate='"+this.pxCoord+"' py_coordinate='"+this.pyCoord+"'"}}class Window{constructor(t,e){this.setWinDefaults(e);if(t instanceof DataWindow)this.fromWinParent(t);else if(t!=null)this.fromWinXml(t,e)}fromWinParent(t){let e=t;this.highlightStyle=e.highlightStyle;this.fontSizeFac=e.fontSizeFac;this.palName=e.palName;this.bckColor=e.bckColor;this.drawGrid=e.drawGrid;this.gridColor=e.gridColor;this.drawLabels=e.drawLabels;this.autoCreateLabels=e.autoCreateLabels;this.xAlign=e.xAlign;this.yAlign=e.yAlign;this.colBarAlign=e.colBarAlign;this.xTic=e.xTic;this.yTic=e.yTic;this.zTic=e.zTic;this.xLTic=e.xLTic;this.yLTic=e.yLTic;this.zLTic=e.zLTic;this.symbType=e.symbType;this.symbSmSize=e.symbSmSize;this.symbColor=e.symbColor;this.symbSize=e.symbSize;this.nonLinStart=e.nonLinStart;this.nonLinEnd=e.nonLinEnd;this.nonLinAutoAdjust=e.nonLinAutoAdjust;this.xBbOff=e.xBbOff;this.xBbLen=e.xBbLen;this.yBbOff=e.yBbOff;this.yBbLen=e.yBbLen;this.xLeft=e.xLeft;this.xRight=e.xRight;this.xProj=e.xProj;this.yBottom=e.yBottom;this.yTop=e.yTop;this.yProj=e.yProj;this.zBottom=e.zBottom;this.zTop=e.zTop}fromWinXml(t,e){this.highlightStyle=xmlNum(t.attributes,"highlight_style",2);this.bckColor=xmlNum(t.attributes,"background_color",missINT);let i,a=$$(t,"Axis");if(a.length>0){i=a[0].attributes;this.drawGrid=xmlStr(i,"draw_grid","T");this.drawLabels=xmlStr(i,"create_labels","T");this.autoCreateLabels=xmlStr(i,"auto_label","T");this.gridColor=xmlNum(i,"color",0)}a=$$(t,"Symbol");if(a.length>0){i=a[0].attributes;this.symbColor=xmlNum(i,"color",e?0:1);this.symbType=xmlNum(i,"type",0);this.symbSize=xmlNum(i,"size",e?1.8:.7);this.symbSmSize=xmlNum(i,"small_size",.2)}let s=$$(t,"Window")[0];this.fontSizeFac=xmlNum(s.attributes,"font_size_factor",1)*100;a=$$(s,"Geometry");i=a[0].attributes;this.xBbOff=xmlNum(i,"x_offset_bb",1);this.xBbLen=xmlNum(i,"x_length_bb",1);this.xLeft=xmlNum(i,"x_left",missDOUBLE);this.xRight=xmlNum(i,"x_right",largeDOUBLE);this.xProj=xmlNum(i,"x_projection",0);this.yBbOff=xmlNum(i,"y_offset_bb",1);this.yBbLen=xmlNum(i,"y_length_bb",1);this.yBottom=xmlNum(i,"y_bottom",missDOUBLE);this.yTop=xmlNum(i,"y_top",largeDOUBLE);this.yProj=xmlNum(i,"y_projection",0);a=$$(s,"ColorScale");if(a.length>0){i=a[0].attributes;this.palName=xmlStr(i,"palette_file_name","Odv");this.nonLinStart=xmlNum(i,"non_linearity_start",-.1);this.nonLinEnd=xmlNum(i,"non_linearity_end",.1);this.nonLinAutoAdjust=xmlStr(i,"auto_adjust_non_linearity","F");this.zBottom=xmlNum(i,"z_range_start",missDOUBLE);this.zTop=xmlNum(i,"z_range_end",largeDOUBLE)}a=$$(s,"Legend");if(a.length>0)this.legend=new GObject(a[0]);a=$$(s,"UnitDot");if(a.length>0)this.udot=new GObject(a[0]);a=$$(s,"UnitArrow");if(a.length>0)this.uarrow=new GObject(a[0]);a=$$(s,"Axis");if(a.length>0){i=a[0].attributes;this.xTic=xmlNum(i,"x_tic",largeDOUBLE);this.yTic=xmlNum(i,"y_tic",largeDOUBLE);this.zTic=xmlNum(i,"cb_tic",largeDOUBLE);this.xLTic=xmlNum(i,"x_tic_long",largeDOUBLE);this.yLTic=xmlNum(i,"y_tic_long",largeDOUBLE);this.zLTic=xmlNum(i,"cb_tic_long",largeDOUBLE);this.xAlign=xmlNum(i,"x_align",1);this.yAlign=xmlNum(i,"y_align",1);this.colBarAlign=xmlNum(i,"cb_align",e?1:0)}this.gObjSet=new GObjectSet(s)}setWinDefaults(t){this.highlightStyle=2;this.fontSizeFac=100;this.palName="Odv";this.bckColor=missINT;this.drawGrid="T";this.gridColor=0;this.drawLabels="T";this.autoCreateLabels=t?"T":"F";this.xAlign=1;this.yAlign=1;this.colBarAlign=t?1:0;this.xTic=largeDOUBLE;this.yTic=largeDOUBLE;this.zTic=largeDOUBLE;this.xLTic=largeDOUBLE;this.yLTic=largeDOUBLE;this.zLTic=largeDOUBLE;this.symbType=0;this.symbSmSize=.2;this.symbColor=t?0:1;this.symbSize=t?1.8:.7;this.nonLinStart=-.1;this.nonLinEnd=.1;this.nonLinAutoAdjust="F";this.xBbOff=10;this.xBbLen=10;this.yBbOff=6;this.yBbLen=10;this.xLeft=missDOUBLE;this.xRight=largeDOUBLE;this.xProj=0;this.yBottom=missDOUBLE;this.yTop=largeDOUBLE;this.yProj=0;this.zBottom=missDOUBLE;this.zTop=largeDOUBLE;this.gObjSet=new GObjectSet}toXmlColorScale(t){let e=" <ColorScale";if(t)e+=" auto_adjust_non_linearity='"+this.nonLinAutoAdjust+"' non_linearity_start='"+this.nonLinStart+"' non_linearity_end='"+this.nonLinEnd+"' z_range_start='"+this.zBottom+"' z_range_end='"+this.zTop+"'";return e+" palette_file_name='"+this.palName+"'/>"}toXmlGeometry(){return" <Geometry x_left='"+this.xLeft+"' x_right='"+this.xRight+"' y_bottom='"+this.yBottom+"' y_top='"+this.yTop+"' x_length_bb='"+this.xBbLen+"' x_offset_bb='"+this.xBbOff+"' y_length_bb='"+this.yBbLen+"' y_offset_bb='"+this.yBbOff+"' x_projection='"+this.xProj+"' y_projection='"+this.yProj+"'/>"}toXmlWinAxis(t){let e=" <Axis";if(t)e+=" x_tic='"+this.xTic+"' x_tic_long='"+this.xLTic+"' y_tic='"+this.yTic+"' y_tic_long='"+this.yLTic+"' cb_tic='"+this.zTic+"' cb_tic_long='"+this.zLTic+"' x_align='"+this.xAlign+"' y_align='"+this.yAlign+"'";return e+" cb_align='"+this.colBarAlign+"'/>"}toXmlWindow(t){let e=this.toXmlWindowOpen()+this.toXmlWinAxis(t)+this.toXmlGeometry()+this.toXmlColorScale(t)+this.gObjSet.toXml();if(this.legend!=undefined)e+=this.legend.toXml();if(this.udot!=undefined)e+=this.udot.toXml();if(this.uarrow!=undefined)e+=this.uarrow.toXml();return e+this.toXmlWindowClose()}toXmlWindowClose(){return" </Window>"}toXmlWindowOpen(){return" <Window font_size_factor='"+roundedVal(this.fontSizeFac*.01,2)+"'>"}toXmlWinGen(t){return this.toXmlWindowOpen()+this.toXmlWinAxis(t)+this.toXmlGeometry()+this.toXmlColorScale(t)+this.toXmlWindowClose()}}class DataWindow extends Window{constructor(t){super(t,true);this.setDefaults();if(t instanceof DataWindow)this.fromParent(t);else if(t!=null)this.fromXml(t)}fromParent(t){let e=t;this.xvId=e.xvId;this.yvId=e.yvId;this.zvId=e.zvId;this.xRev=e.xRev;this.yRev=e.yRev;this.zRev=e.zRev;this.plotMode=e.plotMode;this.scope=e.scope;this.winType=e.winType;this.lineColor=e.lineColor;this.lineWidth=e.lineWidth;this.lineStyle=e.lineStyle;this.autoScale=e.autoScale;this.xScale=e.xScale;this.yScale=e.yScale;this.isopycnicGridding=e.isopycnicGridding;this.drawShaded=e.drawShaded;this.drawContours=e.drawContours;this.contours=e.contours;this.DivaNonNegativity=e.DivaNonNegativity;this.DivaSnr=e.DivaSnr;this.DivaUseSecPoly=e.DivaUseSecPoly;this.DivaBathyFile=e.DivaBathyFile;this.DivaBathyVal=e.DivaBathyVal;this.drawMarks=e.drawMarks;this.markColor=e.markColor;this.markSize=e.markSize;this.hideBad=e.hideBad;this.hideDistance=e.hideDistance;this.drawIsop=e.drawIsop;this.isopLWidth=e.isopLWidth;this.isopColor=e.isopColor;this.isopLStyle=e.isopLStyle;this.isopRefPress=e.isopRefPress;this.arrXvId=e.arrXvId;this.arrYvId=e.arrYvId;this.arrColor=e.arrColor;this.arrLineStyle=e.arrLineStyle;this.arrLineWidth=e.arrLineWidth;this.arrScale=e.arrScale;this.smplFilter=new SmplFilter}fromXml(t){let e=$$(t,"Modes")[0].attributes;this.plotMode=xmlNum(e,"plot_mode",0);this.scope=xmlNum(e,"window_mode",0);this.winType=xmlNum(e,"window_type",0);let i=$$(t,"AxisVariables"),a;if(i.length>0){let t=i[0];a=$$(t,"xAxis");if(a.length>0){e=a[0].attributes;this.xvId=xmlNum(e,"var_id",1);this.xvLst=xmlNum(e,"var_list",1);this.xRev=xmlStr(e,"is_reversed","F")}a=$$(t,"yAxis");if(a.length>0){e=a[0].attributes;this.yvId=xmlNum(e,"var_id",1);this.yvLst=xmlNum(e,"var_list",1);this.yRev=xmlStr(e,"is_reversed","F")}a=$$(t,"zAxis");if(a.length>0){e=a[0].attributes;this.zvId=xmlNum(e,"var_id",1);this.zvLst=xmlNum(e,"var_list",1);this.zRev=xmlStr(e,"is_reversed","F")}}i=$$(t,"Arrows");if(i.length>0){e=i[0].attributes;this.arrXvId=xmlNum(e,"x_var_id",1);this.arrYvId=xmlNum(e,"y_var_id",2);this.arrColor=xmlNum(e,"arrow_color",0);this.arrLineStyle=xmlNum(e,"line_style",0);this.arrLineWidth=xmlNum(e,"line_width",1);this.arrScale=xmlNum(e,"scale",1)}i=$$(t,"Gridding");if(i.length>0){e=i[0].attributes;this.xScale=xmlNum(e,"x_scale_length",2);this.yScale=xmlNum(e,"y_scale_length",2);this.isopycnicGridding=xmlStr(e,"isopycnic_gridding","F");this.drawShaded=xmlStr(e,"draw_shaded","T");this.autoScale=xmlStr(e,"auto_scale_lengths","T");this.DivaUseSecPoly=xmlStr(e,"DIVA_use_section_polygon","T");this.DivaNonNegativity=xmlStr(e,"DIVA_non_negativity","F");this.DivaSnr=xmlNum(e,"DIVA_signal_to_noise_ratio",50);this.DivaBathyFile=xmlStr(e,"DIVA_bathymetry_file_name","");this.DivaBathyVal=xmlNum(e,"DIVA_bathymetry_value",missDOUBLE)}i=$$(t,"DataMark");if(i.length>0){e=i[0].attributes;this.drawMarks=xmlStr(e,"draw","T");this.markColor=xmlNum(e,"color",17);this.markSize=xmlNum(e,"size",.2)}i=$$(t,"BadEstimateHiding");if(i.length>0){e=i[0].attributes;this.hideBad=xmlStr(e,"hide","T");this.hideDistance=xmlNum(e,"max_distance",3)}i=$$(t,"Line");if(i.length>0){e=i[0].attributes;this.lineColor=xmlNum(e,"color",0);this.lineWidth=xmlNum(e,"width",1);this.lineStyle=xmlNum(e,"style",0)}i=$$(t,"Contours");if(i.length>0){let t=i[0];e=t.attributes;this.drawContours=xmlStr(e,"draw","F");a=$$(t,"Contour");for(let t=0;t<a.length;++t)this.contours.push(new Contour(a[t]))}i=$$(t,"Isopycnal");if(i.length>0){e=i[0].attributes;this.drawIsop="T";this.isopLWidth=xmlNum(e,"line_width",1);this.isopColor=xmlNum(e,"isopycnal_color",8);this.isopLStyle=xmlNum(e,"line_style",0);this.isopRefPress=xmlNum(e,"ref_pressure",0)}this.smplFilter=new SmplFilter(t)}setDefaults(){this.xvId=1;this.yvId=0;this.zvId=VID_NONE;this.xvLst=1;this.yvLst=1;this.zvLst=1;this.xRev="F";this.yRev="T";this.zRev="F";this.plotMode=0;this.scope=0;this.winType=0;this.lineColor=0;this.lineWidth=1;this.lineStyle=0;this.autoScale="T";this.xScale=2;this.yScale=2;this.isopycnicGridding="F";this.drawShaded="T";this.drawContours="F";this.autoContours="F";this.contours=[];this.DivaNonNegativity="F";this.DivaSnr=50;this.DivaUseSecPoly="T";this.DivaBathyFile="";this.DivaBathyVal=missDOUBLE;this.drawMarks="F";this.markColor=17;this.markSize=.2;this.hideBad="T";this.hideDistance=3;this.drawIsop="F";this.isopLWidth=1;this.isopColor=8;this.isopLStyle=0;this.isopRefPress=0;this.arrXvId=-1;this.arrYvId=-1;this.arrColor=0;this.arrLineStyle=0;this.arrLineWidth=1;this.arrScale=1;this.smplFilter=new SmplFilter}toXml(t){let e=this.toXmlDataWindowOpen(t)+this.toXmlAxisProps()+this.toXmlAxisVars()+this.toXmlModes()+this.toXmlArrows()+this.toXmlIsopycnal()+this.toXmlLineStyle()+this.toXmlSymbol()+this.toXmlContours()+this.toXmlGridding()+this.toXmlHideBad()+this.toXmlMarkData()+this.toXmlWindow(true);return e+this.toXmlDataWindowClose()}toXmlArrows(){return this.plotMode!=6||this.arrXvId==-1?"":" <Arrows line_style='"+this.arrLineStyle+"' x_var_id='"+this.arrXvId+"' arrow_color='"+this.arrColor+"' line_width='"+this.arrLineWidth+"' y_var_id='"+this.arrYvId+"' scale='"+this.arrScale+"'/>"}toXmlAxisProps(){return" <Axis auto_label='"+this.autoCreateLabels+"' axis_color='"+this.gridColor+"' draw_grid='"+this.drawGrid+"'/>"}toXmlAxisVars(){let t=" <AxisVariables> <xAxis var_id='"+this.xvId+"' var_list='"+this.xvLst+"' is_reversed='"+this.xRev+"'/> <yAxis var_id='"+this.yvId+"' var_list='"+this.yvLst+"' is_reversed='"+this.yRev+"'/>";t+="<zAxis var_id='"+this.zvId+"' var_list='"+this.yvLst+"' is_reversed='"+this.zRev+"'/>";t+=" </AxisVariables>";return t}toXmlContours(){let t=" <Contours draw='"+this.drawContours+"' auto_create='"+this.autoContours+"'> ";for(let e=0;e<this.contours.length;++e){t+=this.contours[e].toXml()}t+=" </Contours>";return t}toXmlDataWindowClose(){return" </DataWindow>"}toXmlDataWindowOpen(t){return" <DataWindow window_id='"+t+"' background_color='"+this.bckColor+"' highlight_style='"+this.highlightStyle+"'>"}toXmlGridding(){return" <Gridding draw_shaded='"+this.drawShaded+"' auto_scale_lengths='"+this.autoScale+"' y_scale_length='"+roundedVal(this.yScale,2)+"' x_scale_length='"+roundedVal(this.xScale,2)+"' isopycnic_gridding='"+this.isopycnicGridding+"' DIVA_signal_to_noise_ratio='"+this.DivaSnr+"' DIVA_non_negativity='"+this.DivaNonNegativity+"' DIVA_use_section_polygon='"+this.DivaUseSecPoly+"' DIVA_bathymetry_file_name='"+this.DivaBathyFile+"' DIVA_bathymetry_value='"+this.DivaBathyVal+"'/>"}toXmlHideBad(){return" <BadEstimateHiding hide='"+this.hideBad+"' max_distance='"+this.hideDistance+"'/>"}toXmlIsopycnal(t){return" <Isopycnal draw_isopycnal='"+this.drawIsop+"' line_width='"+this.isopLWidth+"' isopycnal_color='"+this.isopColor+"' line_style='"+this.isopLStyle+"' ref_pressure='"+this.isopRefPress+"'/>"}toXmlLineStyle(){return" <Line width='"+this.lineWidth+"' style='"+this.lineStyle+"' color='"+this.lineColor+"'/>"}toXmlMarkData(){return" <DataMark draw='"+this.drawMarks+"' color='"+this.markColor+"' size='"+roundedVal(this.markSize,3)+"'/>"}toXmlModes(){return" <Modes window_mode='"+this.scope+"' window_type='"+this.winType+"' plot_mode='"+this.plotMode+"'/>"}toXmlProps(t){return this.toXmlDataWindowOpen(t)+this.toXmlAxisProps()+this.toXmlAxisVars()+this.toXmlModes()+this.toXmlArrows()+this.toXmlLineStyle()+this.toXmlSymbol()+this.toXmlGridding()+this.toXmlHideBad()+this.toXmlMarkData()+this.toXmlContours()+this.toXmlWinGen(true)+this.toXmlDataWindowClose()}toXmlSymbol(){return" <Symbol size='"+this.symbSize+"' small_size='"+this.symbSmSize+"' type='"+this.symbType+"' color='"+this.symbColor+"'/>"}}class MapWindow extends Window{constructor(t){super($$(t,"MapWindow")[0],false);this.setDefaults();let e=$$(t,"GeographicMap");let i=e[0],a=i.attributes;this.prjType=xmlNum(a,"projection_type",0);e=$$(i,"AutoMapLayerSettings");if(e.length>0){a=e[0].attributes;this.doBathy=xmlStr(a,"ocean_bathymetry","T");this.doCoast=xmlStr(a,"coastlines","T");this.fillCoast=xmlStr(a,"coastline_fill","T");this.doTopo=xmlStr(a,"land_topography","F");this.doRivers=xmlStr(a,"lakes_and_rivers","F");this.doBorders=xmlStr(a,"borders","F")}e=$$(i,"MapDomain");a=e[0].attributes;this.wLon=xmlNum(a,"lon_min",-180);this.eLon=xmlNum(a,"lon_max",180);this.sLat=xmlNum(a,"lat_min",-90);this.nLat=xmlNum(a,"lat_max",90);let s=.5*(this.wLon+this.eLon);let l=.5*(this.sLat+this.nLat);this.prjCntrLon=s;this.prjCntrLat=l;e=$$(i,"ProjectionPole");if(e.length>0){a=e[0].attributes;this.prjCntrLon=xmlNum(a,"lon_center",s);this.prjCntrLat=xmlNum(a,"lat_center",l)}}setDefaults(){this.wLon=-180;this.eLon=180;this.sLat=-90;this.nLat=90;this.prjType=0;this.prjCntrLon=0;this.prjCntrLat=0;this.doBathy="T";this.doCoast="T";this.fillCoast="T";this.doTopo="F";this.doRivers="F";this.doBorders="F"}setDomain(t,e,i,a){this.wLon=t;this.eLon=e;this.sLat=i;this.nLat=a}toXml(){return this.toXmlMapWindowOpen()+this.toXmlAxisProps()+this.toXmlSymbol()+this.toXmlWindow(false)+this.toXmlMapWindowClose()}toXmlAutoLayers(){return" <AutoMapLayerSettings borders='"+this.doBorders+"' lakes_and_rivers='"+this.doRivers+"' coastline_fill='"+this.fillCoast+"' coastlines='"+this.doCoast+"' ocean_bathymetry='"+this.doBathy+"' land_topography='"+this.doTopo+"'/>"}toXmlAxisProps(){return" <Axis create_labels='"+this.drawLabels+"' color='"+this.gridColor+"' draw_grid='"+this.drawGrid+"'/>"}toXmlDomain(){return" <MapDomain lon_min='"+this.wLon+"' lon_max='"+this.eLon+"' lat_min='"+this.sLat+"' lat_max='"+this.nLat+"'/>"}toXmlGeogrMap(){return" <GeographicMap projection_type='"+this.prjType+"'>"+this.toXmlPrj()+this.toXmlDomain()+this.toXmlAutoLayers()+" </GeographicMap>"}toXmlMapWindowClose(){return" </MapWindow>"}toXmlMapWindowOpen(){return" <MapWindow background_color='"+this.bckColor+"'>"}toXmlPrj(){return" <ProjectionPole lon_center='"+this.prjCntrLon+"' lat_center='"+this.prjCntrLat+"'/>"}toXmlProps(){return this.toXmlMapWindowOpen()+this.toXmlAxisProps()+this.toXmlSymbol()+this.toXmlWindowOpen()+this.toXmlWinAxis(false)+this.toXmlColorScale(false)+this.toXmlWindowClose()+this.toXmlMapWindowClose()}toXmlSymbol(){return" <Symbol size='"+this.symbSize+"' color='"+this.symbColor+"'/>"}}class DrvdVar{constructor(t,e,i,a,s,l,r,n,o,d,m,c,u,p){this.setDefaults();if(arguments.length==1){let e=t.attributes,i;this.name=xmlStr(e,"label","");this.units=xmlStr(e,"unit","");this.uname=xmlStr(e,"ulabel","");this.uunits=xmlStr(e,"uunit","");this.varId=xmlNum(e,"var_id",-1);this.type=xmlNum(e,"type",-1);this.digitsCount=xmlNum(e,"digits_count",2);this.minVal=xmlNum(e,"min_value",missDOUBLE);this.maxVal=xmlNum(e,"max_value",largeDOUBLE);i=$$(t,"Input");if(i.length>0)this.inpVarIds=toNumericArray(i[0].textContent);i=$$(t,"iParameter");if(i.length>0)this.iPrms=toNumericArray(i[0].textContent);i=$$(t,"fParameter");if(i.length>0)this.fPrms=toNumericArray(i[0].textContent);i=$$(t,"MacroFile");if(i.length>0)this.mcrFile=i[0].textContent;i=$$(t,"Expression");if(i.length>0)this.expr=i[0].textContent}else{this.name=t;this.units=e;this.uname=i;this.uunits=a;this.varId=s;this.type=l;this.digitsCount=r;this.inpVarIds=n;this.iPrms=o;this.fPrms=d;this.macroFile=m;this.expr=c;this.minVal=u;this.maxVal=p}}setDefaults(){this.name="";this.units="";this.uname="";this.uunits="";this.varId=-1;this.type=-1;this.digitsCount=2;this.inpVarIds=[];this.iPrms=[];this.fPrms=[];this.macroFile="";this.expr="1";this.minVal=missDOUBLE;this.maxVal=largeDOUBLE}toXml(){let t=" <Variable label='"+this.name+"' unit='"+this.units+"' type='"+this.type+"' var_id='"+this.varId+"' digits_count='"+this.digitsCount+"' min_value='"+this.minVal+"' max_value='"+this.maxVal+"'>";if(this.inpVarIds.length>0)t+=" <Input>"+this.inpVarIds.join()+"</Input>";if(this.iPrms.length>0)t+=" <iParameter>"+this.iPrms.join()+"</iParameter>";if(this.fPrms.length>0)t+=" <fParameter>"+this.fPrms.join()+"</fParameter>";if(this.type==12||this.type==45){if(this.macroFile.length>0)t+=" <MacroFile>"+this.macroFile+"</MacroFile>";t+=" <Expression>"+this.expr+"</Expression>"}t+=" </Variable>";return t}}class IsoVarSet{constructor(t){this.isoVarArr=[];this.isoVarSmplFilter=new SmplFilter;let e=$$(t,"IsoSurfaceVariables");if(e.length>0){let t=$$(e[0],"IsoVariable");for(let e=0;e<t.length;++e)this.isoVarArr.push(new IsoVar(t[e]));this.isoVarSmplFilter=new SmplFilter(e[0])}}toXml(){let t=" <IsoSurfaceVariables>";for(let e=0;e<this.isoVarArr.length;++e)t+=this.isoVarArr[e].toXml();t+=this.isoVarSmplFilter.toXml();return t+" </IsoSurfaceVariables>"}}class IsoVar{constructor(t,e,i){this.setDefaults();if(arguments.length==1){let e=t.attributes;this.varId=xmlNum(e,"var_id",-1);this.surfVarId=xmlNum(e,"surface_var_id",-1);this.surfVal=xmlStr(e,"surface_value","first")}else{this.varId=t;this.surfVarId=e;this.surfVal=i}}setDefaults(){this.varId=-1;this.surfVarId=-1;this.surfVal="first"}toXml(){return" <IsoVariable var_id='"+this.varId+"' surface_var_id='"+this.surfVarId+"' surface_value='"+this.surfVal+"'/>"}}class PickedStat{constructor(t){this.setDefaults();if(typeof t==="number"){this.statId=t}else{let e=t.attributes;this.statId=xmlNum(e,"sequence_id",-1);this.symbType=xmlNum(e,"symbol_type",-1);this.fillCol=xmlNum(e,"fill_color",-1);this.frameCol=xmlNum(e,"frame_color",-1);this.frameWidth=xmlNum(e,"frame_width",-1);this.lineCol=xmlNum(e,"line_color",-1);this.lineStyle=xmlNum(e,"line_style",-1);this.align=xmlNum(e,"text_alignment",-1)}}setDefaults(){this.statId=-1;this.symbType=-1;this.fillCol=-1;this.frameCol=-1;this.frameWidth=-1;this.lineCol=-1;this.lineStyle=-1;this.align=-1}toXml(){let t=" <Station sequence_id='"+this.statId+"'";if(this.symbType>-1)t+=" symbol_type='"+this.symbType+"' text_alignment='"+this.align+"' line_style='"+this.lineStyle+"' fill_color='"+this.fillCol+"' frame_color='"+this.frameCol+"' line_color='"+this.lineCol+"' frame_width='"+this.frameWidth+"'";t+="/>";return t}}class SmplFilter{constructor(t){this.itemArr=[];if(t!==undefined){let e=$$(t,"SampleSelectionEntry");for(let t=0;t<e.length;++t)this.itemArr.push(new SmplFilterItem(e[t]))}}getQualityFilters(){let t,e=this.itemArr.length,i,a=[],s=[],l=[];for(t=0;t<e;++t){i=this.itemArr[t];if(i.type==0)i.varIds.map(t=>{a.push(t);s.push(i.schemaId);l.push(i.exclFlags)})}return{varIds:a,schemaIds:s,exclQfArrs:l}}getRangeFilters(){let t,e=this.itemArr.length,i,a=[],s=[],l=[];for(t=0;t<e;++t){i=this.itemArr[t];if(i.type==1){a.push(i.varIds[0]);s.push(i.minVal);l.push(i.maxVal)}}return{varIds:a,minVals:s,maxVals:l}}toXml(){if(this.itemArr.length==0)return"";let t=" <SampleSelectionCriteria> ";for(let e=0;e<this.itemArr.length;++e)t+=this.itemArr[e].toXml();return t+" </SampleSelectionCriteria>"}static toXmlS(t,e,i,a,s,l){let r=" <SampleSelectionCriteria>",n,o=t.length,d=a.length;for(n=0;n<o;++n){r+=" <SampleSelectionEntry var_ids='"+t[n]+"'> <RangeFilter max_value='"+i[n]+"' min_value='"+e[n]+"'/> </SampleSelectionEntry>"}for(n=0;n<d;++n){r+=" <SampleSelectionEntry var_ids='"+a[n]+"'> <QualityFilter schema_id='"+s[n]+"'>"+l[n].join()+"</QualityFilter></SampleSelectionEntry>"}r+=" </SampleSelectionCriteria>";return r}}class SmplFilterItem{constructor(t){this.setDefaults();this.varIds=toNumericArray(xmlStr(t.attributes,"var_ids",""));let e=$$(t,"QualityFilter");if(e.length>0){this.type=0;this.schemaId=xmlNum(e[0].attributes,"schema_id",0);this.exclFlags=toNumericArray(e[0].textContent)}e=$$(t,"RangeFilter");if(e.length>0){this.type=1;this.minVal=xmlNum(e[0].attributes,"min_value",0);this.maxVal=xmlNum(e[0].attributes,"max_value",1)}}setDefaults(){this.type=0;this.varIds=[];this.schemaId=0;this.exclFlags=[];this.minVal=0;this.maxVal=1}toXml(){let t=" <SampleSelectionEntry var_ids='"+this.varIds.join()+"'>";if(this.type==0)t+=" <QualityFilter schema_id='"+this.schemaId+"'>"+this.exclFlags.join()+"</QualityFilter>";else if(this.type==1)t+=" <RangeFilter min_value='"+this.minVal+"' max_value='"+this.maxVal+"'/>";return t+" </SampleSelectionEntry>"}}class Section{constructor(t){this.setDefaults();Section.widthCnvFac=2500;if(t==undefined)return;let e=$$(t,"Section");if(e.length>0){let t=e[0].attributes,i;let a=xmlStr(t,"bathymetry_name","Station Depths"),s=2;if(a=="(none)")s=0;else if(a=="Station Depths")s=1;else if(a.indexOf("ETOPO1")>-1)s=2;else if(a.indexOf("GEBCO")>-1)s=3;this.name=xmlStr(t,"section_name","");this.type=xmlNum(t,"coordinate",0);this.width=xmlNum(t,"width",.08)*Section.widthCnvFac;this.bathyType=s;this.bathyColor=xmlNum(t,"color",17);i=$$(e[0],"xNodes")[0];this.xNodes=toNumericArray(i.textContent);i=$$(e[0],"yNodes")[0];this.yNodes=toNumericArray(i.textContent)}}isValid(){return this.type>-1}setDefaults(){this.name="";this.type=-1;this.width=200;this.bathyType=2;this.bathyColor=17}setVals(t="",e=0,i=200,a=2,s=17){this.name=t;this.type=e;this.width=i;this.bathyType=a;this.bathyColor=s}toXml(){if(!this.isValid())return"";const t=["(none)","Station Depths","ETOPO1_2x2min_Global.nc","GEBCO_2014_2x2min_Global.nc"];let e=roundedVal(this.width/Section.widthCnvFac,3);return" <Section color='"+this.bathyColor+"' coordinate='"+this.type+"' section_name='"+this.name+"' width='"+e+"' bathymetry_name='"+t[this.bathyType]+"'> <xNodes>"+this.xNodes.join(",")+"</xNodes> <yNodes>"+this.yNodes.join(",")+"</yNodes> </Section>"}}class StatFilter{constructor(t){this.setDefaults();let e=$$(t,"StationSelectionCriteria"),i;if(e.length==0)return;let a,s=e[0];this.invert=xmlStr(s.attributes,"is_inverting","F");let l=$$(s,"Names");if(l.length>0){a=l[0].attributes;this.cruise=xmlStr(a,"cruise","*");this.statType=xmlStr(a,"station_type","*");this.statNameMin=xmlStr(a,"first_station","0");this.statNameMax=xmlStr(a,"last_station","99999999")}l=$$(s,"Range");if(l.length>0){a=l[0].attributes;this.statIdMin=xmlNum(a,"first_station_id",0);this.statIdMax=xmlNum(a,"last_station_id",99999999);this.smplCountMin=xmlNum(a,"sample_count_min",0);this.smplCountMax=xmlNum(a,"sample_count_max",99999999)}l=$$(s,"Period");if(l.length>0){a=l[0].attributes;this.periodDay0=xmlNum(a,"first_day",1);this.periodDay1=xmlNum(a,"last_day",31);this.periodMon0=xmlNum(a,"first_month",1);this.periodMon1=xmlNum(a,"last_month",12);this.periodYear0=xmlNum(a,"first_year",-99999);this.periodYear1=xmlNum(a,"last_year",99999);this.periodHour0=xmlNum(a,"first_hour",0);this.periodHour1=xmlNum(a,"last_hour",23);this.periodMinute0=xmlNum(a,"first_minute",0);this.periodMinute1=xmlNum(a,"last_minute",59)}l=$$(s,"Season");if(l.length>0){a=l[0].attributes;this.seasonDay0=xmlNum(a,"first_day",1);this.seasonDay1=xmlNum(a,"last_day",31);this.seasonMon0=xmlNum(a,"first_month",1);this.seasonMon1=xmlNum(a,"last_month",12)}l=$$(s,"DayTime");if(l.length>0){a=l[0].attributes;this.dayTimHour0=xmlNum(a,"first_hour",0);this.dayTimHour1=xmlNum(a,"last_hour",23);this.dayTimMin0=xmlNum(a,"first_minute",0);this.dayTimMin1=xmlNum(a,"last_minute",59)}l=$$(s,"RequiredVars");if(l.length>0){a=l[0].attributes;this.reqVarIsOrLogic=xmlStr(a,"use_or_logic","F");this.reqVarIds=toNumericArray(xmlStr(a,"var_ids",""))}let r;l=$$(s,"MetaVarRange");for(r=0;r<l.length;++r){a=l[r].attributes;this.mvRangeVarIds.push(xmlNum(a,"var_id",0));this.mvRangeMinVals.push(xmlNum(a,"min_value",0));this.mvRangeMaxVals.push(xmlNum(a,"max_value",1))}l=$$(s,"MetaVarWildCardExpression");for(r=0;r<l.length;++r){a=l[r].attributes;this.mvWildCardVarIds.push(xmlNum(a,"var_id",0));this.mvWildCardExprs.push(xmlStr(a,"wildcard_expression",""));this.mvWildCardCases.push(xmlStr(a,"case_sensitive","F"))}l=$$(s,"Domain");if(l.length>0){a=l[0].attributes;this.wLonDom=xmlNum(a,"lon_min",missDOUBLE);this.eLonDom=xmlNum(a,"lon_max",largeDOUBLE);this.sLatDom=xmlNum(a,"lat_min",missDOUBLE);this.nLatDom=xmlNum(a,"lat_max",largeDOUBLE)}l=$$(s,"Polygon");if(l.length>0){i=$$(l[0],"xValues")[0];this.xPoly=toNumericArray(i.textContent);i=$$(l[0],"yValues")[0];this.yPoly=toNumericArray(i.textContent)}l=$$(s,"HistoryPeriod");if(l.length>0){a=l[0].attributes;this.historyDay0=xmlNum(a,"first_day",1);this.historyDay1=xmlNum(a,"last_day",31);this.historyMon0=xmlNum(a,"first_month",1);this.historyMon1=xmlNum(a,"last_month",12);this.historyYear0=xmlNum(a,"first_year",-99999);this.historyYear1=xmlNum(a,"last_year",99999);this.historyHour0=xmlNum(a,"first_hour",0);this.historyHour1=xmlNum(a,"last_hour",23);this.historyMinute0=xmlNum(a,"first_minute",0);this.historyMinute1=xmlNum(a,"last_minute",59)}l=$$(s,"HistoryWildCardExpressions");if(l.length>0){a=l[0].attributes;this.historyUser=xmlStr(a,"user","*");this.historyAction=xmlStr(a,"action","*");this.historyDescr=xmlStr(a,"description","*")}}setDefaults(){this.setDefaultsNameRange();this.setDefaultsDateTime();this.setDefaultsDomain();this.setDefaultsMetaData();this.setDefaultsAvail();this.setDefaultsHistory();this.invert="F"}setDefaultsAvail(){this.reqVarIds=[];this.reqVarIsOrLogic="F"}setDefaultsDateTime(){this.periodDay0=1;this.periodDay1=31;this.periodMon0=1;this.periodMon1=12;this.periodYear0=-99999;this.periodYear1=99999;this.periodHour0=0;this.periodHour1=23;this.periodMinute0=0;this.periodMinute1=59;this.seasonDay0=1;this.seasonDay1=31;this.seasonMon0=1;this.seasonMon1=12;this.dayTimHour0=0;this.dayTimHour1=23;this.dayTimMin0=0;this.dayTimMin1=59}setDefaultsDomain(){this.xPolyPix=[];this.yPolyPix=[];this.xPoly=[];this.yPoly=[];this.wLonDom=this.sLatDom=missDOUBLE;this.eLonDom=this.nLatDom=largeDOUBLE}setDefaultsHistory(){this.historyDay0=1;this.historyDay1=31;this.historyMon0=1;this.historyMon1=12;this.historyYear0=-99999;this.historyYear1=99999;this.historyHour0=0;this.historyHour1=23;this.historyMinute0=0;this.historyMinute1=59;this.historyUser="*";this.historyAction="*";this.historyDescr="*"}setDefaultsMetaData(){this.mvRangeVarIds=[];this.mvRangeMinVals=[];this.mvRangeMaxVals=[];this.mvWildCardVarIds=[];this.mvWildCardExprs=[];this.mvWildCardCases=[]}setDefaultsNameRange(){this.cruise="*";this.statNameMin="0";this.statNameMax="99999999";this.statIdMin=0;this.statIdMax=99999999;this.statType="*";this.smplCountMin=0;this.smplCountMax=99999999}toXml(){return"<StationSelectionCriteria is_inverting='"+this.invert+"'> <Names cruise='"+escapedStr(this.cruise)+"' station_type='"+this.statType+"' first_station='"+this.statNameMin+"' last_station='"+this.statNameMax+"'/> <Range first_station_id='"+this.statIdMin+"' last_station_id='"+this.statIdMax+"' sample_count_min='"+this.smplCountMin+"' sample_count_max='"+this.smplCountMax+"'/> <Period first_day='"+this.periodDay0+"' last_day='"+this.periodDay1+"' last_year='"+this.periodYear1+"' last_month='"+this.periodMon1+"' first_month='"+this.periodMon0+"' first_year='"+this.periodYear0+"' first_hour='"+this.periodHour0+"' last_hour='"+this.periodHour1+"' first_minute='"+this.periodMinute0+"' last_minute='"+this.periodMinute1+"'/> <Season first_day='"+this.seasonDay0+"' last_day='"+this.seasonDay1+"' last_month='"+this.seasonMon1+"' first_month='"+this.seasonMon0+"'/> <DayTime last_hour='"+this.dayTimHour1+"' first_minute='"+this.dayTimMin0+"' last_minute='"+this.dayTimMin1+"' first_hour='"+this.dayTimHour0+"'/> <RequiredVars use_or_logic='"+this.reqVarIsOrLogic+"' var_ids='"+this.reqVarIds.join()+"'/> "+this.toXmlDomain()+this.toXmlMetaData()+" <HistoryPeriod first_day='"+this.historyDay0+"' last_day='"+this.historyDay1+"' last_year='"+this.historyYear1+"' last_month='"+this.historyMon1+"' first_month='"+this.historyMon0+"' first_year='"+this.historyYear0+"' first_hour='"+this.historyHour0+"' last_hour='"+this.historyHour1+"' first_minute='"+this.historyMinute0+"' last_minute='"+this.historyMinute1+"'/> <HistoryWildCardExpressions user='"+this.historyUser+"' action='"+this.historyAction+"' description='"+this.historyDescr+"'/> </StationSelectionCriteria>"}toXmlDomain(){let t="";if(this.wLonDom!=missDOUBLE)t+="<Domain lat_min='"+this.sLatDom+"' lat_max='"+this.nLatDom+"' lon_min='"+this.wLonDom+"' lon_max='"+this.eLonDom+"'/>";else if(this.xPoly.length>0){t+="<Polygon> <xValues>"+this.xPoly.join()+"</xValues> <yValues>"+this.yPoly.join()+"</yValues> </Polygon>"}else if(this.xPolyPix.length>0)t+="<PolygonPix> <xValues>"+this.xPolyPix.join()+"</xValues> <yValues>"+this.yPolyPix.join()+"</yValues> </PolygonPix>";return t}toXmlMetaData(){let t,e="";for(t=0;t<this.mvRangeVarIds.length;++t)e+="<MetaVarRange var_id='"+this.mvRangeVarIds[t]+"' min_value='"+this.mvRangeMinVals[t]+"' max_value='"+this.mvRangeMaxVals[t]+"'/> ";for(t=0;t<this.mvWildCardVarIds.length;++t)e+="<MetaVarWildCardExpression var_id='"+this.mvWildCardVarIds[t]+"' wildcard_expression='"+this.mvWildCardExprs[t]+"' case_sensitive='"+this.mvWildCardCases[t]+"'/>";return e}}"use strict";let websocket=null;function onWebSocketClose(t){hideMenus();gridContainer.style.display="none";consoleMsg("DISCONNECTED",true);let e=appState.current();appState.clear();if(!(e==WaitingState||e==PopupState))showAlert("<b>Server connection lost</b>")}function onWebSocketError(t){consoleMsg("ERROR: "+t.data,true)}function onWebSocketMessage(t){consoleMsg("received:\t"+t.data);if(t.data instanceof Blob)processWebSocketBlobMessage(new Blob([t.data]));else processWebSocketTextMessage(t.data)}function onWebSocketOpen(t){consoleMsg("CONNECTED",true);sendClientSessionRequest()}function sendWebSocketMessage(){if(websocket!=null){if(isLocalHost)sessionId=$("Identifier").value;sendWsMsg($("InputText").value);$("InputText").value=""}controlBlock.blur()}function sendWsMsg(t){if(websocket==null)return;if(websocket.readyState==1){for(let e=0;e<startWaitingCmds.length;++e){if(t.indexOf(startWaitingCmds[e])>-1){startWaitingFor(startWaitingCmds[e]);break}}if(t.indexOf(getCanvasWindowCmdName)>-1)cnvsState=WaitingState;let e='{"sender_id":"'+sessionId+'","cmds":['+t+"]}";websocket.send(e);consoleMsg("\nsent:\t\t"+e)}else dlgMsgBox("Server is disconnected")}function webSocketStartup(){try{if(typeof MozWebSocket=="function")WebSocket=MozWebSocket;if(websocket&&websocket.readyState==1)websocket.close();websocket=new WebSocket(wsUri);websocket.onclose=onWebSocketClose;websocket.onerror=onWebSocketError;websocket.onopen=onWebSocketOpen;websocket.onmessage=onWebSocketMessage}catch(t){consoleMsg("ERROR: "+t,true)}}"use strict";function $(t){return document.getElementById(t)}function $$(t,e){return t.getElementsByTagName(e)}function abbrevW(t,e=false){if(t==0)return"M";else if(t>0)return e?t.toString():"D";else return"C"}function checkBoxState(t){return isChecked(t)?"T":"F"}function closestIndexOf(t,e){let i=-1,a=1e10,s;t.map((t,l)=>{s=Math.abs(t-e);if(s<a){i=l;a=s}});return i}function colorClassFromOdvFlag(t){switch(t){case"0":return"is-darkgreen";case"1":return"is-black";case"4":return"is-darkred";case"8":return"is-red";default:return"is-black"}}function consoleMsg(t,e=false){if(e||isLocalHost&&$("showMsgCb").checked)console.log(t+"\n")}function countInfoString(t,e,i){if(t==e)return"All "+t+" "+i;else return t+" of "+e+" "+i}function createElem(t,e,i){let a=document.createElement(t);a.id=e;a.className=i;document.body.appendChild(a);return a}function escapedStr(t){return t.replace(/["']/g,"\\$&")}function fullVarLabel(t,e){let i=t;if(e!=undefined&&e.length>0)i+=" ["+e+"]";return i}function gObjName(t){switch(t){case 1:return"Annotation";case 5:return"Symbol";case 11:case 12:return"Path Object";case 15:return"Cdt File";case 30:return"Symbol Set";case 40:return"Legends";case 41:return"Unit Dot";case 42:return"Unit Arrow";default:return""}}function identifyConversionIdx(t,e){let i,a=e.length,s=t.toLowerCase();if((s.indexOf("latitude")>-1||s.indexOf("longitude")>-1)&&s.indexOf("[deg min]")==-1)return-1;for(i=0;i<a;++i)if(e[i].indexOf(s)>-1)return i;return-1}function identifyTimeConversionIdx(t,e){let i,a,s=e.length,l,r=t.toLowerCase(),n,o="";if(r.length<5)return-1;if(r=="date"||r=="time")return-1;if((l=identifyConversionIdx(r,e))>-1)return l;if(r.indexOf("day")>-1)o="day";else if(r.indexOf("hour")>-1)o="hour";else if(r.indexOf("minute")>-1)o="minute";else if(r.indexOf("second")>-1)o="second";else if(r.indexOf("year")>-1)o="year";if(o.length>0&&r.indexOf("since")>-1){for(i=0;i<s;++i){n=e[i];a=n.indexOf(">>");if(a>-1)n=n.substr(0,a);if(n.indexOf(o)>-1&&n.indexOf("since")>-1)return i}}return-1}function indexOf(t,e,i){return t.findIndex(t=>t[e]==i)}function indexOf2(t,e,i,a,s){return t.findIndex(t=>t[e]==i&&t[a]==s)}function intArray(t,e){let i=[],a;for(a=0;a<e;++a)i.push(t+a);return i}function isChecked(t){return $(t).checked}function mouseEventSummary(t){return"button: "+t.button+"  altKey: "+t.altKey+"  ctrlKey: "+t.ctrlKey+"  metaKey: "+t.metaKey+"  detail: "+t.detail+"  type: "+t.type}function moveElem(t,e,i){let a=t[e];t.splice(e,1);t.splice(i,0,a)}function numFromElem(t,e){let i=$(t);if(i==null||typeof i=="undefined")return e;else return numFromStr(i.value,e)}function noOp(){}function numFromStr(t,e){let i=parseFloat(t);if(isNaN(i))return e;else return i}function numToStr(t,e=""){if(isNaN(t)||t==missDOUBLE||t==largeDOUBLE)return e;else return t.toString()}function openBlobAsPage(t,e,i){if(window.navigator&&window.navigator.msSaveOrOpenBlob){window.navigator.msSaveOrOpenBlob(t,e)}else if(sysInfo.browserName=="Safari"){saveBlobAs(t,e)}else{let e=URL.createObjectURL(t);window.open(e,i);URL.revokeObjectURL(e)}}function padZeros(t,e){return("000000000"+t).substr(-e)}function paletteName(t){if(t==-1)return"Odv";else if(t==0)return view.mapWin.palName;else if(t>0)return view.dataWinArr[t-1].palName}function roundedVal(t,e){return parseFloat(t.toFixed(e))}function saveBlobAs(t,e){if(window.navigator&&window.navigator.msSaveOrOpenBlob){window.navigator.msSaveOrOpenBlob(t,e)}else{let i=document.createElement("a");document.body.appendChild(i);i.style="display: none";let a=window.URL.createObjectURL(t);i.href=a;i.download=e;i.click();window.URL.revokeObjectURL(a)}}function select(t){t.classList.add("is-selected")}function selectedNum(t,e){return parseFloat(selectedStr(t,e))}function selectedNums(t){return selectedStrs(t).map(t=>parseFloat(t))}function selectedOption(t){let e=$(t);if(typeof e=="undefined")return null;let i=e.selectedIndex;if(i==-1)return null;return e.options[i]}function selectedStr(t,e){let i=selectedOption(t);return i==null?e:i.value}function selectedStrs(t){return Array.from($(t).options).filter(t=>t.selected).map(t=>t.value)}function setDisplay(t,e=false){let i=$(t);if(!i)return;if(e)i.classList.remove("is-displaynone");else i.classList.add("is-displaynone");if(i.type=="checkbox"){let t=i.nextElementSibling;if(e)t.classList.remove("is-displaynone");else t.classList.add("is-displaynone")}}function setElemEnabled(t,e){let i=$(t);if(!i)return;if(e)i.classList.remove("disabled");else i.classList.add("disabled")}function setInputElemStr(t,e){let i=$(t);if(typeof i=="undefined")return;i.value=e}function setSiblingsValue(t){let e=$(t);e.value=e.previousSibling.selectedOptions[0].innerText}function setViewName(t){if(t.startsWith("$")&&t.endsWith("$"))viewName=t.substring(1,t.length-1);else viewName=t}function setVisibility(t,e=false){let i=$(t);if(typeof i=="undefined")return;if(e)i.classList.remove("is-hidden");else i.classList.add("is-hidden")}function strFromElem(t,e){let i=$(t);if(typeof i=="undefined")return e;else return i.value}function strippedArray(t,e){return t.filter((t,i)=>e.indexOf(i)==-1)}function systemInfo(){let t=navigator.userAgent,e,i,a;let s="unknown",l="unknown",r="unknown";if(t.indexOf("Win")>-1)s="Windows";if(t.indexOf("Mac")>-1)s="MacOS";if(t.indexOf("X11")>-1)s="UNIX";if(t.indexOf("Linux")>-1)s="Linux";if((i=t.indexOf("OPR/"))!=-1){l="Opera";r=t.substring(i+4)}else if((i=t.indexOf("Opera"))!=-1){l="Opera";r=t.substring(i+6);if((i=t.indexOf("Version"))!=-1)r=t.substring(i+8)}else if((i=t.indexOf("MSIE"))!=-1){l="Internet Explorer";r=t.substring(i+5)}else if((i=t.indexOf("Edge"))!=-1){l="Edge";r=t.substring(i+5)}else if((i=t.indexOf("Chrome"))!=-1){l="Chrome";r=t.substring(i+7)}else if((i=t.indexOf("Safari"))!=-1){l="Safari";r=t.substring(i+7);if((i=t.indexOf("Version"))!=-1)r=t.substring(i+8)}else if((i=t.indexOf("Firefox"))!=-1){l="Firefox";r=t.substring(i+8)}else if((a=t.lastIndexOf(" ")+1)<(i=t.lastIndexOf("/"))){l=t.substring(a,i);r=t.substring(i+1);if(l.toLowerCase()==l.toUpperCase())l=navigator.appName}if((e=r.indexOf(";"))!=-1)r=r.substring(0,e);if((e=r.indexOf(" "))!=-1)r=r.substring(0,e);if((e=r.indexOf("."))!=-1)r=parseInt(r.substring(0,e));let n=t;return{osName:s,browserName:l,browserVersion:r,userAgent:n}}function tableItem(t){let e=t.split(":"),i;let a=e[0],s=parseInt(e[1]),l=parseInt(e[2]);switch(a){case"D1":if(l==0)i=dockMetaVarLabels[s];else if(l==1)i=dockMetaValues[s];break;case"D2":if(l==0)i=dockDataVarLabels[s];else if(l==1)i=dockDataValues[s];else if(l==2)i=dockDataFlags[s];else if(l==3)i=dockDataInfoValues[s];break}return{tbl:a,row:s,col:l,val:i}}function textAlignIdx(t,e){let i,a=xAlignIdx.length;for(i=0;i<a;++i)if(t==xAlignIdx[i]&&e==yAlignIdx[i])return i;return 0}function titleW(t,e){return t+" - Window "+e}function toBool(t){return t=="T"?true:false}function toJsonNumericArray(t,e){return'"'+t+'":['+e.join()+"]"}function toNumericArray(t){return t.split(",").map(t=>parseFloat(t))}function toStrOrAutomatic(t){return t==largeDOUBLE?"(automatic)":t}function unselect(t){t.classList.remove("is-selected")}function valueTypeStrArr(){return["FLOAT","DOUBLE","INTEGER","SHORT","SIGNED_BYTE","UNSIGNED_INTEGER","UNSIGNED_SHORT","BYTE","TEXT","INDEXED_TEXT"]}function valueBytes(t,e=21){const i=[4,8,4,2,1,4,2,1,e,4];let a=valueTypeStrArr().indexOf(t);return a>-1?i[a]:4}function xmlNum(t,e,i){if(t.hasOwnProperty(e))return parseFloat(t[e].nodeValue);else return i}function xmlStr(t,e,i){if(t.hasOwnProperty(e))return t[e].nodeValue;else return i}class AppState{constructor(){this.clear()}clear(){this.statesArr=[WaitingState]}current(){return this.statesArr[this.statesArr.length-1]}enter(t){let e=this.current();this.statesArr.push(t);return e}leave(t){let e=t==undefined?true:this.current()==t;if(e)this.statesArr.pop();return this.current()}}class XSelector{constructor(t,e=false,i=true){this.itArr=t;this.multiSelect=e;this.ignoreFirst=i}clear(){this.itArr.map(t=>t.classList.remove("is-selected"))}firstSelection(){let t=this.selections();return t.length>0?t[0]:-1}invert(){this.itArr.map(t=>t.classList.toggle("is-selected"));if(this.ignoreFirst)this.itArr[0].classList.remove("is-selected")}scrollTo(t){this.itArr[t].scrollIntoView({block:"center"})}select(t,e=false,i=false){if(e&&this.multiSelect){let e=this.selections(),i,a=t,s=t;if(e.length>0){i=e[closestIndexOf(e,t)];a=Math.min(t,i);s=Math.max(t,i)}this.clear();for(i=a;i<=s;++i)this.itArr[i].classList.add("is-selected")}else if(i&&this.multiSelect){this.itArr[t].classList.toggle("is-selected")}else{this.clear();this.itArr[t].classList.add("is-selected")}}selectAll(){this.clear();this.invert()}selections(){let t=[];this.itArr.map((e,i)=>{if(e.classList.contains("is-selected"))t.push(i)});return t}selectedCount(){return this.selections().length}size(){let t=this.itArr.length;if(this.ignoreFirst)--t;return t}}"use strict";function clearCanvas(t){t.clearRect(0,0,cnvs.width,cnvs.height)}function clipToRect(t,e){let i=toHtmlCanvasX(e.left);let a=toHtmlCanvasX(e.right);let s=toHtmlCanvasY(e.top);let l=toHtmlCanvasY(e.bottom);t.beginPath();t.moveTo(i,s);t.lineTo(a,s);t.lineTo(a,l);t.lineTo(i,l);t.lineTo(i,s);t.closePath();t.clip()}function drawCrossHair(t,e,i,a,s){let l=toHtmlCanvasX(e);let r=toHtmlCanvasY(i);t.beginPath();t.moveTo(l-a,r);t.lineTo(l+a,r);t.moveTo(l,r-a);t.lineTo(l,r+a);t.stroke();drawDot(t,l,r,1.25*s)}function drawCurrGObjPolygon(t,e,i){if(Math.abs(e)<3&&Math.abs(e)<3)return;let a=gObjInfoArr[lclickGObjIdx],s=a.x_coords,l=a.y_coords,r,n=s.length;clearCanvas(t);t.save();t.setLineDash([6,6]);t.strokeStyle="#444";t.beginPath();t.moveTo(toHtmlCanvasX(s[0])+e,toHtmlCanvasY(l[0])+i);for(r=1;r<n;r++){t.lineTo(toHtmlCanvasX(s[r])+e,toHtmlCanvasY(l[r])+i)}t.stroke();t.restore()}function drawCurve(t,e,i){let a,s=e.length;t.beginPath();t.moveTo(toHtmlCanvasX(e[0]),toHtmlCanvasY(i[0]));for(a=1;a<s;a++){t.lineTo(toHtmlCanvasX(e[a]),toHtmlCanvasY(i[a]))}t.stroke()}function drawDot(t,e,i,a){t.beginPath();t.arc(e,i,a,0,2*Math.PI,true);t.fill();t.stroke()}function drawDots(t,e,i,a){let s,l=e.length;for(s=0;s<l;s++)drawDot(t,toHtmlCanvasX(e[s]),toHtmlCanvasY(i[s]),a)}function drawDataCurve(t,e,i){t.save();clipToRect(t,e.rect);drawCurve(t,e.x_coords,e.y_coords);if(i>0)drawDots(t,e.x_coords,e.y_coords,i);t.restore()}function drawHighlighting(t){if(appState.current()!=ReadyState||cnvsState!=ReadyState)return;const e=2,i=12;clearCanvas(t);t.lineWidth=1;t.strokeStyle="red";t.fillStyle="red";let a,s,l,r,n;if(hlPolylines!=null){s=hlPolylines.length;for(a=0;a<s;a++){l=highlightStyles[a+1];if(l==3)continue;t.save();clipToRect(t,hlPolylines[a].rect);if(l==0||l==2)drawCurve(t,hlPolylines[a].x_coords,hlPolylines[a].y_coords);if(hlDrawDataDots&&(l==1||l==2))drawDots(t,hlPolylines[a].x_coords,hlPolylines[a].y_coords,e);t.restore()}}if(hlPoints!=null){s=hlPoints.x_coords.length;for(a=0;a<s;a++){r=hlPoints.x_coords[a];n=hlPoints.y_coords[a];if(isInsideRect(r,n,odvCnvsRects[hlPoints.win_ids[a]]))drawCrossHair(t,r,n,i,e)}}}function drawPointGetterPoly(t){let e,i=ptgCnvsX.length;if(i==0)return;const a=4;clearCanvas(t);t.fillStyle="white";t.strokeStyle="red";t.lineWidth="2";t.beginPath();t.moveTo(ptgCnvsX[0],ptgCnvsY[0]);for(e=1;e<i;++e){t.lineTo(ptgCnvsX[e],ptgCnvsY[e])}if(currWinId==ptgWinId)t.lineTo(currCnvsX,currCnvsY);t.stroke();t.strokeStyle="gray";t.lineWidth=1;for(e=0;e<i;++e){drawDot(t,ptgCnvsX[e],ptgCnvsY[e],a)}}function drawQuickZoomRect(t){let e=Math.abs(currCnvsX-beginCnvsX);let i=Math.abs(currCnvsY-beginCnvsY);if(e<2&&i<2)return;clearCanvas(t);t.beginPath();t.moveTo(currCnvsX,currCnvsY);t.lineTo(currCnvsX,beginCnvsY);t.lineTo(beginCnvsX,beginCnvsY);t.lineTo(beginCnvsX,currCnvsY);t.lineTo(currCnvsX,currCnvsY);t.stroke()}function drawZoomRect(t){const e=zoomPixTol-6;clearCanvas(t);t.fillStyle="white";t.strokeStyle="red";t.lineWidth=2;t.beginPath();t.moveTo(zoomCnvsLeft,zoomCnvsBottom);t.lineTo(zoomCnvsRight,zoomCnvsBottom);t.lineTo(zoomCnvsRight,zoomCnvsTop);t.lineTo(zoomCnvsLeft,zoomCnvsTop);t.lineTo(zoomCnvsLeft,zoomCnvsBottom);t.stroke();t.strokeStyle="gray";t.lineWidth=1;let i=appState.current();if(i==ZoomingState){drawDot(t,zoomCnvsLeft,zoomCnvsBottom,e);drawDot(t,zoomCnvsRight,zoomCnvsBottom,e);drawDot(t,zoomCnvsRight,zoomCnvsTop,e);drawDot(t,zoomCnvsLeft,zoomCnvsTop,e)}if(i==ZoomingState||i==ZZoomingVerState){drawDot(t,.5*(zoomCnvsLeft+zoomCnvsRight),zoomCnvsBottom,e);drawDot(t,.5*(zoomCnvsLeft+zoomCnvsRight),zoomCnvsTop,e)}if(i==ZoomingState||i==ZZoomingHorState){drawDot(t,zoomCnvsLeft,.5*(zoomCnvsBottom+zoomCnvsTop),e);drawDot(t,zoomCnvsRight,.5*(zoomCnvsBottom+zoomCnvsTop),e)}}function ellipsePathFromRect(t,e,i,a,s,l){const r=50;let n,o,d=2*Math.PI/(r-1);let m=.5*(t-e),c=.5*(i-a);let u=.5*(t+e),p=.5*(i+a);s.length=0;l.length=0;for(n=0;n<r;n++){o=n*d;s.push(u+Math.cos(o)*m);l.push(p+Math.sin(o)*c)}s.push(s[0]);l.push(l[0])}function gObjectsAt(t,e){if(imgOdvCnvsLeft==-1)return"";let i=[],a,s,l=gObjInfoArr.length,r="";currGObjIdx=-1;for(s=0;s<l;++s){a=gObjInfoArr[s];if(isInsidePolygon(t,e,a.x_coords,a.y_coords)){r=abbrevW(a.win_id,true)+"."+(a.index+1);if(i.indexOf(r)==-1)i.push(r);if(currGObjIdx==-1)currGObjIdx=s}}return i.join(", ")}function isInsidePolygon(t,e,i,a){let s,l=0,r=i.length,n;for(s=0;s<r;++s)if(a[s]==e)a[s]+=1e-6*a[s];for(s=0;s<r-1;++s){if(a[s]!=a[s+1]){n=(e-a[s])/(a[s+1]-a[s]);if(n>=0&&n<=1&&i[s]+n*(i[s+1]-i[s])>=t)++l}}return l%2}function isInsideRect(t,e,i){if(t>=i.left&&t<=i.right&&e>=i.top&&e<=i.bottom)return true;else return false}function isInsideWindow(t,e,i){let a=odvCnvsPolygons[i],s=a.x_coords,l=a.y_coords,r=s.length;if(r>5)return isInsidePolygon(t,e,s,l)==1?true:false;else return isInsideRect(t,e,odvCnvsRects[i])}function rectPathFromRect(t,e,i,a,s,l){s.length=0;l.length=0;s.push(t);l.push(i);s.push(e);l.push(i);s.push(e);l.push(a);s.push(t);l.push(a);s.push(t);l.push(i)}function rememberPenAndBrushStyles(){ctxLineWidth=ctx.lineWidth;ctxStrokeStyle=ctx.strokeStyle;ctxFillStyle=ctx.fillStyle}function restorePenAndBrushStyles(){ctx.lineWidth=ctxLineWidth;ctx.strokeStyle=ctxStrokeStyle;ctx.fillStyle=ctxFillStyle}function scaledCnvsRect(t,e){let i={left:0,top:0,right:imgOdvCnvsRight,bottom:imgOdvCnvsBottom};if(t>=0)i={...odvCnvsRects[t]};let a=.5*(i.right+i.left),s=.5*(i.bottom+i.top);let l=.5*(i.right-i.left)*e,r=.5*(i.bottom-i.top)*e;i.left=a-l;i.top=s-r;i.right=a+l;i.bottom=s+r;return i}function toCmCanvasX(t){return(t-imgOdvCnvsLeft)/odvPixPerCm}function toCmCanvasY(t){return cmPageHeight-(t-imgOdvCnvsTop)/odvPixPerCm}function toHtmlCanvasX(t){return Math.round((t-imgOdvCnvsLeft)/odvPixPerHtmlPix)}function toHtmlCanvasY(t){return Math.round((t-imgOdvCnvsTop)/odvPixPerHtmlPix)}function toOdvCanvasX(t){return Math.round(imgOdvCnvsLeft+t*odvPixPerHtmlPix)}function toOdvCanvasY(t){return Math.round(imgOdvCnvsTop+t*odvPixPerHtmlPix)}function toUsrX(t,e){let i=e==0?view.mapWin:view.dataWinArr[e-1];let a=isGeoMap[e],s=missDOUBLE;if(a&&view.mapWin.prjType==0||!a&&i.xProj==0){let a=odvCnvsRects[e];s=i.xLeft+(i.xRight-i.xLeft)*(t-a.left)/(a.right-a.left)}return s}function toUsrY(t,e){let i=e==0?view.mapWin:view.dataWinArr[e-1];let a=isGeoMap[e],s=missDOUBLE;if(a&&view.mapWin.prjType==0||!a&&i.yProj==0){let a=odvCnvsRects[e];s=i.yBottom+(i.yTop-i.yBottom)*(t-a.bottom)/(a.top-a.bottom)}return s}function updateZoomSpot(){let t,e,i,a;t=e=i=a=false;let s=appState.current();if(s==ZoomingState||s==ZZoomingHorState){t=Math.abs(currCnvsX-zoomCnvsLeft)<=zoomPixTol;e=Math.abs(currCnvsX-zoomCnvsRight)<=zoomPixTol}if(s==ZoomingState||s==ZZoomingVerState){i=Math.abs(currCnvsY-zoomCnvsBottom)<=zoomPixTol;a=Math.abs(currCnvsY-zoomCnvsTop)<=zoomPixTol}let l=currCnvsX>=zoomCnvsLeft&&currCnvsX<=zoomCnvsRight;let r=currCnvsY>=zoomCnvsTop&&currCnvsY<=zoomCnvsBottom;if(t&&i){zoomSpotId=1;document.body.style.cursor="ne-resize"}else if(e&&a){zoomSpotId=2;document.body.style.cursor="ne-resize"}else if(e&&i){zoomSpotId=3;document.body.style.cursor="nw-resize"}else if(t&&a){zoomSpotId=4;document.body.style.cursor="nw-resize"}else if(a&&l){zoomSpotId=5;document.body.style.cursor="n-resize"}else if(t&&r){zoomSpotId=6;document.body.style.cursor="e-resize"}else if(i&&l){zoomSpotId=7;document.body.style.cursor="n-resize"}else if(e&&r){zoomSpotId=8;document.body.style.cursor="e-resize"}else if(l&&r){zoomSpotId=9;document.body.style.cursor="move"}else{zoomSpotId=-1;document.body.style.cursor="default"}}function windowIdAt(t,e){if(imgOdvCnvsLeft==-1)return-1e3;let i=windowIdsAt(t,e),a=i.length;return a>0?i[a-1]:-1}function windowIdsAt(t,e){let i,a=odvCnvsRects.length,s=[];if(imgOdvCnvsLeft==-1)return s;if(isInsideWindow(t,e,0)==true){s.push(0);return s}for(i=1;i<a;i++){if(isInsideWindow(t,e,i)==true)s.push(i)}if(s.length==0)s.push(-1);return s}function windowIdAtHtmlCoords(t,e){return windowIdAt(toOdvCanvasX(t),toOdvCanvasY(e))}"use strict";class Html{static button(t,e,i){let a='<button onClick="'+e+';"';if(i!=undefined)a+=' id="'+i+'"';return a+">"+t+"</button>"}static checkBox(t,e,i){let a='<span> <input type="checkbox" id="'+t+'"';if(i!=0)a+=" checked";a+='> <label for="'+t+'">'+e+"</label> </span>";return a}static checkBoxTF(t,e,i){return Html.checkBox(t,e,toBool(i))}static colorOption(t,e,i,a,s){let l=t.toString()+"&emsp;&emsp;";if(t==-2)l="(automatic)";else if(t==-1)l="(none)";let r='<option class="colorOption" style="'+Html.colorStyle(e,i,a)+'" value="'+t+'"';if(t==s)r+=" selected";r+=">"+l+"</option>";return r}static colorStyle(t,e,i){let a=t+e+i<290?"white":"black";return"color:"+a+";background-color:rgb("+t+","+e+","+i+");"}static dlgBtn(t,e="Apply",i="xxx"){return'<p style="clear:both">'+Html.dlgBtnC(t,e,i)+"</p>"}static dlgBtnC(t,e="Apply",i="xxx"){let a="<button";if(i!="xxx")a+=' id="'+i+'"';a+=' class="is-dlgcolor" onClick="'+t+';"><b>'+e+"</b></button>";return a}static drvdVarChoices(t){let e,i='<ul id="'+t+'" class="TreeView">';for(let t=0;t<drvdVarGroups.length;++t){e=drvdVarGroups[t].name;i+=' <li><span id="'+e+'" class="tree-group-node">'+e+"</span>";i+=' <ul class="tree-nested-list">';for(let e=0;e<drvdVarGroups[t].types.length;++e){let a=drvdVarChoice(drvdVarGroups[t].types[e]);i+='<li class="tree-item-node" value="'+a.type+'">'+fullVarLabel(a.uname,a.uunit)+"</li>"}i+=" </ul></li>"}i+="</ul>";return i}static layoutTemplateMenu(){const t="Applies a predefined window layout.";let e=Html.menuItem("miFullScreenMap","Full Screen Map",t);e+=Html.menuSep();e+=Html.menuItem("miOnePickWin","1 STATION Window",t);e+=Html.menuItem("miTwoPickWin","2 STATION Windows",t);e+=Html.menuItem("miSixPickWin","6 STATION Windows",t);e+=Html.menuSep();e+=Html.menuItem("miOneScatterWin","1 SCATTER Window",t);e+=Html.menuItem("miTwoScatterWin","2 SCATTER Windows",t);e+=Html.menuItem("miSixScatterWin","6 SCATTER Windows",t);e+=Html.menuSep();e+=Html.menuItem("miOneSectionWin","1 SECTION Window",t);e+=Html.menuItem("miTwoSectionWin","2 SECTION Windows",t);e+=Html.menuItem("miThreeSectionWin","3 SECTION Windows",t);e+=Html.menuItem("miFiveSectionWin","5 SECTION Windows",t);e+=Html.menuItem("miSixSectionWin","6 SECTION Windows",t);e+=Html.menuSep();e+=Html.menuItem("miOneIsoSurfaceWin","1 SURFACE Window",t);e+=Html.menuItem("miTwoIsoSurfaceWin","2 SURFACE Windows",t);e+=Html.menuItem("miThreeIsoSurfaceWin","3 SURFACE Windows",t);e+=Html.menuItem("miFiveIsoSurfaceWin","5 SURFACE Windows",t);e+=Html.menuSep();e+=Html.menuItem("miFiveMixedWin","5 MIXED Windows",t);return e}static listInput(t,e,i="",a="7em",s="off"){if(e.length>0){let l=t+"Lst";let r='<input id="'+t+'" list="'+l+'" autocomplete="'+s+'" style="width:'+a+';" value="'+i+'"/> <datalist id="'+l+'">';e.map(t=>r+='<option value="'+t+'"/>');return r+"</datalist>"}else return Html.txtInput(t,i,a,s)}static mainMenuItem(t){let e=t+"Menu";return'<span id="'+e+'" class="main-menu-item" onMouseEnter="showMainMenu(\''+e+"')\">"+t+"</span>"}static menuItem(t,e,i,a){if(i!=undefined)menuOptionDescriptions.set(t,i);let s='<li id="'+t+'" class="menu-item" onClick="processMenuOption(\''+t+"')\" onmouseenter=\"onMouseEnterMenuItem('"+t+"')\">"+e;if(a!=undefined){s+=' <span style="float:right">'+a+"</span>";menuOptionsByKeyName.set(a,t)}return s+"</li>"}static menuSep(){return'<li class="menu-separator"><hr></li>'}static minMaxEntry(t,e,i,a,s,l,r){if(e<=-1)return"";let n=Math.min(l,r),o=Math.max(l,r);dlgOrigVals.set(a,n);dlgOrigVals.set(s,o);let d="",m=t==3?dockIsoVarLabels[e]:dataVarFullLabel(e);if(m=="")m=i;if(i!="X Axis")d+='<tr><td colspan="2">&nbsp;</td></tr>';d+='<tr><td colspan="2"><b>'+m+"</b></td></tr>";d+="<tr><td>Minimum:</td><td>"+Html.txtInput(a,n)+"</td></tr>";d+="<tr><td>Maximum:</td><td>"+Html.txtInput(s,o)+"</td></tr>";return d}static noResults(){return'<p class="is-red">&emsp;No results</p>'}static numInput(t,e,i,a,s=1){return'<input type="number" id="'+t+'" min="'+i+'" max="'+a+'" step="'+s+'" value="'+e+'"/>'}static option(t,e,i){let a='<option value="'+t+'"';if(i.indexOf(t)>-1)a+=" selected";a+=">"+e+"</option>";return a}static panelBegin(t,e,i,a=false){let s='<input name="tabPanel" id="tabPanel'+e+'" type="radio" onClick="setLastOpenElem(\''+t+"','"+e+"')\"";if(a)s+=" checked";s+='><section><h1><label for="tabPanel'+e+'">'+i+"</label></h1><div>";return s}static panelEnd(){return"</div></section>"}static popupDlg(t){return'<div id="PopupDlg'+t+'" class="PopupDlg"> <div id="DlgHeader'+t+'" class="DlgHeader"> <span id="DlgTitle'+t+'" class="DlgTitle"></span> &emsp;&emsp; <span id="DlgCloseBtn'+t+'" class="DlgCloseBtn" onclick="hideDlg(false)">&times;</span> </div> <div id="DlgContents'+t+'" class="DlgContents"></div> <div id="DlgMessage'+t+'" class="DlgMessage"></div> <div id="DlgFooter'+t+'" class="DlgFooter"></div> </div> '}static selectList(t,e,i,a,s=0,l=-1,r=""){let n=[];n.push(a);return Html.selectListEx(t,e,i,n,s,l,r)}static selectListAggrVarConversion(t,e){return Html.selectList(t,varCnvIds,varCnvLbls,e)}static selectListAlignX(t,e){return Html.selectList(t,[0,1,2],["left","center","right"],e)}static selectListAlignY(t,e){return Html.selectList(t,[0,1,2],["top","center","bottom"],e)}static selectListAxisPosition(t,e,i){let a=[];if(e=="X")a=["no axis","bottom","top"];else if(e=="Y")a=["no axis","left","right"];else if(e=="Z")a=["no colorbar","right","bottom"];return Html.selectList(t,[0,1,2],a,i)}static selectListAxisProjection(t,e,i){const a=e=="X"?"left":"bottom";const s=e=="X"?"right":"top";let l=[0,1,10,11,12,13,14,15],r=["Linear","Logarithmic","Stretched "+a+" part","Stretched "+a+" part (strong)","Stretched middle part","Stretched middle part (strong)","Stretched "+s+" part","Stretched "+s+" part (strong)"];return Html.selectList(t,l,r,i)}static selectListColor(t,e,i,a=false,s=false){let l=paletteIndex(e);let r=paletteReds[l],n=paletteGreens[l],o=paletteBlues[l];let d=i;let m='<select class="ColorSelectList" palidx="'+l+'" onchange="onColorSelectChange(\''+t+'\')" id="'+t+'" style="'+Html.colorStyle(r[d],n[d],o[d])+'">';if(s)m+=Html.colorOption(-2,255,255,255,i);if(a)m+=Html.colorOption(-1,255,255,255,i);for(d=0;d<r.length;d++){m+=Html.colorOption(d,r[d],n[d],o[d],i)}m+="</select>";return m}static selectListContents(t,e,i,a=-1,s=""){let l="";if(s!=="")l+=Html.option(a,s,i);for(let a=0;a<e.length;a++){l+=Html.option(t[a],e[a],i)}return l}static selectListContourLabelCount(t,e){return Html.selectList(t,[0,1,2],["no labels","few labels","many labels"],e)}static selectListDay(t,e){let i=intArray(1,31),a=i.map(t=>padZeros(t,2));return Html.selectList(t,i,a,e)}static selectListEditable(t,e,i="",a=16){let s='<div class="select-editable">';s+="<select onchange=\"setSiblingsValue('"+t+'\')" style="width:'+a+'em;">';s+=Html.selectListContents(e,e,[])+"</select>";s+='<input type="text" id="'+t+'" value="'+i+'" style="width:'+(a-1.7)+'em;"/>';return s+"</div>"}static selectListEx(t,e,i,a,s=0,l=-1,r=""){let n='<select class="is-12ptfontsize" id="'+t+'"';if(s==1){n+=' size="'+Math.min(10,i.length)+'" multiple'}n+=">";n+=Html.selectListContents(e,i,a,l,r);n+="</select>";return n}static selectListGObjCoords(t,e,i){let a=[-1],s=["Canvas"],l=i.ownCoords=="T"?e:-1;if(e>-1){a.push(e);s.push(windowNameFromId(e))}return Html.selectList(t,a,s,l)}static selectListGObjOwner(t,e,i){let a=[-1,0],s=["Canvas","Map"],l,r=view.dataWinArr.length;for(l=1;l<=r;++l){a.push(l);s.push(windowNameFromId(l))}return Html.selectList(t,a,s,e)}static selectListHighlighting(t,e){return Html.selectList(t,[0,1,2,3],["curve","dots","curve and dots","(none)"],e)}static selectListHour(t,e){let i=intArray(0,24),a=i.map(t=>padZeros(t,2));return Html.selectList(t,i,a,e)}static selectListLineStartEnd(t,e){return Html.selectList(t,[-1,0,1,2,3],["(none)","arrow head","filled dot","open dot","bar"],e)}static selectListLineStyle(t,e){return Html.selectList(t,[0,1,2,3,4],["solid","dashed","dotted","dash-dot","dash-dot-dot"],e)}static selectListLineWidth(t,e,i=false){let a=[-1,0,1,2,3,4,5,6,7],s=["(none)","very thin","thin","thin medium","medium","medium thick","thick","very thick","extra thick"];if(i){a.unshift(-1);s.unshift("(none)")}return Html.selectList(t,a,s,e)}static selectListMinute(t,e){let i=intArray(0,60),a=i.map(t=>padZeros(t,2));return Html.selectList(t,i,a,e)}static selectListMonth(t,e){return Html.selectList(t,intArray(1,12),["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],e)}static selectListQfScheme(t,e){return Html.selectList(t,[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15],["ODV","GTSPP","ARGO","SEADATANET","ESEAS","WOD","WODSTATION","WOCEBOTTLE","WOCECTD","WOCESAMPLE","QARTOD","BODC","PANGAEA","SMHI","OCEANSITES","IODE"],e)}static selectListSymbol(t,e){return Html.selectList(t,[0,1,2,3,4,5,6,7],["dot","square","diamond","triangle","inverted triangle","*","X","+"],e)}static selectListValType(t,e){return Html.selectList(t,valueTypeStrArr(),valueTypeStrArr(),e)}static selectListVarType(t,e,i){let a=e?dataVarTypeNames:metaVarTypeNames;return Html.selectList(t,a,a,i)}static subMenu(t,e,i){return Html.subMenuStart(t,e,i)+Html.subMenuEnd()}static subMenuEnd(){return"</ul></li>"}static subMenuStart(t,e,i){const a="&#x02C3;";let s='<li class="menu-item submenu-root" onmouseenter="onMouseEnterMenuItem(\''+t+"')\">"+e+' <span style="float:right">'+a+'</span> <ul id="'+t+'" class=" dropdown-menu"';if(i!=undefined)s+=' style="width:'+i+'px;"';return s+">"}static toolTipElem(t,e,i){return"<"+t+' title="'+i+'">'+e+"</"+t+">"}static treeNodeFromArr(t,e=true){let i="",a=e?"private":"public";let s=e?"private:":"";if(t.length>0){i+=' <li><span id="'+a+'-node" class="tree-group-node">'+a+'</span> <ul class="tree-nested-list">';t.map(t=>i+=' <li class="tree-item-node" value="'+s+t+'">'+t+"</li>");i+=" </ul></li>"}return i}static treeNodeFromTree(t,e,i=true){let a="",s=i?"private":"public";if(e>0){a+=' <li><span id="'+s+'-node" class="tree-group-node">'+s+"</span>";a+=' <ul class="tree-nested-list">'+t+" </ul></li>"}return a}static txtInput(t,e="",i="7em",a="off"){return'<input type="text" id="'+t+'" autocomplete="'+a+'" style="width:'+i+';" value="'+e+'"/>'}static winGeneral(t,e,i,a,s,l,r){dlgOrigVals.set("palName",t);dlgOrigVals.set("fontSizeFac",roundedVal(e,1));dlgOrigVals.set("bckColor",i);dlgOrigVals.set("gridColor",a);dlgOrigVals.set("drawGrid",s);dlgOrigVals.set("drawLabels",l);if(r!=undefined)dlgOrigVals.set("hlStyle",r);let n='<table class="StdTable">';n+="<tr><td>Palette:</td><td>"+Html.selectList("palName",paletteNames,paletteNames,t)+"</td></tr>";n+="<tr><td>Font size [%]:</td><td>"+Html.numInput("fontSizeFac",roundedVal(e,1),0,499,5)+"</td></tr>";n+="<tr><td>Background color:</td><td>"+Html.selectListColor("bckColor",t,i,true)+"</td></tr>";n+="<tr><td>Axis color:</td><td>"+Html.selectListColor("gridColor",t,a,true)+"</td></tr>";if(r!=undefined)n+="<tr><td>Highlighting style:</td><td>"+Html.selectListHighlighting("hlStyle",r)+"</td></tr>";n+="<tr><td></td><td>"+Html.checkBoxTF("drawGrid","Draw grid",s)+"</td></tr>";n+="<tr><td></td><td>"+Html.checkBoxTF("drawLabels","Automatic axis titles",l)+"</td></tr>";n+="</table>";return n}}"use strict";const dlgA2aStr="Apply to all windows";let dlgOrigVals=new Map;let dlgLastOpenElems=new Map;let dlgPopupCount=0;function activateTree(t,e){let i=$(t);let a=i.getElementsByClassName("tree-group-node");for(let e=0;e<a.length;++e)a[e].addEventListener("click",function(){this.parentElement.querySelector(".tree-nested-list").classList.toggle("tree-nested-list-open");this.classList.toggle("tree-group-node-open");dlgLastOpenElems.set(t,this.innerHTML)});let s=i.getElementsByClassName("tree-item-node");for(let t=0;t<s.length;++t)s[t].addEventListener("click",e)}function changeInfoValue(){let t=$("queryStr").value,e=dlgOrigVals.get("queryStr");hideDlg();let i=t.length==0||e.length==0?0:1;if(t!=e)sendWsMsg('{"cmd":"assign_data_info_values","items":[{"var_id":'+(dockDataVarIds[rclickTblItem.row]+1)+',"sample_id":'+currSmplId+',"new_info_value":"'+t+'","old_info_value":"'+e+'","modify_all_instances":'+i+"}]},"+msgGetCurrInfo)}function dlgAvailability(t,e,i,a){let s,l=t.length;let r='<div id="AvailTblDiv" class="has-border">';r+='<table id="AvailTbl" class="StdTable has-altbckcolor">';r+='<tr><th width="67%">Variable</th><th width="8%">Collection</th><th width="8%">Set</th><th width="8%">Cruise</th><th width="8%">Station</th></tr>';for(s=1;s<=l;++s)r+="<tr><td>"+s+": "+dataVarFullLabel(s-1)+"</td><td>"+t[s-1]+"</td><td>"+e[s-1]+"</td><td>"+i[s-1]+"</td><td>"+a[s-1]+"</td></tr>";r+="</table></div>";showDlg("Data Availability [%]",r,Html.dlgBtn("hideDlg()","Close"))}function dlgMsgBox(t,e=""){let i=e.length>0?"<p><b>"+e+"</b></p>":"";setDisplay("DlgHeader"+(dlgPopupCount+1),false);showDlg("",i+'<p style="line-height:150%;">'+t+"</p>",Html.dlgBtn("hideDlg()","Close"))}function dlgMultiLineMsgBox(t,e,i,a){let s,l=e.length;let r='<p> <div class="has-border" style="padding:0 0 0 4px;width:'+i+"px;height:"+a+'px;overflow:auto;">';for(s=0;s<l;++s)r+="<p>"+e[s]+"</p>";r+="</div> </p>";showDlg(t,r,Html.dlgBtn("hideDlg()","Close"))}function dlgQueryFile(t,e,i){showDlg(t,'<label for="fileSelector">'+e+"</label>"+'<p><input type="file" id="fileSelector"/></p>',"");$("fileSelector").addEventListener("change",i)}function dlgQueryStr(t,e,i,a,s="Apply"){dlgOrigVals.set("queryStr",i);let l=i.length<40?"28em":"38em";showDlg(t,"<p>"+e+"</p><p>"+Html.txtInput("queryStr",i,l)+"</p>",Html.dlgBtn(a,s));let r=$("queryStr");r.focus();r.select()}function dlgSelectItem(t,e,i,a="",s=""){let l=a.length>0?"<p>"+a+"</p>":"",r=e[0];if(s.length>0){let t=e.findIndex(t=>t.includes(s));r=t==-1?"":e[t]}l+=Html.selectList("selectList",e,e,r);showDlg(t,l,Html.dlgBtn(i,"Select"));let n=$("selectList");n.size=Math.min(6,e.length);if(r.length==0)n.selectedIndex=-1}function dlgSelectQf(t,e,i,a){if(t>=VID_FIRSTDRVD)return;let s=i?dataVarQfSetIds[t]:metaVarQfSetIds[t];if(!qfSets.has(s))return;let l=i?dataVarFullLabel(t):fullVarLabel(metaVarUNames[t],metaVarUUnits[t]);let r=qfSets.get(s);let n="<p><b>"+l+"</b></p>";n+=Html.selectList("qfList",r.flags,r.flag_descriptions,e);showDlg("Assign Quality Flags",n,Html.dlgBtn(a));$("qfList").size=Math.min(10,r.flags.length)}function dlgSelectTreeItem(t,e,i,a,s=""){const l="SelectItemTree";let r,n=e.length+i.length==0;let o=s.length>0?"<p>"+s+"</p>":"";o+='<div class="TreeViewDiv has-border">';if(n)o+=Html.noResults();else o+=' <ul id="'+l+'" class="TreeView">'+e+i+"</ul>";o+="</div>";showDlg(t,o,"");if(!n)activateTree(l,a);r=$("public-node");if(r!=null)r.click();r=$("private-node");if(r!=null)r.click()}function dlgUniqueStrings(t){let e=t.var_id,i,a=t.count;let s=t.is_metavar?metaVarUNames[e]:dataVarUNames[e];let l="<p><b>"+s+"</b>: "+a+" unique string value(s)</p>";if(t.strings!=undefined){l+='<div id="UniquStrDiv" class="has-border">';l+='<table id="UniquStrTbl" class="StdTable has-altbckcolor" width="100%">';l+='<tr><th width="84%">Values</th><th width="16%">Counts</th></tr>';for(i=0;i<a;++i)l+="<tr><td>"+t.strings[i]+"</td><td>"+t.occurence_counts[i]+"</td></tr>";l+="</table></div>"}showDlg("String Values",l,Html.dlgBtn("hideDlg()","Close"))}function dlgValChanged(t,e){let i=dlgOrigVals.get(t);if(i==undefined)return false;else return e!=i}function dlgYesNoBox(t,e,i,a="hideDlg()"){showDlg(t,"<p><b>"+e+"</b></p>",'<p><button class="is-dlgcolor" onClick="'+i+';"><b>Yes</b></button>&emsp;<button class="is-dlgcolor" onClick="'+a+';"><b>No</b></button></p>')}function getLastOpenElem(t){return dlgLastOpenElems.has(t)?dlgLastOpenElems.get(t):1}function hideDlg(t=false){if(dlgPopupCount<=0)return;let e=t?0:dlgPopupCount-1;while(dlgPopupCount>e){setDisplay("DlgHeader"+dlgPopupCount,true);$("PopupDlg"+dlgPopupCount).style.display="none";--dlgPopupCount}if(dlgPopupCount==0){poupBckgrd.style.display="none";appState.leave()}onHideDlgFunction();onHideDlgFunction=noOp}function onColorSelectChange(t){let e=$(t),i=e.value,a=255,s=255,l=255;let r=e.attributes.palidx.value;if(i>=0){a=paletteReds[r][i];s=paletteGreens[r][i];l=paletteBlues[r][i]}e.setAttribute("style",Html.colorStyle(a,s,l))}function onSelectUrl(){let t=selectedStr("selectList","");hideDlg(true);window.open(t,"ODV-online_ancillary")}function setLastOpenElem(t,e){dlgLastOpenElems.set(t,e);let i=JSON.stringify([...dlgLastOpenElems]);localStorage.setItem("lastOpenElems",i)}function showAlert(t,e="red"){hideMenus();setDisplay("DlgHeader"+(dlgPopupCount+1),false);showDlg("",'<div class="is-'+e+'">'+t+"</div>","")}function showDlg(t,e,i){if(e.length==0)return;if(dlgPopupCount==0)appState.enter(PopupState);dlgPopupCount=Math.min(++dlgPopupCount,3);setDisplay("DlgContents"+dlgPopupCount,true);setDisplay("DlgMessage"+dlgPopupCount,false);$("DlgTitle"+dlgPopupCount).innerHTML=t;$("DlgContents"+dlgPopupCount).innerHTML=e;$("DlgFooter"+dlgPopupCount).innerHTML=i;let a=$("PopupDlg"+dlgPopupCount);poupBckgrd.style.display="block";a.style.display="block";a.style.marginTop=.45*(poupBckgrd.clientHeight-a.clientHeight)+"px";a.style.marginLeft=.5*(poupBckgrd.clientWidth-a.clientWidth)+"px"}function showMsg(t,e,i){if(e.length==0)return;if(dlgPopupCount==0)appState.enter(PopupState);dlgPopupCount=Math.min(++dlgPopupCount,3);setDisplay("DlgContents"+dlgPopupCount,false);setDisplay("DlgMessage"+dlgPopupCount,true);if(t.length>0)$("DlgTitle"+dlgPopupCount).innerHTML=t;else setDisplay("DlgTitle"+dlgPopupCount,false);$("DlgMessage"+dlgPopupCount).innerHTML=e;if(i.length>0)$("DlgFooter"+dlgPopupCount).innerHTML=i;else setDisplay("DlgFooter"+dlgPopupCount,false);let a=$("PopupDlg"+dlgPopupCount);poupBckgrd.style.display="block";a.style.display="block";a.style.marginTop=.45*(poupBckgrd.clientHeight-a.clientHeight)+"px";a.style.marginLeft=.5*(poupBckgrd.clientWidth-a.clientWidth)+"px"}function updateSelectListColor(t,e){let i=$(t),a=i.value;let s=i.attributes.palidx.value;i.attributes.palidx.value=e;let l=$$(i,"option"),r,n;for(let t=0;t<l.length;++t){r=l[t];n=r.attributes.value.value;let i=255,a=255,s=255;if(n>=0){i=paletteReds[e][n];a=paletteGreens[e][n];s=paletteBlues[e][n]}r.setAttribute("style",Html.colorStyle(i,a,s))}onColorSelectChange(t)}class DlgAcVar{static add(){let t=DlgDrvdVars.dv;let e="<p>Select: "+t.queryStrsMultiInpVar[0]+"</p>";e+=Html.selectList("inpVarMulti",dataVarIds(view.drvdVarArr),dataVarFullLabels(view.drvdVarArr,true),-1,1);showDlg("Derived Variable: "+fullVarLabel(t.name,t.units),e,Html.dlgBtn("DlgAcVar.onAddVars()","Add"))}static addInpVars(t){let e,i=t.length,a=DlgDrvdVars.dv;for(e=0;e<i;++e){a.inpVarIds.push(t[e]);a.iPrms.push(0);a.facs.push(1);a.offs.push(0)}}static convert(){let t=DlgAcVar.selectedRow.id;let e=DlgAcVar.selectedRow.rowIndex-1;let i=DlgDrvdVars.dv.iPrms[e];let a=dataVarUnitsLabel(t,false,wrkArr)+"&emsp;>>&emsp;"+strFromElem("varUnits","");let s="<p>Select suitable conversion for </p><p>"+a+"</p>";s+=Html.selectListAggrVarConversion("cnvChoicesList",i);showDlg("Conversion",s,Html.dlgBtn("DlgAcVar.onCnvSelect('"+a+"')"))}static delete(){if(DlgAcVar.selectedRow==null)return;let t=DlgDrvdVars.dv,e=DlgAcVar.selectedRow.rowIndex-1;t.inpVarIds.splice(e,1);t.iPrms.splice(e,1);t.facs.splice(e,1);t.offs.splice(e,1);DlgAcVar.updateContribTable()}static enableButtons(){$("BtnVarDelete").disabled=true;$("BtnVarCnv").disabled=true;$("BtnVarUp").disabled=true;$("BtnVarTop").disabled=true;$("BtnVarDown").disabled=true;$("BtnVarBottom").disabled=true;if(DlgAcVar.selectedRow!=null){let t=DlgAcVar.selectedRow.rowIndex==1;let e=DlgAcVar.selectedRow.rowIndex==DlgDrvdVars.dv.inpVarIds.length;$("BtnVarDelete").disabled=false;$("BtnVarCnv").disabled=false;$("BtnVarUp").disabled=t;$("BtnVarTop").disabled=t;$("BtnVarDown").disabled=e;$("BtnVarBottom").disabled=e}if(DlgDrvdVars.dv.type==142){setVisibility("BtnVarAdd");setVisibility("BtnVarDelete");setVisibility("BtnVarUp");setVisibility("BtnVarTop");setVisibility("BtnVarDown");setVisibility("BtnVarBottom")}}static moveBottom(){DlgAcVar.moveTo(DlgDrvdVars.dv.inpVarIds.length-1)}static moveDown(){DlgAcVar.moveTo(DlgAcVar.selectedRow.rowIndex)}static moveTo(t){if(DlgAcVar.selectedRow==null)return;let e=DlgAcVar.selectedRow.rowIndex-1,i=DlgDrvdVars.dv;moveElem(i.inpVarIds,e,t);moveElem(i.iPrms,e,t);moveElem(i.facs,e,t);moveElem(i.offs,e,t);DlgAcVar.updateContribTable();let a=$("ContribTable").childNodes[0].childNodes[t+1];select(a);DlgAcVar.selectedRow=a;DlgAcVar.enableButtons()}static moveTop(){DlgAcVar.moveTo(0)}static moveUp(){DlgAcVar.moveTo(DlgAcVar.selectedRow.rowIndex-2)}static onAddVars(){let t=selectedNums("inpVarMulti",-1);hideDlg();if(t.length>0){DlgAcVar.addInpVars(t);DlgAcVar.updateContribTable()}}static onApply(){let t=DlgDrvdVars.dv;t.name=strFromElem("varName",DlgAcVar.prefix+"Variable");t.units=strFromElem("varUnits","");t.uname=t.name;t.uunits=t.units;t.digitsCount=numFromElem("digitsCount",2);if(t.type==140)t.iPrms.push(selectedNum("Mode",0));t.fPrms=t.facs.concat(t.offs);hideDlg();DlgDrvdVars.addVar(DlgAcVar.updateIdx)}static onCnvSelect(t){let e=DlgAcVar.selectedRow.rowIndex-1;let i=selectedNum("cnvChoicesList",0);hideDlg();let a=DlgDrvdVars.dv;if(i==1){showDlg(t,"<p>Y = "+Html.txtInput("factor",a.facs[e])+" * X  + "+Html.txtInput("offset",a.offs[e])+"</p>",Html.dlgBtn("DlgAcVar.onLinTransf()"))}else{let t=varCnvIds.indexOf(i);if(t>-1){a.iPrms[e]=i;a.facs[e]=varCnvFacs[t];a.offs[e]=varCnvOffs[t];DlgAcVar.updateContribTable()}}}static onContribTblClick(t){if(DlgAcVar.selectedRow!=null){unselect(DlgAcVar.selectedRow);DlgAcVar.selectedRow=null}const e=t.target.parentNode;if(e.innerHTML.indexOf("<td>")>-1){select(e);DlgAcVar.selectedRow=e}DlgAcVar.enableButtons()}static onLinTransf(){let t=DlgAcVar.selectedRow.rowIndex-1,e=DlgDrvdVars.dv;let i=numFromElem("factor",1),a=numFromElem("offset",0);hideDlg();e.iPrms[t]=1;e.facs[t]=i;e.offs[t]=a;DlgAcVar.updateContribTable()}static show(t=-1){DlgAcVar.updateIdx=t;let e=DlgDrvdVars.dv,i=e.inpVarIds.length;DlgAcVar.prefix=e.type==140?"Aggregated ":"Converted ";if(t>-1){e.aggrType=e.type==140?e.iPrms[i]:0;e.fPrms.map((t,a)=>{if(a<i)e.facs.push(t);else e.offs.push(t)})}let a='<table class="StdTable">';a+='<tr><th width="70%">Label</th><th width="30%">Digits</th></tr>';a+="<tr><td>"+Html.txtInput("varName",e.name,"20em")+"</td><td>"+Html.numInput("digitsCount",e.digitsCount,0,8)+'</td></tr> <tr><td><b>Units</b></td><td><span id="spMode"><b>Mode</b></span></td></tr>';a+="<tr><td>"+Html.txtInput("varUnits",e.units,"20em")+"</td><td>"+Html.selectList("Mode",[0,1,2],["Exclusive","Average","Median"],e.aggrType)+"</td></tr>";a+='<tr><td colspan="2">&nbsp;</td></tr>';a+='<tr><td colspan="2"><b>Contributing variables</b></td></tr>';a+='<tr><td rowspan="4">';a+='<table id="ContribTable" class="StdTable has-border has-altbckcolor" style="width:20em">';a+="</table>";a+="</td><td><center>"+Html.button("Add","DlgAcVar.add()","BtnVarAdd")+"&emsp;"+Html.button("Delete","DlgAcVar.delete()","BtnVarDelete")+"</center></td></tr>";a+="<tr><td><center>"+Html.button("Conversion","DlgAcVar.convert()","BtnVarCnv")+"</center></td></tr>";a+="<tr><td><center>"+Html.button("Up","DlgAcVar.moveUp()","BtnVarUp")+"&emsp;"+Html.button("Top","DlgAcVar.moveTop()","BtnVarTop")+"</center></td></tr>";a+="<tr><td><center>"+Html.button("Down","DlgAcVar.moveDown()","BtnVarDown")+"&emsp;"+Html.button("Bottom","DlgAcVar.moveBottom()","BtnVarBottom")+"</center></td></tr>";a+="</table>";showDlg(DlgAcVar.prefix+"Variable",a,Html.dlgBtn("DlgAcVar.onApply()"));DlgAcVar.updateContribTable();$("ContribTable").addEventListener("click",DlgAcVar.onContribTblClick);if(e.type==142){setVisibility("spMode");setVisibility("Mode")}}static updateContribTable(){let t="<tr><th>Variable</th><th>Conversion</th></tr>";let e=DlgDrvdVars.dv,i=e.inpVarIds.length,a,s,l;for(a=0;a<i;++a){l=e.inpVarIds[a];s=varCnvIds.indexOf(e.iPrms[a]);t+='<tr id="'+l+'"><td>'+dataVarFullLabel(l,true,wrkArr)+"</td><td>"+varCnvLbls[s]+"</td></tr>"}$("ContribTable").innerHTML=t;DlgAcVar.selectedRow=null;DlgAcVar.enableButtons()}}class DlgArrowProps{static onApply(){let t=DlgDataWin.dw;t.arrXvId=selectedNum("arrXvId",-1);t.arrYvId=selectedNum("arrYvId",-1);t.arrLineWidth=selectedNum("ArrowLWidth",1);t.arrColor=selectedNum("ArrowCol",0);t.arrScale=numFromElem("ArrowScale",1);DlgDataWin.arrowPropsChanged=1;hideDlg()}static show(){let t=DlgDataWin.dw;const e=t.scope==3?dockIsoVarIds:dockDataVarIds;const i=t.scope==3?dockIsoVarLabels:dockDataVarLabels;let a="<p><fieldset><legend>X/Y Components</legend>";a+="<p>X:&ensp;"+Html.selectList("arrXvId",e,i,t.arrXvId)+"</p>";a+="<p>Y:&ensp;"+Html.selectList("arrYvId",e,i,t.arrYvId)+"</p>";a+="</fieldset></p>";a+='<p><table class="StdTable">';a+="<tr><td>Scale [per cm]:</td><td>"+Html.numInput("ArrowScale",t.arrScale,1,999,1)+"</td></tr>";a+="<tr><td>Line width:</td><td>"+Html.selectListLineWidth("ArrowLWidth",t.arrLineWidth)+"</td></tr>";a+="<tr><td>Color:</td><td>"+Html.selectListColor("ArrowCol",t.palName,t.arrColor,true,true)+"</td></tr>";a+="</table></p>";showDlg(titleW("Arrow Properties",rclickWinId),a,Html.dlgBtn("DlgArrowProps.onApply()"))}}class DlgAxisRanges{static onApply(){let t,e=isChecked("a2aRanges");let i=numFromElem("xMin",-1e10),a=numFromElem("xMax",1e10);let s=numFromElem("yMin",-1e10),l=numFromElem("yMax",1e10);let r=numFromElem("zMin",-1e10),n=numFromElem("zMax",1e10);let o=dlgValChanged("xMin",i)||dlgValChanged("xMax",a)||dlgValChanged("yMin",s)||dlgValChanged("yMax",l);let d=dlgValChanged("zMin",r)||dlgValChanged("zMax",n);hideDlg();if(o)t=Msg.setDwXYZRangesSync(rclickWinId,e,i,a,s,l,r,n);else if(!o&&d)t=Msg.setDwZRangesSync(rclickWinId,e,r,n);if(t!=undefined)sendWsMsg(t+","+msgGetCanvasViewCurrInfo)}static show(t){let e=view.dataWinArr[t-1],i=e.scope;dlgOrigVals=new Map;let a='<table class="StdTable">';a+=Html.minMaxEntry(i,e.xvId,"X Axis","xMin","xMax",e.xLeft,e.xRight);a+=Html.minMaxEntry(i,e.yvId,"Y Axis","yMin","yMax",e.yBottom,e.yTop);a+=Html.minMaxEntry(i,e.zvId,"Z Axis","zMin","zMax",e.zBottom,e.zTop);a+="</table>";a+=Html.checkBox("a2aRanges",dlgA2aStr,view.syncAxisRanges);showDlg(titleW("Axis Ranges",t),a,Html.dlgBtn("DlgAxisRanges.onApply()"))}}class DlgAxisVar{static onApply(t,e){const i=selectedNum("vId",-1),a=checkBoxState("rev");hideDlg();if(i==-1)return;let s=view.dataWinArr[rclickWinId-1];let l=false,r=false,n,o;switch(t){case"X":l=i!=s.xvId;r=a!=s.xRev;if(r&&s.xLeft!=missDOUBLE&&s.xLeft!=largeDOUBLE){n=Math.min(s.xLeft,s.xRight);o=Math.max(s.xLeft,s.xRight);if(a=="T"){s.xLeft=o;s.xRight=n}else{s.xLeft=n;s.xRight=o}}if(l){s.xLeft=missDOUBLE;s.xRight=largeDOUBLE}s.xvId=i;s.xRev=a;break;case"Y":l=i!=s.yvId;r=a!=s.yRev;if(r&&s.yBottom!=missDOUBLE&&s.yBottom!=largeDOUBLE){n=Math.min(s.yBottom,s.yTop);o=Math.max(s.yBottom,s.yTop);if(a=="T"){s.yBottom=o;s.yTop=n}else{s.yBottom=n;s.yTop=o}}if(l){s.yBottom=missDOUBLE;s.yTop=largeDOUBLE}s.yvId=i;s.yRev=a;break;case"Z":l=i!=s.zvId;r=a!=s.zRev;if(r&&s.zBottom!=missDOUBLE&&s.zBottom!=largeDOUBLE){n=Math.min(s.zBottom,s.zTop);o=Math.max(s.zBottom,s.zTop);if(a=="T"){s.zBottom=o;s.zTop=n}else{s.zBottom=n;s.zTop=o}}if(l){s.zBottom=missDOUBLE;s.zTop=largeDOUBLE}s.zvId=i;s.zRev=a;break}if(e){if(l&&t=="Z"){s.plotMode=7;s.drawShaded="F";s.isopycnicGridding="F";s.autoContours="T";s.drawContours="T";s.contours=[];s.nonLinAutoAdjust="F";s.nonLinStart=-.1;s.nonLinEnd=.1}sendWsMsg(Msg.loadView(view.toXml()))}else{if(l){s.plotMode=0;s.contours=[];s.drawContours="F";s.nonLinAutoAdjust="F";s.nonLinStart=-.1;s.nonLinEnd=.1}if(l||r)sendWsMsg(Msg.setDwXYZVars(rclickWinId)+","+msgGetCanvasViewCurrInfo)}}static show(t,e,i=false){let a=view.dataWinArr[t-1],s,l;let r=a.scope==3?dockIsoVarIds:dockDataVarIds;let n=a.scope==3?dockIsoVarLabels:dockDataVarLabels;switch(e){case"X":s=a.xvId;l=a.xRev;break;case"Y":s=a.yvId;l=a.yRev;break;case"Z":s=a.zvId;l=a.zRev;break}let o="";if(e==="Z")o+="<p>"+Html.selectList("vId",r,n,s,0,VID_NONE,"(none)")+"</p>";else o+="<p>"+Html.selectList("vId",r,n,s)+"</p>";o+="<p>"+Html.checkBoxTF("rev","Reverse range",l)+"</p>";showDlg(titleW(e+"-Axis Variables",t),o,Html.dlgBtn("DlgAxisVar.onApply('"+e+"',"+i+")","Select"));$("vId").size=Math.min(11,r.length);$("vId").addEventListener("change",()=>{$("rev").checked=false});$("vId").addEventListener("dblclick",function(){DlgAxisVar.onApply(e,i)});let d=selectedOption("vId");if(d!=null)d.scrollIntoView()}}class DlgCollPropsGeneral{static onApply(){let t=strFromElem("collDescr","");let e=selectedStr("collField",dataField);let i=selectedStr("collType",dataType);let a=selectedNum("collPrimVar");hideDlg();if(t!=collDescription||e!=dataField||i!=dataType||a!=primaryVarId)sendWsMsg('{"cmd":"set_collection_properties","primary_var_id":'+(a+1)+',"data_field":"'+e+'","data_type":"'+i+'","description":"'+t+'"},'+msgGetCollInfo+","+msgGetCanvasViewCurrInfo)}static show(){const t=["GeneralField","Ocean","Atmosphere","Land","IceSheet","SeaIce","Sediment"],e=["GeneralType","Profiles","Trajectories","TimeSeries"],i="20em";let a='<table class="StdTable">';a+="<tr><td>Description::</td><td>"+Html.txtInput("collDescr",collDescription,"25em")+"</td></tr>";a+="<tr><td>Data Field:</td><td>"+Html.selectList("collField",t,t,dataField)+"</td></tr>";a+="<tr><td>Data Type:</td><td>"+Html.selectList("collType",e,e,dataType)+"</td></tr>";a+="<tr><td>Primary Variable:</td><td>"+Html.selectList("collPrimVar",dataVarIds(),dataVarFullLabels([],false),primaryVarId)+"</td></tr>";a+="</table>";showDlg("Collection Properties",a,Html.dlgBtn("DlgCollPropsGeneral.onApply()"));$("collField").style.width=i;$("collType").style.width=i;$("collPrimVar").style.width=i}}class DlgCoverage{static onApply(){let t=numFromElem("gccSmplCount",4);let e=numFromElem("gccSmplPerc",5);let i=numFromElem("gccMin",175);let a=numFromElem("gccSlope",.5);let s=numFromElem("gccMax",700);hideDlg();if(t!=goodCovPrms.obs_count||e!=goodCovPrms.obs_percent||i!=goodCovPrms.gap_min||a!=goodCovPrms.gap_slope||s!=goodCovPrms.gap_max)sendWsMsg('{"cmd":"assign_coverage_params","obs_count":'+t+',"obs_percent":'+e+',"gap_min":'+i+',"gap_slope":'+a+',"gap_max":'+s+"},"+msgGetCollInfo+","+msgGetCanvasViewCurrInfo)}static onDefault(){DlgCoverage.update(4,5,175,.5,700)}static show(){let t='<div id="gccTextDiv">Calculation of some derived variables, such as Dynamic Height, Brunt Vaisala Frequency, <br>Derivative, Integral or Geostrophic Velocity, requires good data coverage. These derived variables <br>are not calculated if any of the input variables fails one or more of the tests below.</div>';t+='<p><div id="gccGridDiv"></div><p>';t+="<p>with Z="+fullVarLabel(dataVarUNames[primaryVarId],dataVarUUnits[primaryVarId])+'<span style="float:right">'+Html.button("Default Settings","DlgCoverage.onDefault()")+"</span></p>";showDlg("Good Coverage Criteria",t,Html.dlgBtn("DlgCoverage.onApply()"));DlgCoverage.update(goodCovPrms.obs_count,goodCovPrms.obs_percent,goodCovPrms.gap_min,goodCovPrms.gap_slope,goodCovPrms.gap_max)}static update(t,e,i,a,s){let l='<div id="gccCr1c1">Number of samples with data:</div>';l+='<div id="gccCr1c2">&gt;</div>';l+='<div id="gccCr1c3">'+Html.numInput("gccSmplCount",t,0,999)+"</div>";l+='<div id="gccCr2c1">Fraction of samples with data:</div>';l+='<div id="gccCr2c2">&gt;</div>';l+='<div id="gccCr2c3">'+Html.numInput("gccSmplPerc",e,0,100)+"</div>";l+='<div id="gccCr2c4">%</div>';l+='<div id="gccCr3c1">Data gaps:</div>';l+='<div id="gccCr3c2">&lt;</div>';l+='<div id="gccCr3c3">min (</div>';l+='<div id="gccCr4c3">'+Html.txtInput("gccMin",i,"5.2em")+"</div>";l+='<div id="gccCr4c4">+</div>';l+='<div id="gccCr4c5">'+Html.txtInput("gccSlope",a,"5.2em")+"</div>";l+='<div id="gccCr4c6">* Z ,</div>';l+='<div id="gccCr5c3">'+Html.txtInput("gccMax",s,"5.2em")+"</div>";l+='<div id="gccCr5c4">)</div>';$("gccGridDiv").innerHTML=l}}class DlgCurrStatByName{static onApply(){let t=strFromElem("crLbl","");let e=strFromElem("stLbl",""),i=strFromElem("stTyp","*");hideDlg();if(t.length==0||e.length==0)return;let a='{"cmd":"select_current_sample","conditions":[{"name":"Cruise",'+'"value":"'+t+'"}, {"name":"Station","value":"'+e+'"},';if(i=="B"||i=="C"||i=="X")a+=' {"name":"Type","value":"'+i+'"},';a+=' {"name":"sample_id","value":"'+currSmplId+'"}]},';sendWsMsg(a+msgGetCurrInfo)}static show(){let t=dockMetaVarLabels.indexOf("Station");let e=dockMetaVarLabels.indexOf("Cruise");let i=dockMetaValues[t].split("(");let a='<table class="StdTable">';a+="<tr><td>Cruise label:</td><td>"+Html.txtInput("crLbl",dockMetaValues[e],"10em")+"</td></tr>";a+="<tr><td>Station label:</td><td>"+Html.txtInput("stLbl",i[0].trim(),"10em")+"</td></tr>";a+="<tr><td>Station type:</td><td>"+Html.txtInput("stTyp",i[1].charAt(0),"10em")+"</td></tr>";a+="</table>";showDlg("Select Station by Name",a,Html.dlgBtn("DlgCurrStatByName.onApply()","Select"))}}class DlgDataWin{static addContours(){const t=numFromElem("startVal",1),e=numFromElem("incVal",1),i=numFromElem("endVal",0),a=selectedNum("LColor",0),s=numFromElem("FntSiz",10),l=selectedNum("LblCount",1),r=selectedNum("LWidth",0),n=selectedNum("LStyle",0),o=selectedNum("FColor",-1);let d=Math.floor((i-t)/e+1),m,c;for(m=0;m<d;++m){c=t+m*e;let i=new Contour(c,s,a,l,a,r,n,o);DlgDataWin.dwCntrs.set(c,i)}DlgDataWin.updateContourAlreadyList();DlgDataWin.updateDoContour("T")}static colorBarNonLinIndexFor(t){if(t.nonLinAutoAdjust=="T")return 0;let e,i,a=DlgDataWin.nonLinEndArr.length,s,l=largeDOUBLE;let r=t.nonLinStart,n=t.nonLinEnd;for(i=1;i<a;++i){s=Math.abs(r-DlgDataWin.nonLinStartArr[i])+Math.abs(n-DlgDataWin.nonLinEndArr[i]);if(s<l){e=i;l=s}}return e}static currBlockVals(){let t=0,e=1,i=1;const a=zMatchingWinId(selectedNum("scope",0),selectedNum("zvId",-1));if(a>0){t=contourBlocks[a].strt;e=contourBlocks[a].inc;i=contourBlocks[a].end}return{strt:t,inc:e,end:i}}static deleteContours(){const t=selectedNums("DwCntrCurrCntrs");t.forEach(t=>DlgDataWin.dwCntrs.delete(t));DlgDataWin.updateContourAlreadyList()}static enableArrPropBtn(){let t=selectedNum("PlotMode",0);if(t==6)setVisibility("DwArrPropsBtn",true);else setVisibility("DwArrPropsBtn");return t}static enableIsopycnicGridding(){let t=$("DoIsopycGridding"),e=false;t.disabled=true;let i=view.drvdVarArr,a,s=i.length;for(a=0;a<s;++a){if(i[a].type==2||i[a].type==44||i[a].type==107){e=true;break}}if(!e)return;if(selectedNum("scope",0)!=2||selectedNum("xvId",-1)!=VID_SECTION_COORD)return;if(!isChecked("DispGridded")||selectedNum("GridType",2)!=7)return;t.disabled=false}static onApply(){const t=["","GEBCO_2014_2x2min_Global.nc","ETOPO1_2x2min_Global.nc"];let e=view.dataWinArr[rclickWinId-1],i=DlgDataWin.dw;e.xLeft=i.xLeft;e.xRight=i.xRight;e.xProj=i.xProj;e.xTic=i.xTic;e.xLTic=i.xLTic;e.xAlign=i.xAlign;e.yBottom=i.yBottom;e.yTop=i.yTop;e.yProj=i.yProj;e.yTic=i.yTic;e.yLTic=i.yLTic;e.yAlign=i.yAlign;e.zBottom=i.zBottom;e.zTop=i.zTop;e.zProj=i.zProj;e.zTic=i.zTic;e.zLTic=i.zLTic;e.colBarAlign=i.colBarAlign;e.nonLinStart=i.nonLinStart;e.nonLinEnd=i.nonLinEnd;e.nonLinAutoAdjust=i.nonLinAutoAdjust;if(DlgDataWin.arrowPropsChanged==1){e.arrXvId=i.arrXvId;e.arrYvId=i.arrYvId;e.arrColor=i.arrColor;e.arrScale=i.arrScale;e.arrLineStyle=i.arrLineStyle;e.arrLineWidth=i.arrLineWidth}let a=isChecked("a2aGeneral");view.setDataWinGeneralProps(a?-1:rclickWinId,selectedStr("palName","Odv"),numFromElem("fontSizeFac",100),selectedNum("bckColor",31),selectedNum("gridColor",0),checkBoxState("drawGrid"),checkBoxState("drawLabels"),selectedNum("hlStyle",2));let s=isChecked("a2aData");view.setDataWinVars(s?-1:rclickWinId,selectedNum("scope",0),selectedNum("xvId",-1),selectedNum("yvId",-1),selectedNum("zvId",-1),checkBoxState("xRev"),checkBoxState("yRev"),checkBoxState("zRev"));e.drawContours=checkBoxState("DoContours");e.contours=Array.from(DlgDataWin.dwCntrs.values());let l=isChecked("a2aStyle");view.setDataWinMarkProps(l?-1:rclickWinId,checkBoxState("MarkYes"),numFromElem("MarkSize",2)*.1,selectedNum("MarkCol",17));if(isChecked("DispGridded")){if(e.contours.length>0)e.drawContours="T";view.setDataWinDispStyleGridded(l?-1:rclickWinId,selectedNum("GridType",2),checkBoxState("AutoScale"),numFromElem("XScale",20)*.1,numFromElem("YScale",20)*.1,checkBoxState("DoIsopycGridding"),checkBoxState("DoShading"),checkBoxState("HideBad"),numFromElem("QualLim",3))}else{view.setDataWinDispStyleOrig(l?-1:rclickWinId,selectedNum("PlotMode",0),numFromElem("SymbSize",7)*.1,selectedNum("SymbCol",0),selectedNum("LWidthO",1))}e.DivaNonNegativity=checkBoxState("NonNeg");e.DivaSnr=numFromElem("SNR",50);e.DivaUseSecPoly=selectedNum("DomainSec",2)==2?"T":"F";e.DivaBathyFile=t[selectedNum("DomainMap",1)];let r=strFromElem("DomainDepth","");e.DivaBathyVal=r==="(automatic)"?missDOUBLE:parseFloat(r);hideDlg();let n=a||s||l?-1:rclickWinId;sendWsMsg(Msg.setDwProperties(n)+","+msgGetCanvasViewCurrInfo)}static onApplyAxisSettings(t){let e=DlgDataWin.dw;let i=numFromElem("minVal",missDOUBLE);let a=numFromElem("maxVal",largeDOUBLE);switch(t){case"X":e.xProj=selectedNum("axPrj",0);e.xTic=numFromElem("ticVal",largeDOUBLE);e.xLTic=numFromElem("lTicVal",largeDOUBLE);e.xAlign=selectedNum("axPos",1);if(isChecked("xRev")){e.xLeft=a;e.xRight=i}else{e.xLeft=i;e.xRight=a}break;case"Y":e.yProj=selectedNum("axPrj",0);e.yTic=numFromElem("ticVal",largeDOUBLE);e.yLTic=numFromElem("lTicVal",largeDOUBLE);e.yAlign=selectedNum("axPos",1);if(isChecked("yRev")){e.yBottom=a;e.yTop=i}else{e.yBottom=i;e.yTop=a}break;case"Z":e.zLTic=numFromElem("lTicVal",largeDOUBLE);e.colBarAlign=selectedNum("axPos",1);let s=selectedNum("colMapping",0);e.nonLinAutoAdjust=s==0?"T":"F";e.nonLinStart=DlgDataWin.nonLinStartArr[s];e.nonLinEnd=DlgDataWin.nonLinEndArr[s];if(isChecked("zRev")){e.zBottom=a;e.zTop=i}else{e.zBottom=i;e.zTop=a}break}hideDlg()}static onAxisSettingsClick(t){const e=selectedNum("scope",0),i=View.varGroupId(e);let a,s,l=0,r,n,o,d,m=DlgDataWin.dw;let c=missDOUBLE,u=largeDOUBLE;switch(t){case"X":s=selectedNum("xvId",-1);l=m.xProj;r=m.xTic;n=m.xLTic;o=m.xAlign;c=Math.min(m.xLeft,m.xRight);u=Math.max(m.xLeft,m.xRight);break;case"Y":s=selectedNum("yvId",-1);l=m.yProj;r=m.yTic;n=m.yLTic;o=m.yAlign;c=Math.min(m.yBottom,m.yTop);u=Math.max(m.yBottom,m.yTop);break}if(e==3){a=dockIsoVarIds.indexOf(s);d=dockIsoVarLabels[a]}else d=dataVarFullLabel(s);let p="<p><b>"+t+" Axis: "+d+"</b></p>";p+='<table class="StdTable">';p+="<tr><td>Minimum:</td><td>"+Html.txtInput("minVal",numToStr(c))+"</td></tr>";p+="<tr><td>Maximum:</td><td>"+Html.txtInput("maxVal",numToStr(u))+"</td></tr>";p+="<tr><td>Projection:</td><td>"+Html.selectListAxisProjection("axPrj",t,l)+"</td></tr>";p+="<tr><td>Tic mark interval:</td><td>"+Html.txtInput("ticVal",toStrOrAutomatic(r))+"</td></tr>";p+="<tr><td>Label interval:</td><td>"+Html.txtInput("lTicVal",toStrOrAutomatic(n))+"</td></tr>";p+="<tr><td>Position:</td><td>"+Html.selectListAxisPosition("axPos",t,o)+"</td></tr>";p+="</table>";showDlg("Axis Properties",p,Html.dlgBtn("DlgDataWin.onApplyAxisSettings('"+t+"')"))}static onCbSettingsClick(){let t=DlgDataWin.dw;let e=Math.min(t.zBottom,t.zTop),i=Math.max(t.zBottom,t.zTop);let a=selectedNum("scope",0),s,l=selectedNum("zvId",-1),r;if(a==3){s=dockIsoVarIds.indexOf(l);r=dockIsoVarLabels[s]}else r=dataVarFullLabel(l);let n="<p><b>Colorbar: "+r+"</b></p>";n+='<table class="StdTable">';n+="<tr><td>Minimum:</td><td>"+Html.txtInput("minVal",numToStr(e))+"</td></tr>";n+="<tr><td>Maximum:</td><td>"+Html.txtInput("maxVal",numToStr(i))+"</td></tr>";n+="<tr><td>Label interval:</td><td>"+Html.txtInput("lTicVal",toStrOrAutomatic(t.zLTic))+"</td></tr>";n+="<tr><td>Color mapping:</td><td>"+Html.selectList("colMapping",[0,1,2,3,4,5,6,7],["(automatic)","linear","stretched lower","stretched lower (strong)","stretched middle","stretched middle (strong)","stretched upper","stretched upper (strong)"],DlgDataWin.colorBarNonLinIndexFor(t))+"</td></tr>";n+="<tr><td>Position:</td><td>"+Html.selectListAxisPosition("axPos","Z",t.colBarAlign)+"</td></tr>";n+="</table>";showDlg("Axis Properties",n,Html.dlgBtn("DlgDataWin.onApplyAxisSettings('Z')"))}static onGridTypeChange(){$("DispGridded").checked=true;DlgDataWin.enableIsopycnicGridding()}static onPaletteChange(){let t=paletteIndex(selectedStr("palName","Odv"));updateSelectListColor("bckColor",t);updateSelectListColor("gridColor",t);updateSelectListColor("MarkCol",t);updateSelectListColor("SymbCol",t);updateSelectListColor("LColor",t);updateSelectListColor("FColor",t)}static onPlotModeChange(){$("DispOrig").checked=true;let t=DlgDataWin.enableArrPropBtn();if(t==6)DlgArrowProps.show();DlgDataWin.enableIsopycnicGridding()}static onScopeChange(){let t=selectedNum("scope",0),e=View.varGroupId(t);if(e!=wrkArr[1]){let i=view.dataWinArr[wrkArr[0]-1],a=View.varGroupId(i.scope);let s=i.xvId,l=i.yvId,r=i.zvId;let n=i.xvLst,o=i.yvLst,d=i.zvLst;let m=i.xRev,c=i.yRev,u=i.zRev;if(e!=a&&e==1){s=1;l=0;r=VID_NONE;n=1;o=1;d=1;m="F";c="T";u="F"}else if(e!=a&&e==2){s=0;l=1;r=Math.min(4,view.isoVarSet.isoVarArr.length+3);n=2;o=2;d=2;m="F";c="F";u="F"}wrkArr[1]=e;DlgDataWin.updateAxisVars(t,s,l,r,m,c,u);DlgDataWin.onZVarChange();DlgDataWin.enableIsopycnicGridding()}}static onXVarChange(){$("DispOrig").checked=true;$("xRev").checked=false;let t=DlgDataWin.dw;t.xProj=0;t.xLeft=missDOUBLE;t.xRight=largeDOUBLE;DlgDataWin.enableIsopycnicGridding()}static onYVarChange(){$("DispOrig").checked=true;$("yRev").checked=false;let t=DlgDataWin.dw;t.yProj=0;t.yBottom=missDOUBLE;t.yTop=largeDOUBLE}static onZVarChange(){let t=DlgDataWin.dw;$("zRev").checked=false;t.zBottom=missDOUBLE;t.zTop=largeDOUBLE;t.nonLinStart=-.1;t.nonLinEnd=.1;t.nonLinAutoAdjust="F";DlgDataWin.dwCntrs.clear();DlgDataWin.updateContourAlreadyList();let{strt:e,inc:i,end:a}=DlgDataWin.currBlockVals();DlgDataWin.updateContourBlock(e,i,a)}static setAutoContours(){DlgDataWin.dwCntrs.clear();const t=zMatchingWinId(selectedNum("scope",0),selectedNum("zvId",-1));if(t>0){const e=selectedNum("LColor","0");autoContours[t].forEach(t=>DlgDataWin.dwCntrs.set(t.zVal,new Contour(t.zVal,t.fntSiz,e,t.lblCount,e,t.lWidth,t.lStyle,t.fCol)));DlgDataWin.updateContourAlreadyList();DlgDataWin.updateDoContour("T")}}static show(t,e){DlgDataWin.nonLinStartArr=[-.1,-.1,0,0,-.75,-1.5,-1.5,-3];DlgDataWin.nonLinEndArr=[.1,.1,1.5,3,.75,1.5,0,0];DlgDataWin.isGeographicMap=e;DlgDataWin.arrowPropsChanged=0;let i=view.dataWinArr[t-1],a=i.plotMode;if(a==3)a=0;let s=a==1||a==2||a==7,l=s?a:2,r=i.colBarAlign;let n=i.DivaBathyVal==missDOUBLE?"(automatic)":i.DivaBathyVal.toString();let o=0;if(i.DivaBathyFile.indexOf("GEBCO")>-1)o=1;else if(i.DivaBathyFile.indexOf("ETOPO1")>-1)o=2;DlgDataWin.dw={};dlgOrigVals=new Map;Object.assign(DlgDataWin.dw,i);const d="DlgDataWin",m=getLastOpenElem(d);let c='<div class="TabbedDlg" id="'+d+'">';c+=Html.panelBegin(d,1,"General",m==1);c+=Html.winGeneral(i.palName,i.fontSizeFac,i.bckColor,i.gridColor,i.drawGrid,i.autoCreateLabels,i.highlightStyle);c+="<p>&nbsp;</p>";c+=Html.checkBox("a2aGeneral",dlgA2aStr,false);c+=Html.panelEnd();c+=Html.panelBegin(d,2,"Data",m==2);c+="<p>Scope: "+Html.selectList("scope",[0,1,2,3],["STATION: Data of picked stations","SCATTER: Data of all stations shown in the map","SECTION: Data of all stations inside the section band","SURFACE: Isosurface data of all stations shown in the map"],i.scope)+"</p><p>&nbsp;</p>";c+='<div id="DwAxisVars"></div>';c+="<p>&nbsp;</p>";c+=Html.checkBox("a2aData",dlgA2aStr,false);c+=Html.panelEnd();c+=Html.panelBegin(d,3,"Display Style",m==3);c+='<table id="DwDispStyleTbl">';c+='<tr><td><input type="radio" id="DispOrig" name="DispStyle"> <label for="DispOrig"> <b>Original data</b></label></td><td><input type="radio" id="DispGridded" name="DispStyle"> <label for="DispGridded"> <b>Gridded field</b></label></td></tr>';c+="<tr><td>&nbsp;</td><td></td></tr>";c+="<tr><td>"+Html.selectList("PlotMode",[0,8,4,6,9,10,11],["Colored Dots","Sized Dots","Numbers","Arrows","Colored Dots (X Quality)","Colored Dots (Y Quality)","Colored Dots (Z Quality)"],i.plotMode)+"</td><td>"+Html.selectList("GridType",[1,2,7],["Quick gridding","Weighted-average gridding","DIVA gridding"],l)+"</td></tr>";c+="<tr><td>&nbsp;</td><td></td></tr>";c+="<tr><td>"+Html.numInput("SymbSize",roundedVal(i.symbSize*10,0),1,99,1)+"&ensp;Symbol size</td><td>"+Html.checkBoxTF("AutoScale","Automatic scale lengths",i.autoScale)+"</td></tr>";c+="<tr><td>"+Html.selectListColor("SymbCol",i.palName,i.symbColor,true)+"&ensp;Symbol color</td><td>"+Html.numInput("XScale",roundedVal(i.xScale*10,0),1,999,5)+"&ensp;X scale-length [permille]</td></tr>";c+="<tr><td>"+Html.selectListLineWidth("LWidthO",i.lineWidth)+"&ensp;Line width</td><td>"+Html.numInput("YScale",roundedVal(i.yScale*10,0),1,999,5)+"&ensp;Y scale-length [permille]</td></tr>";c+="<tr><td></td><td>"+Html.checkBoxTF("DoIsopycGridding","Isopycnic gridding",i.isopycnicGridding)+"</td></tr>";c+="<tr><td></td><td>"+Html.checkBoxTF("DoShading","Do color shading",i.drawShaded)+"</td></tr>";c+="<tr><td>"+Html.button("Arrow Properties","DlgArrowProps.show()","DwArrPropsBtn")+"</td><td>"+Html.checkBoxTF("HideBad","Hide bad estimates",i.hideBad)+"</td></tr>";c+="<tr><td></td><td>"+Html.numInput("QualLim",roundedVal(i.hideDistance,1),0,1e5,.5)+"&ensp;Quality limit</td></tr>";c+='<tr><td colspan="2"><hr></td></tr>';c+="<tr><td>"+Html.checkBoxTF("MarkYes","Draw marks",i.drawMarks)+"</td><td>"+Html.numInput("MarkSize",roundedVal(i.markSize*10,0),1,99)+"&ensp;Mark size&emsp;&emsp;&emsp;"+Html.selectListColor("MarkCol",i.palName,i.markColor)+"&ensp;Mark color</td></tr>";c+="</table>";c+="<p>"+Html.checkBox("a2aStyle",dlgA2aStr,false)+"</p>";c+=Html.panelEnd();c+=Html.panelBegin(d,4,"Contours",m==4);c+='<div id="DwCntrGrid">';c+='<div id="DwCntrDoContours" class="is-displaynone">'+Html.checkBoxTF("DoContours","Do contours",i.drawContours)+"</div>";c+='<div id="DwCntrLblDefined"><b>Already Defined</b></div>';c+='<div id="DwCntrLblNew"><b>New</b></div>';c+='<div id="DwCntrLblLine">Line</div>';c+='<div id="DwCntrLblLabels">Labels</div>';c+='<div id="DwCntrLblFill">Fill</div>';c+='<div id="DwCntrDefinedLst"></div>';c+=Html.button("<b> << </b>","DlgDataWin.addContours()","DwCntrAddBtn");c+=Html.button("<b> >> </b>","DlgDataWin.deleteContours()","DwCntrDelBtn");c+=Html.button("<b> << auto-create </b>","DlgDataWin.setAutoContours()","DwCntrAddAutoBtn");c+='<div id="DwCntrStrt">'+Html.txtInput("startVal",contourBlocks[t].strt)+" Start</div>";c+='<div id="DwCntrInc">'+Html.txtInput("incVal",contourBlocks[t].inc)+" Increment</div>";c+='<div id="DwCntrEnd">'+Html.txtInput("endVal",contourBlocks[t].end)+" End</div>";c+='<div id="DwCntrFntSiz">'+Html.numInput("FntSiz",10,0,50)+" pt</div>";c+='<div id="DwCntrLWidth">'+Html.selectListLineWidth("LWidth",0)+"</div>";c+='<div id="DwCntrColor">'+Html.selectListColor("LColor",i.palName,0)+"</div>";c+='<div id="DwCntrLStyle">'+Html.selectListLineStyle("LStyle",0)+"</div>";c+='<div id="DwCntrFillColor">'+Html.selectListColor("FColor",i.palName,-1,true,true)+"</div>";c+='<div id="DwCntrLblCount">'+Html.selectListContourLabelCount("LblCount",1)+"</div>";c+="</div>";c+=Html.panelEnd();c+=Html.panelBegin(d,5,"Color Mapping",m==5);c+="<p>The interactive color mapping tools are not yet available.</p>";c+="<p>Use <i>Colorbar Settings</i> on the <i>Data</i> page instead.</p>";c+=Html.panelEnd();c+=Html.panelBegin(d,6,"DIVA Settings",m==6);c+=Html.checkBoxTF("NonNeg","Prevent negative gridded values",i.DivaNonNegativity);c+='<table class="StdTable"><tr><td>&nbsp;</td><td></td></tr>';c+="<tr><td>Signal-to-noise ratio:</td><td>"+Html.txtInput("SNR",i.DivaSnr)+"</td></tr>";c+="<tr><td>&nbsp;</td><td></td></tr>";c+="<tr><td>Domain selection - Section:</td><td>"+Html.selectList("DomainSec",[1,2],["(none)","Section Bathymetry Polygon"],toBool(i.DivaUseSecPoly)?2:1)+"</td></tr>";c+="<tr><td>&nbsp;</td><td></td></tr>";c+="<tr><td>Domain selection - Map:</td><td>"+Html.selectList("DomainMap",[0,1,2],["(none)","GEBCO_2014","ETOPO1"],o)+"</td></tr>";c+="<tr><td>Depth [m]:</td><td>"+Html.txtInput("DomainDepth",n)+"</td></tr>";c+="</table>";c+=Html.panelEnd()+"</div>";wrkArr=[];wrkArr.push(t);wrkArr.push(View.varGroupId(i.scope));DlgDataWin.dwCntrs=new Map;i.contours.forEach(function(t){DlgDataWin.dwCntrs.set(t.zVal,t)});showDlg("Properties "+windowNameFromId(t),c,Html.dlgBtn("DlgDataWin.onApply()"));$("tabPanel"+m).click();DlgDataWin.updateAxisVars(i.scope,i.xvId,i.yvId,i.zvId,i.xRev,i.yRev,i.zRev);$("DispOrig").checked=!s;$("DispGridded").checked=s;$("palName").addEventListener("change",DlgDataWin.onPaletteChange);$("scope").addEventListener("change",DlgDataWin.onScopeChange);$("xvId").addEventListener("change",DlgDataWin.onXVarChange);$("yvId").addEventListener("change",DlgDataWin.onYVarChange);$("zvId").addEventListener("change",DlgDataWin.onZVarChange);$("PlotMode").addEventListener("change",DlgDataWin.onPlotModeChange);$("GridType").addEventListener("change",DlgDataWin.onGridTypeChange);let u=$("LWidthO"),p=u.clientWidth-2,g=u.offsetWidth+1;$("SymbSize").style.width=p+"px";$("SymbCol").style.width=g+"px";DlgDataWin.updateContourAlreadyList();DlgDataWin.enableArrPropBtn();DlgDataWin.enableIsopycnicGridding()}static updateAxisVars(t,e,i,a,s,l,r){const n=t==3?dockIsoVarIds:dockDataVarIds;const o=t==3?dockIsoVarLabels:dockDataVarLabels;let d=DlgDataWin.isGeographicMap==1?"":"Reverse range";let m=DlgDataWin.isGeographicMap==1?"":Html.button("X-Axis Settings","DlgDataWin.onAxisSettingsClick('X')");let c=DlgDataWin.isGeographicMap==1?"":Html.button("Y-Axis Settings","DlgDataWin.onAxisSettingsClick('Y')");let u=a==VID_NONE?"":Html.button("Colorbar Settings","DlgDataWin.onCbSettingsClick()");let p='<table class="StdTable" id="AxisVarsTable">';p+="<tr><td><b>X Axis:</b></td><td>"+Html.selectList("xvId",n,o,e)+"</td><td>"+m+"</td><td>"+Html.checkBoxTF("xRev",d,s)+"</td></tr>";p+='<tr><td colspan="4">&nbsp;</td></tr>';p+="<tr><td><b>Y Axis:</b></td><td>"+Html.selectList("yvId",n,o,i)+"</td><td>"+c+"</td><td>"+Html.checkBoxTF("yRev",d,l)+"</td></tr>";p+='<tr><td colspan="4">&nbsp;</td></tr>';p+="<tr><td><b>Z Axis:</b></td><td>"+Html.selectList("zvId",n,o,a,0,VID_NONE,"(none)")+"</td><td>"+u+"</td><td>"+Html.checkBoxTF("zRev","Reverse range",r)+"</td></tr>";p+="</table>";$("DwAxisVars").innerHTML=p;if(DlgDataWin.isGeographicMap==1){$("xRev").style.display="none";$("yRev").style.display="none"}}static updateContourAlreadyList(){const t=Array.from(DlgDataWin.dwCntrs.keys()).sort((t,e)=>t-e);$("DwCntrDefinedLst").innerHTML=Html.selectList("DwCntrCurrCntrs",t,t,missDOUBLE,1);$("DwCntrCurrCntrs").addEventListener("click",DlgDataWin.updateContourNewProps)}static updateContourBlock(t,e,i){$("startVal").value=t;$("incVal").value=e;$("endVal").value=i}static updateContourNewProps(){let t=rclickWinId,e=0,i=0,a=0,s=1,l=-1,r=10;let{strt:n,inc:o,end:d}=DlgDataWin.currBlockVals();const m=view.dataWinArr[t-1].palName;const c=selectedNums("DwCntrCurrCntrs");if(c.length==1){let t=DlgDataWin.dwCntrs.get(c[0]);n=d=t.zVal;o=1;e=t.lWidth;i=t.lblCol;a=t.lStyle;s=t.lblCount;l=t.fCol;r=t.fntSiz}DlgDataWin.updateContourBlock(n,o,d);$("FntSiz").value=r;$("DwCntrLWidth").innerHTML=Html.selectListLineWidth("LWidth",e);$("DwCntrColor").innerHTML=Html.selectListColor("LColor",m,i);$("DwCntrLStyle").innerHTML=Html.selectListLineStyle("LStyle",a);$("DwCntrFillColor").innerHTML=Html.selectListColor("FColor",m,l,true,true);$("DwCntrLblCount").innerHTML=Html.selectListContourLabelCount("LblCount",s)}static updateDoContour(t){$("DwCntrDoContours").innerHTML=Html.checkBoxTF("DoContours","Do contours",t)}}class DlgDispOrder{static enableButtons(){let t=wrkArr.length-1,e=!(wrkIdx>0);$("btnUp").disabled=e;$("btnTop").disabled=e;e=!(wrkIdx>=0&&wrkIdx<t);$("btnDown").disabled=e;$("btnBottom").disabled=e}static moveBottom(){DlgDispOrder.moveTo(wrkArr.length-1)}static moveDown(){DlgDispOrder.moveTo(wrkIdx+1)}static moveTo(t){if(wrkIdx==-1)return;moveElem(wrkArr,wrkIdx,t);moveElem(wrkArr2,wrkIdx,t);DlgDispOrder.updateList()}static moveTop(){DlgDispOrder.moveTo(0)}static moveUp(){DlgDispOrder.moveTo(wrkIdx-1)}static onApply(){hideDlg();DlgDispOrder.sendMsg()}static onClick(t){wrkVal=selectedNum("DispOrderLst",-1);wrkIdx=wrkArr.indexOf(wrkVal);DlgDispOrder.enableButtons()}static sendMsg(){sendWsMsg(Msg.modifyView("<VariableDisplayOrder>"+wrkArr.join(",")+"</VariableDisplayOrder>")+","+msgGetDockDataVarLbls+","+msgGetDockDataVarVals)}static setDefault(){hideDlg();wrkArr=intArray(0,dataVarCount);wrkArr=wrkArr.concat(drvdVarIds);DlgDispOrder.sendMsg()}static show(){wrkArr=[...dockDataVarIds];wrkArr2=[...dockDataVarLabels];wrkVal=0;let t='<table class="StdTable"> <tr><td rowspan="10"><div id="DispOrderDiv"></div></td><td>'+Html.button("Top","DlgDispOrder.moveTop()","btnTop")+"</td></tr> <tr><td>"+Html.button("Up","DlgDispOrder.moveUp()","btnUp")+"</td></tr> <tr><td>"+Html.button("Down","DlgDispOrder.moveDown()","btnDown")+"</td></tr> <tr><td>"+Html.button("Bottom","DlgDispOrder.moveBottom()","btnBottom")+"</td></tr> <tr><td>&nbsp;</td></tr> <tr><td>"+Html.button("<b>Default Order</b>","DlgDispOrder.setDefault()","btnDflt")+"</td></tr> </table>";showDlg("Display Order - Variables",t,Html.dlgBtn("DlgDispOrder.onApply()"));DlgDispOrder.updateList()}static updateList(){$("DispOrderDiv").innerHTML=Html.selectList("DispOrderLst",wrkArr,wrkArr2,wrkVal);let t=$("DispOrderLst");t.size=14;t.setAttribute("style","max-width:340px");t.addEventListener("click",DlgDispOrder.onClick);wrkIdx=wrkArr.indexOf(wrkVal);DlgDispOrder.enableButtons()}}class DlgDrvdVars{static addVar(t=-1){let e=this.dv,i=e.type,a=e.inpVarIds;if(i==9){e.name="Ratio ("+dataVarFullLabel(a[0],false,wrkArr)+" / "+dataVarFullLabel(a[1],false,wrkArr)+")";e.uname="Ratio ("+dataVarFullLabel(a[0],true,wrkArr)+" / "+dataVarFullLabel(a[1],true,wrkArr)+")"}else if(i==104||i==107){let t=e.fPrms[0],a=drvdVarChoice(i);e.name=a.name;e.uname=a.uname;if(t>0){e.name+="-"+t;e.uname+="-"+t}}else if(i==141){e.name="Interpolated "+dataVarNameLabel(a[1],false,wrkArr);e.uname="Interpolated "+dataVarNameLabel(a[1],true,wrkArr);e.units=dataVarUnitsLabel(a[1],false,wrkArr);e.uunits=dataVarUnitsLabel(a[1],true,wrkArr)}else if(i==143){e.name="StandardDeviation "+dataVarNameLabel(a[0],false,wrkArr);e.uname="StandardDeviation "+dataVarNameLabel(a[0],true,wrkArr);e.units=dataVarUnitsLabel(a[0],false,wrkArr);e.uunits=dataVarUnitsLabel(a[0],true,wrkArr)}else if(i==81||i==49||i==64||i==83||i==66||i==68||i==48){let s=i==48?timeVarCnvIds:metaTimeVarCnvIds;let l=i==48?timeVarCnvLbls:metaTimeVarCnvLbls;let r=dataVarFullLabel(a[0],false);let n=identifyTimeConversionIdx(r,l);if(n==-1){DlgTimeVarSelCnv.show(t,e,r,s,l);return}else{if(i==48){DlgTimeVarSettings.show(t,e,s[n]);return}else DlgDrvdVars.setTimeVarIPrms(e,s[n])}}DlgDrvdVars.newDrvdVar(t,e)}static deepCopy(t){DlgDrvdVars.dv=Object.assign({},t);DlgDrvdVars.dv.inpVarIds=[...t.inpVarIds];DlgDrvdVars.dv.iPrms=[...t.iPrms];DlgDrvdVars.dv.fPrms=[...t.fPrms]}static enableButtons(){let t=selectedNums("DrvdVarList"),e=t.length;$("DeleteDrvdVarsBttn").disabled=e==0;$("EditDrvdVarsBttn").disabled=e!=1||!DlgDrvdVars.isEditable(t[0])}static identifyInpVar(t){if(t==DlgDrvdVars.dv.queryStrsInpVarLabels.length){DlgDrvdVars.addVar();return}let e=DlgDrvdVars.dv.queryStrsInpVarLabels[t];dlgSelectItem("Macro File",dataVarFullLabels(wrkArr,true),"DlgDrvdVars.setInpVar("+t+")","Identify: "+e,e)}static isEditable(t){let e=wrkArr[t].type,i=drvdVarChoice(e);return e==12||e==45||i.queryStrsInpVar.length>0||i.queryStrsRef.length>0||i.queryStrsMultiInpVar.length>0}static newDrvdVar(t,e){let i=t==-1?View.nextDrvdVarId(wrkArr):e.varId;let a=new DrvdVar(e.name,e.units,e.uname,e.uunits,i,e.type,e.digitsCount,e.inpVarIds,e.iPrms,e.fPrms,e.macroFile,e.expr,missDOUBLE,largeDOUBLE);if(t==-1)wrkArr.push(a);else wrkArr[t]=a;DlgDrvdVars.update()}static onApply(){view.drvdVarArr=wrkArr;hideDlg();sendWsMsg(Msg.setDrvdVars()+","+msgGetDockDataVarLbls+","+msgGetCanvasViewCurrInfo)}static onApplyProps(t=-1){let e=this.dv,i=e.type,a=true,s,l=[],r;if(e.queryStrsMultiInpVar.length>=1){l=selectedNums("inpVarMulti",-1);a=l.length>0}if(e.queryStrsInpVar.length>=1){e.inpVarIds=[];if(i==10||i==50||i==11||i==141)e.inpVarIds.push(primaryVarId);s=selectedNum("inpVarId1",-1);if(s>-1){if(i==142)l.push(s);else if(i==74){e.iPrms.push(s);e.name=metaVarNames[s];e.uname=metaVarUNames[s];e.units=metaVarUnits[s];e.uunits=metaVarUUnits[s]}else e.inpVarIds.push(s)}else a=false}if(a&&e.queryStrsInpVar.length>=2){s=selectedNum("inpVarId2",-1);if(s>-1)e.inpVarIds.push(s);else a=false}if(a&&e.queryStrsRef.length>=1){s=numFromElem("refVal1",missDOUBLE);if(s!=missDOUBLE){e.fPrms=[];e.fPrms.push(s)}else a=false}hideDlg();if(!a)return;if(i==140||i==142){let a=i==140?"Aggregated ":"Converted ";e.name=a+dataVarNameLabel(l[0],false,wrkArr);e.units=dataVarUnitsLabel(l[0],false,wrkArr);e.digitsCount=dataVarDecimalCount(l[0],wrkArr);e.aggrType=0;e.facs=[];e.offs=[];DlgAcVar.addInpVars(l);DlgAcVar.show(t)}else DlgDrvdVars.addVar(t)}static onDelete(){let t=selectedNums("DrvdVarList");if(t.length>0){wrkArr=strippedArray(wrkArr,t);DlgDrvdVars.update()}}static onEdit(){let t=selectedNum("DrvdVarList");let e=wrkArr[t].type,i=drvdVarChoice(e);DlgDrvdVars.setCurrDrvdVar(i,t);if(e==140||e==142){let e=DlgDrvdVars.dv;e.aggrType=0;e.facs=[];e.offs=[];DlgAcVar.show(t)}else if(e==12||e==45)DlgExprVar.show(t);else if(i.queryStrsMultiInpVar.length>0||i.queryStrsInpVar.length>0||i.queryStrsRef.length>0)DlgDrvdVars.queryProps(t)}static onMacroSelected(){let t=this.attributes.value.nodeValue;hideDlg();if(t.length>0)sendWsMsg('{"cmd":"get_macro","macro_name":"'+t+'"}')}static onTreeItemClick(){let t=this.value,e=drvdVarChoice(t);DlgDrvdVars.setCurrDrvdVar(e,-1);if(e.queryStrsMultiInpVar.length>0||e.queryStrsInpVar.length>0||e.queryStrsRef.length>0)DlgDrvdVars.queryProps(-1);else if(e.type==12)dlgSelectTreeItem("Select Macro File",Html.treeNodeFromArr(privMacroNames,true),Html.treeNodeFromArr(macroNames,false),DlgDrvdVars.onMacroSelected);else if(e.type==45)DlgExprVar.show(-1);else DlgDrvdVars.addVar(-1)}static queryProps(t=-1){let e=DlgDrvdVars.dv,i,a="";let s=dataVarIds(wrkArr),l=dataVarFullLabels(wrkArr,true);if(e.queryStrsMultiInpVar.length>=1){a+="<p>Select: "+e.queryStrsMultiInpVar[0]+"</p>";let i=t==-1?[-1]:e.inpVarIds;a+=Html.selectListEx("inpVarMulti",s,l,i,1)}if(e.queryStrsInpVar.length>=1){a+="<p>Select: "+e.queryStrsInpVar[0]+"</p>";i=t==-1?-1:e.inpVarIds[0];if(e.type==74){let t=view.metaVarIds(false,true,true,false);let e=view.metaVarFullLabels(false,true,true,false);if(t.length>0)a+=Html.selectList("inpVarId1",t,e,i)}else a+=Html.selectList("inpVarId1",s,l,i)}if(e.queryStrsInpVar.length>=2){a+="<p>Select: "+e.queryStrsInpVar[1]+"</p>";i=t==-1?-1:e.inpVarIds[1];a+=Html.selectList("inpVarId2",s,l,i)}if(e.queryStrsRef.length>=1){a+="<p>"+e.queryStrsRef[0]+"</p>";a+=Html.txtInput("refVal1",e.fPrms[0])}showDlg(fullVarLabel(e.uname,e.uunits),a,Html.dlgBtn("DlgDrvdVars.onApplyProps("+t+")","Select"))}static setCurrDrvdVar(t,e=-1){if(e>-1){DlgDrvdVars.deepCopy(wrkArr[e]);DlgDrvdVars.dv.queryStrsInpVar=[...t.queryStrsInpVar];DlgDrvdVars.dv.queryStrsMultiInpVar=[...t.queryStrsMultiInpVar];DlgDrvdVars.dv.queryStrsRef=[...t.queryStrsRef]}else DlgDrvdVars.deepCopy(t)}static setInpVar(t){let e=selectedStr("selectList","");hideDlg();let i=dataVarFullLabels(wrkArr,true).indexOf(e);if(i>-1){let e=dataVarIds(wrkArr)[i];DlgDrvdVars.dv.inpVarIds.push(e);DlgDrvdVars.identifyInpVar(t+1)}}static setTimeVarIPrms(t,e,i=0,a=0,s=1,l=1){t.iPrms=[];t.iPrms.push(e);if(t.type==48){t.iPrms.push(i);t.iPrms.push(a);t.iPrms.push(s);t.iPrms.push(l)}}static show(){const t="DrvdVarTree";dlgOrigVals=new Map;wrkArr=[...view.drvdVarArr];let e='<table id="DrvdVarTable">';e+="<tr><td><b>Already Defined</b></td><td><b>Choices</b></td></tr>";e+='<tr><td colspan="2">&nbsp;</td></tr>';e+='<tr><td><div id="DrvdVarAlreadyDiv">'+Html.selectList("DrvdVarList",[],[],-1,1)+"<p>"+Html.button("Delete","DlgDrvdVars.onDelete()","DeleteDrvdVarsBttn")+"&emsp;&emsp;"+Html.button("Edit","DlgDrvdVars.onEdit()","EditDrvdVarsBttn")+'</p></div></td><td><div id="DrvdVarChoicesDiv" class="has-border">'+Html.drvdVarChoices(t)+"</div></td></tr>";e+="</table>";showDlg("Derived Variables",e,Html.dlgBtn("DlgDrvdVars.onApply()"));DlgDrvdVars.update();activateTree(t,DlgDrvdVars.onTreeItemClick);$("DrvdVarList").addEventListener("click",DlgDrvdVars.enableButtons);let i=$(getLastOpenElem(t));if(i!=null)i.click()}static update(){let t=[],e=[],i=$("DrvdVarList");for(let i=0;i<wrkArr.length;++i){t.push(i);e.push(fullVarLabel(wrkArr[i].uname,wrkArr[i].uunits))}i.innerHTML=Html.selectListContents(t,e,[]);i.setAttribute("size",6);DlgDrvdVars.enableButtons()}}class DlgDwStats{static rXh(){$("btnXh").blur();sendWsMsg('{"cmd":"get_image","type":"x_histogram","fmt":"jpg","window_id":'+DlgDwStats.winId+"}")}static rYh(){$("btnYh").blur();sendWsMsg('{"cmd":"get_image","type":"y_histogram","fmt":"jpg","window_id":'+DlgDwStats.winId+"}")}static rZh(){$("btnZh").blur();sendWsMsg('{"cmd":"get_image","type":"z_histogram","fmt":"jpg","window_id":'+DlgDwStats.winId+"}")}static rXYh(){$("btnXYh").blur();sendWsMsg('{"cmd":"get_image","type":"xy_histogram","fmt":"jpg","window_id":'+DlgDwStats.winId+"}")}static show(t){const e="Visible data",i="All data";DlgDwStats.winId=t.window_id;let a='<table id="DwStatsTbl" class="StdTable has-border">';a+="<tr><th></th>"+Html.toolTipElem("th","Mean",e)+Html.toolTipElem("th","Stand. Dev.",e)+Html.toolTipElem("th","Stand. Err.",e)+Html.toolTipElem("th","Count",e)+Html.toolTipElem("th","Minimum",i)+Html.toolTipElem("th","Maximum",i)+"</tr>";a+="<tr><td><b>"+t.X.label+"</b></td>"+Html.toolTipElem("td",t.X.mean,e)+Html.toolTipElem("td",t.X.stdev,e)+Html.toolTipElem("td",t.X.sterr,e)+Html.toolTipElem("td",t.X.count,e)+Html.toolTipElem("td",t.X.min,i)+Html.toolTipElem("td",t.X.max,i)+"</tr>";a+="<tr><td><b>"+t.Y.label+"</b></td>"+Html.toolTipElem("td",t.Y.mean,e)+Html.toolTipElem("td",t.Y.stdev,e)+Html.toolTipElem("td",t.Y.sterr,e)+Html.toolTipElem("td",t.Y.count,e)+Html.toolTipElem("td",t.Y.min,i)+Html.toolTipElem("td",t.Y.max,i)+"</tr>";if(t.Z!=undefined)a+="<tr><td><b>"+t.Z.label+"</b></td>"+Html.toolTipElem("td",t.Z.mean,e)+Html.toolTipElem("td",t.Z.stdev,e)+Html.toolTipElem("td",t.Z.sterr,e)+Html.toolTipElem("td",t.Z.count,e)+Html.toolTipElem("td",t.Z.min,i)+Html.toolTipElem("td",t.Z.max,i)+"</tr>";a+='</table><p>&nbsp;</p><table class="StdTable">';a+="<tr><td>"+Html.button("X Histogram","DlgDwStats.rXh()","btnXh")+"</td><td>"+Html.button("Y Histogram","DlgDwStats.rYh()","btnYh")+"</td>";if(t.Z!=undefined)a+="<td>"+Html.button("Z Histogram","DlgDwStats.rZh()","btnZh")+"</td>";a+="<td>"+Html.button("X/Y Distribution","DlgDwStats.rXYh()","btnXYh")+"</td></tr></table>";showDlg("Window "+t.window_id+" Statistics",a,Html.dlgBtn("hideDlg(true)","Close"))}}class DlgEditData{static atStr(t){return dataVarAtFullLbl(DlgEditData.varId-1,primaryVarId,t.innerText)}static changeErrVal(){let t=DlgEditData.xSel.firstSelection(),e=$("queryStr").value;Array.from(DlgEditData.xSel.itArr[t].cells)[3].innerText=e;hideDlg()}static changeQFlags(){let t=selectedStr("qfList","");hideDlg();DlgEditData.setSelectedTblVals(4,t,"change","quality flags")}static changeVal(){let t=DlgEditData.xSel.firstSelection(),e=$("queryStr").value;Array.from(DlgEditData.xSel.itArr[t].cells)[2].innerText=e;hideDlg()}static onApply(){let t,e=DlgEditData.smplCount,i=DlgEditData.varId;let a,s,l,r,n,o,d,m,c,u=[],p;for(t=0;t<e;++t){a="DV:"+t+":1";s="DV:"+t+":2";l="DV:"+t+":3";r=$(a).innerText;o=$(s).innerText;m=$(l).innerText;n=dlgOrigVals.get(a);d=dlgOrigVals.get(s);c=dlgOrigVals.get(l);if(r!=n||o!=d||m!=c){p='{"var_id":'+i+',"sample_id":'+(t+1)+',"new_value":"'+r+'","old_value":"'+n+'","new_error_value":"'+o+'","old_error_value":"'+d+'","new_flag":"'+m+'","old_flag":"'+c+'"}';u.push(p)}}hideDlg();if(u.length>0)sendWsMsg('{"cmd":"assign_data_values","items":['+u.join(",")+"]},"+msgGetCanvas+","+msgGetCurrInfo)}static onChangeErrVal(){let t=DlgEditData.xSel.firstSelection();let e=Array.from(DlgEditData.xSel.itArr[t].cells);dlgQueryStr("Enter new error value","Error "+DlgEditData.atStr(e[1]),e[3].innerText,"DlgEditData.changeErrVal()")}static onChangeFlags(){let t=DlgEditData.xSel.selections(),e=t.length,i="z";if(e==1)i=Array.from(DlgEditData.xSel.itArr[t[0]].cells)[4].innerText;dlgSelectQf(DlgEditData.varId-1,i,true,"DlgEditData.changeQFlags()")}static onChangeVal(){let t=DlgEditData.xSel.firstSelection();let e=Array.from(DlgEditData.xSel.itArr[t].cells);dlgQueryStr("Enter new data value",DlgEditData.atStr(e[1]),e[2].innerText,"DlgEditData.changeVal()")}static onClick(t){t.preventDefault();const e=t.target;if(e==undefined||e.nodeName!="TD")return;DlgEditData.xSel.select(e.parentNode.rowIndex,t.shiftKey,t.ctrlKey);DlgEditData.updateStatus()}static onDelErrVals(){DlgEditData.setSelectedTblVals(3,"","delete","error values")}static onDelVals(){DlgEditData.setSelectedTblVals(2,"","delete","data values")}static onInvert(){DlgEditData.xSel.invert();DlgEditData.updateStatus()}static onSelectAll(){DlgEditData.xSel.clear();DlgEditData.xSel.invert();DlgEditData.updateStatus()}static setSelectedTblVals(t,e,i,a){let s=DlgEditData.xSel.selections().length;if(s>1)dlgYesNoBox("Edit Data - "+dataVarFullLabel(DlgEditData.varId-1),"Really want to "+i+" "+s+" "+a+"?","DlgEditData.setSelectedTblValsYn("+t+",'"+e+"')");else DlgEditData.setSelectedTblValsC(t,e)}static setSelectedTblValsC(t,e){let i=DlgEditData.xSel.selections(),a,s=i.length;for(a=0;a<s;++a)Array.from(DlgEditData.xSel.itArr[i[a]].cells)[t].innerText=e}static setSelectedTblValsYn(t,e){hideDlg();DlgEditData.setSelectedTblValsC(t,e)}static show(t,e,i,a,s){DlgEditData.smplCount=i.length;DlgEditData.varId=t;dlgOrigVals=new Map;let l,r=i.length,n,o,d,m=dataVarNameLabel(t-1);let c='<div id="edGrid">';c+='<div id="edDataTblDiv" class="has-border">';c+='<table id="edDataTbl" class="StdTable has-altbckcolor">';c+='<tr><th width="10%"></th><th>'+dataVarNameLabel(primaryVarId)+"</th><th>"+m+"</th><th>Errors "+m+'</th><th width="7%">QF</th></tr>';for(l=0;l<r;++l){n="DV:"+l+":1";dlgOrigVals.set(n,i[l]);o="DV:"+l+":2";dlgOrigVals.set(o,a[l]);d="DV:"+l+":3";dlgOrigVals.set(d,s[l]);c+="<tr><td>"+(l+1)+"</Td3><td>"+e[l]+'</td><td id="'+n+'">'+i[l]+'</td><td id="'+o+'">'+a[l]+'</td><td id="'+d+'">'+s[l]+"</td></tr>"}c+="</table></div>";c+='<div id="edButtons">';c+="<p>"+Html.button("Change Value","DlgEditData.onChangeVal()","edBtnChVal")+"</p>";c+="<p>"+Html.button("Change Error Value","DlgEditData.onChangeErrVal()","edBtnChErrVal")+"</p>";c+="<p>"+Html.button("Delete Value(s)","DlgEditData.onDelVals()","edBtnDelVal")+"</p>";c+="<p>"+Html.button("Delete Error Value(s)","DlgEditData.onDelErrVals()","edBtnDelErrVal")+"</p>";c+="<p>"+Html.button("Change Quality Flag(s)","DlgEditData.onChangeFlags()","edBtnChFlags")+"</p>";c+="</div>";c+='<div id="edDataFooter">'+Html.button("Select All","DlgEditData.onSelectAll()")+'<span style="float:right">'+Html.button("Invert Selection","DlgEditData.onInvert()")+'</span><p><div id="edStatus"></div></p></div>';c+="</div>";showDlg("Edit Data - "+dataVarFullLabel(t-1),c,Html.dlgBtn("DlgEditData.onApply()"));let u=$("edDataTbl"),p=Array.from(u.rows);u.addEventListener("click",DlgEditData.onClick);DlgEditData.xSel=new XSelector(p,true);DlgEditData.xSel.select(currSmplId);if(currSmplId>6)p[currSmplId].scrollIntoView();DlgEditData.updateStatus()}static updateStatus(){let t=DlgEditData.xSel.selectedCount();$("edStatus").innerText=t+" of "+DlgEditData.xSel.size()+" sample(s) selected";$("edBtnChVal").disabled=t!=1;$("edBtnChErrVal").disabled=t!=1;$("edBtnDelVal").disabled=t==0;$("edBtnDelErrVal").disabled=t==0;$("edBtnChFlags").disabled=t==0}}class DlgEditMetaData{static changeQFlags(){let t=selectedStr("qfList","");hideDlg();DlgEditMetaData.setSelectedQfVal(t)}static onApply(){let t,e,i=DlgEditMetaData.varIds.length,a,s,l,r="",n=0;for(t=0;t<i;++t){e=DlgEditMetaData.varIds[t];a="MV:"+t+":1";s=$(a).innerText;l=dlgOrigVals.get(a);if(s!=l&&metaVarValTypes[e]=="INDEXED_TEXT"){r+="<p>"+fullVarLabel(metaVarUNames[e],metaVarUUnits[e])+": "+l+" > "+s+"</p>";++n}}DlgEditScope.modifyAll=0;if(n>0)DlgEditScope.show(r,DlgEditMetaData.sendMsg);else DlgEditMetaData.sendMsg()}static onChangeFlags(){let t=DlgEditMetaData.xSel.firstSelection();if(t==-1)return;let e=Array.from(DlgEditMetaData.xSel.itArr[t].cells)[2].innerText;let i=t;if(i>=mandatoryMetaVarCount-1)++i;dlgSelectQf(i,e,false,"DlgEditMetaData.changeQFlags()")}static onClick(t){t.preventDefault();const e=t.target;if(e==undefined||e.nodeName!="TD")return;DlgEditMetaData.xSel.select(e.parentNode.rowIndex,t.shiftKey,t.ctrlKey)}static sendMsg(){let t,e,i=DlgEditMetaData.varIds.length,a,s,l,r,n,o;let d=[],m;for(t=0;t<i;++t){e=DlgEditMetaData.varIds[t]+1;a="MV:"+t+":1";s="MV:"+t+":2";l=$(a).innerText;n=$(s).innerText;r=dlgOrigVals.get(a);o=dlgOrigVals.get(s);if(l!=r||n!=o){m='{"var_id":'+e+',"new_value":"'+escapedStr(l)+'","old_value":"'+escapedStr(r)+'","new_flag":"'+n+'","old_flag":"'+o+'","modify_all_instances":'+DlgEditScope.modifyAll+"}";d.push(m)}}hideDlg();if(d.length>0)sendWsMsg('{"cmd":"assign_metadata_values","items":['+d.join(",")+"]},"+msgGetCanvas+","+msgGetCurrInfo)}static setSelectedQfVal(t){let e=DlgEditMetaData.xSel.firstSelection();Array.from(DlgEditMetaData.xSel.itArr[e].cells)[2].innerText=t}static show(t,e,i){DlgEditMetaData.varIds=t;dlgOrigVals=new Map;let a,s=t.length,l,r;let n='<div id="MetaVarTblDiv" class="has-border">';n+='<table id="MetaVarTbl" class="StdTable has-altbckcolor">';for(a=0;a<s;++a){l="MV:"+a+":1";dlgOrigVals.set(l,e[a]);r="MV:"+a+":2";dlgOrigVals.set(r,i[a]);n+="<tr><td>"+fullVarLabel(metaVarUNames[t[a]],metaVarUUnits[t[a]])+':</td><td id="'+l+'" contenteditable="true">'+e[a]+'</td><td id="'+r+'">'+i[a]+"</td></tr>"}n+="</table></div>";n+='<p><span style="float:right">'+Html.button("Change Quality Flag","DlgEditMetaData.onChangeFlags()","edBtnChFlags")+"</span></p>";showDlg("Edit Station Metadata",n,Html.dlgBtn("DlgEditMetaData.onApply()"));let o=$("MetaVarTbl"),d=Array.from(o.rows);o.addEventListener("click",DlgEditMetaData.onClick);DlgEditMetaData.xSel=new XSelector(d,false,false);DlgEditMetaData.xSel.select(0)}}class DlgEditSmplData{static atStr(t){return dataVarAtFullLbl(t,primaryVarId,DlgEditSmplData.primVarVal)}static changeErrVal(){let t=DlgEditSmplData.xSel.firstSelection(),e=$("queryStr").value;Array.from(DlgEditSmplData.xSel.itArr[t].cells)[3].innerText=e;hideDlg()}static changeQFlag(){let t=selectedStr("qfList","");hideDlg();let e=DlgEditSmplData.xSel.firstSelection();Array.from(DlgEditSmplData.xSel.itArr[e].cells)[4].innerText=t}static changeVal(){let t=DlgEditSmplData.xSel.firstSelection(),e=$("queryStr").value;Array.from(DlgEditSmplData.xSel.itArr[t].cells)[2].innerText=e;hideDlg()}static onApply(){let t,e,i,a,s,l,r,n,o,d,m=[],c;for(t=0;t<dataVarCount;++t){e="DV:"+t+":1";i="DV:"+t+":2";a="DV:"+t+":3";s=$(e).innerText;r=$(i).innerText;o=$(a).innerText;l=dlgOrigVals.get(e);n=dlgOrigVals.get(i);d=dlgOrigVals.get(a);if(s!=l||r!=n||o!=d){c='{"var_id":'+(t+1)+',"sample_id":'+currSmplId+',"new_value":"'+s+'","old_value":"'+l+'","new_error_value":"'+r+'","old_error_value":"'+n+'","new_flag":"'+o+'","old_flag":"'+d+'"}';m.push(c)}}hideDlg();if(m.length>0)sendWsMsg('{"cmd":"assign_data_values","items":['+m.join(",")+"]},"+msgGetCanvas+","+msgGetCurrInfo)}static onChangeErrVal(){let t=DlgEditSmplData.xSel.firstSelection();let e=Array.from(DlgEditSmplData.xSel.itArr[t].cells);dlgQueryStr("Enter new error value",DlgEditSmplData.atStr(t-1),e[3].innerText,"DlgEditSmplData.changeErrVal()")}static onChangeFlag(){let t=DlgEditSmplData.xSel.firstSelection();let e=Array.from(DlgEditSmplData.xSel.itArr[t].cells)[4].innerText;dlgSelectQf(t-1,e,true,"DlgEditSmplData.changeQFlag()")}static onChangeVal(){let t=DlgEditSmplData.xSel.firstSelection();let e=Array.from(DlgEditSmplData.xSel.itArr[t].cells);dlgQueryStr("Enter new data value",DlgEditSmplData.atStr(t-1),e[2].innerText,"DlgEditSmplData.changeVal()")}static onClick(t){t.preventDefault();const e=t.target;if(e==undefined||e.nodeName!="TD")return;DlgEditSmplData.xSel.select(e.parentNode.rowIndex,t.shiftKey,t.ctrlKey)}static onDelVal(){let t=DlgEditSmplData.xSel.firstSelection();Array.from(DlgEditSmplData.xSel.itArr[t].cells)[2].innerText=""}static onDelErrVal(){let t=DlgEditSmplData.xSel.firstSelection();Array.from(DlgEditSmplData.xSel.itArr[t].cells)[3].innerText=""}static show(t,e,i){dlgOrigVals=new Map;let a,s=t.length,l,r,n;let o='<div id="esdGrid">';o+='<div id="esdDataTblDiv" class="has-border">';o+='<table id="esdDataTbl" class="StdTable has-altbckcolor">';o+='<tr><th width="10%"></th><th>Variable</th><th>Value</th><th>Error Value</th><th width="7%">QF</th></tr>';for(a=0;a<s;++a){l="DV:"+a+":1";dlgOrigVals.set(l,t[a]);r="DV:"+a+":2";dlgOrigVals.set(r,e[a]);n="DV:"+a+":3";dlgOrigVals.set(n,i[a]);o+="<tr><td>"+(a+1)+"</td><td>"+dataVarFullLabel(a)+'</td><td id="'+l+'">'+t[a]+'</td><td id="'+r+'">'+e[a]+'</td><td id="'+n+'">'+i[a]+"</td></tr>"}o+="</table></div>";o+='<div id="esdButtons">';o+="<p>"+Html.button("Change Value","DlgEditSmplData.onChangeVal()","esdBtnChVal")+"</p>";o+="<p>"+Html.button("Change Error Value","DlgEditSmplData.onChangeErrVal()","esdBtnChErrVal")+"</p>";o+="<p>"+Html.button("Delete Value","DlgEditSmplData.onDelVal()","esdBtnDelVal")+"</p>";o+="<p>"+Html.button("Delete Error Value","DlgEditSmplData.onDelErrVal()","esdBtnDelErrVal")+"</p>";o+="<p>"+Html.button("Change Quality Flag","DlgEditSmplData.onChangeFlag()","esdBtnChFlags")+"</p>";o+="</div>";o+="</div>";showDlg("Edit Sample Data - "+currSmplId+" /"+smplCount,o,Html.dlgBtn("DlgEditSmplData.onApply()"));let d=$("esdDataTbl"),m=Array.from(d.rows);d.addEventListener("click",DlgEditSmplData.onClick);DlgEditSmplData.xSel=new XSelector(m);DlgEditSmplData.xSel.select(2);DlgEditSmplData.primVarVal=t[primaryVarId]}}class DlgEditScope{static onApply(){DlgEditScope.modifyAll=selectedNum("editScope",0);hideDlg();DlgEditScope.cbFct()}static show(t,e){DlgEditScope.cbFct=e;let i=t;i+=Html.selectList("editScope",[0,1],["Modify current instance","Modify all instances"],0);showDlg("Edit Option",i,Html.dlgBtn("DlgEditScope.onApply()"))}}class DlgExportData{static onFilChanged(){let t=selectedNum("smplFil",0)==2?"<b>Apply</b>":"<b>Start Export</b>";$("expBtn").innerHTML=t}static onProps(){let t=selectedNum("smplFil",0);DlgExportData.expErr=$("doErr").checked;DlgExportData.expInfos=$("doInf").checked;DlgExportData.expQf=$("doQf").checked;DlgExportData.expHist=false;DlgExportData.expCompact=false;if(DlgExportData.option!="miExpNetCDF"){DlgExportData.expHist=$("doHist").checked;DlgExportData.expCompact=$("doComp").checked}hideDlg();if(t==2)DlgSmplFilter.show(-20,DlgExportData.onSmplFilProps);else DlgExportData.startExport(DlgExportData.emvIds,DlgExportData.dvIds,DlgExportData.expErr,DlgExportData.expInfos,DlgExportData.expQf,DlgExportData.expHist,DlgExportData.expCompact,t)}static onSelectDvs(){DlgExportData.dvIds=selectedNums("selectList");hideDlg();if(DlgExportData.option=="miExpCollection")DlgExportData.startExport(DlgExportData.emvIds,DlgExportData.dvIds,true,true,true,true,false,0);else{let t="<fieldset>",e=DlgExportData.option=="miExpNetCDF";t+="<p>Data Filter:&ensp;"+Html.selectList("smplFil",[0,1,2],["Export all data","Reject outliers","Customize filter settings"],0)+"</p>";if(!e)t+="<p>"+Html.checkBox("doComp","Use compact output format",1)+"</p>";t+="<p>"+Html.checkBox("doQf","Export data quality flags",1)+"</p>";t+="<p>"+Html.checkBox("doErr","Export data errors",1)+"</p>";t+="<p>"+Html.checkBox("doInf","Export data infos",1)+"</p>";if(!e)t+="<p>"+Html.checkBox("doHist","Export history",1)+"</p>";t+="</fieldset>";showDlg((e?"NetCDF":"Spreadsheet")+" Properties",t,Html.dlgBtn("DlgExportData.onProps()","Start Export","expBtn"));$("smplFil").addEventListener("change",DlgExportData.onFilChanged)}}static onSelectExtMvs(){DlgExportData.emvIds=selectedNums("selectList");hideDlg();DlgExportData.selectDvs()}static onSmplFilProps(t){DlgExportData.startExport(DlgExportData.emvIds,DlgExportData.dvIds,DlgExportData.expErr,DlgExportData.expInfos,DlgExportData.expQf,DlgExportData.expHist,DlgExportData.expCompact,2,t)}static selectDvs(){let t=DlgExportData.option=="miExpCollection"?"Start Export":"Select";let e=dataVarIdsFromAvail(valDataCountsByVar,1);let i=e;DlgSelectItems.show("Select Data Variables for Export",dataVarIds(view.drvdVarArr,1),dataVarFullLabels(view.drvdVarArr),"DlgExportData.onSelectDvs()",i,t,e,"Select Items with Data")}static show(t,e){DlgExportData.option=t;DlgExportData.outFileName=e;DlgExportData.emvIds=[];let i=[];metaVarExtendedIds.map(t=>i.push(t+": "+fullVarLabel(metaVarUNames[t-1],metaVarUUnits[t-1])));if(i.length>0)DlgSelectItems.show("Select Extended Metadata Variables for Export",metaVarExtendedIds,i,"DlgExportData.onSelectExtMvs()",metaVarExtendedIds);else DlgExportData.selectDvs()}static startExport(t,e,i,a,s,l,r,n,o){let d="txt";if(DlgExportData.option=="miExpCollection")d="odv";else if(DlgExportData.option=="miExpNetCDF")d="nc";let m='{"cmd":"export_data","name":"'+DlgExportData.outFileName+"."+d+'","var_ids":['+e.join()+'],"extended_metavar_ids":['+t.join()+'],"error_export":'+i+',"info_export":'+a+',"quality_flag_export":'+s+',"history_export":'+l+',"compact_export":'+r+',"sample_filter_type":'+n;if(n==2&&o!=undefined)m+=',"sample_filter_snippet":"'+o+'"';sendWsMsg(m+"}")}}class DlgExportHist{static show(){let t='<table class="StdTable">';t+="<tr><td>Station set:</td><td>"+Html.selectList("setId",[0,1],["Current station set","Current station"],0)+"</td></tr>";t+="<tr><td>Filter substring:</td><td>"+Html.txtInput("filStr")+"</td></tr>";t+="</table><p>Leave the filter substring empty to export all records.</p>";showDlg("Export Station History",t,Html.dlgBtn("DlgExportHist.startExport()","Start Export"))}static startExport(){let t=selectedNum("setId",0);let e=strFromElem("filStr","");hideDlg();sendWsMsg('{"cmd":"export_history","filter_substring":"'+e+'","station_set":'+t+"}")}}class DlgExprVar{static addInpVar(){let t=selectedNum("inpChoices",-1);if(t>-1){DlgDrvdVars.dv.inpVarIds.push(t);DlgExprVar.updateDefined()}}static inFix2postFix(){dlgQueryStr("Infix Expression","Expression in Infix Notation","","DlgExprVar.onInFix2postFix()","Convert")}static onApply(){let t=DlgDrvdVars.dv;t.name=strFromElem("varName","Expression");t.units=strFromElem("varUnits","");t.uname=t.name;t.uunits=t.units;t.digitsCount=numFromElem("digitsCount",2);t.expr=$("PfExpr").value;hideDlg();DlgDrvdVars.addVar(DlgExprVar.updateIdx)}static onInFix2postFix(){let t=$("queryStr").value;hideDlg();if(t.length>0)sendWsMsg('{"cmd":"convert_infix_to_postfix","infix_expression":"'+t+'"}')}static rmInpVar(){let t=selectedNums("inpDefined",-1);if(t.length>0){DlgDrvdVars.dv.inpVarIds=strippedArray(DlgDrvdVars.dv.inpVarIds,t);DlgExprVar.updateDefined()}}static show(t=-1){let e=DlgDrvdVars.dv;DlgExprVar.updateIdx=t;let i,a='<table class="StdTable">';a+='<tr><th width="300px">Label</th><th width="200px">Units</th><th>Digits</th></tr>';a+="<tr><td>"+Html.txtInput("varName",e.uname,"100%")+"</td><td>"+Html.txtInput("varUnits",e.uunits,"100%")+"</td><td>"+Html.numInput("digitsCount",e.digitsCount,0,8)+"</td></tr></table>";a+="<p><fieldset><legend><b>Input Variables</b></legend>";a+='<table class="StdTable">';a+="<tr><td>Defined</td><td></td><td>Choices</td></tr>";a+='<tr><td rowspan="2"><div id="divDefined"></div></td><td>'+Html.button("<b> << </b>","DlgExprVar.addInpVar()")+'</td><td rowspan="2">'+Html.selectList("inpChoices",dataVarIds(wrkArr),dataVarFullLabels(wrkArr,true),-1)+"</td></tr>";a+="<tr><td>"+Html.button("<b> >> </b>","DlgExprVar.rmInpVar()")+"</td></tr>";a+="</table></fieldset></p>";a+="<p><fieldset><legend><b>Expression in Postfix Notation</b></legend>";a+='<textarea id="PfExpr" style="width:100%;height:80px;">'+e.expr+"</textarea>";a+="<p>"+Html.button("Validate","DlgExprVar.validatePfExpr()")+"&emsp;&emsp;";a+=Html.button("Enter Infix Expression","DlgExprVar.inFix2postFix()")+"</p>";a+="</fieldset></p>";showDlg("Edit Expression",a,Html.dlgBtn("DlgExprVar.onApply()"));i=$("varName");i.focus();i.select();i=$("inpChoices");i.size=5;i.selectedIndex=-1;i.style.width="250px";DlgExprVar.updateDefined()}static updateDefined(){let t=DlgDrvdVars.dv.inpVarIds,e=[],i=[];t.map((a,s)=>{e.push(s);i.push("#"+(s+1)+" "+dataVarFullLabel(t[s],true,wrkArr))});$("divDefined").innerHTML=Html.selectList("inpDefined",e,i,-1);let a=$("inpDefined");a.size=5;a.style.width="250px"}static validatePfExpr(){let t=$("PfExpr").value;sendWsMsg('{"cmd":"compile_postfix_expression","postfix_expression":"'+t+'"}')}}class DlgGObject{static goStr(t,e){return"<p><b>"+t+"</b>:&emsp;"+Html.txtInput("goText",e,"28em")+"</p>"}static onApply(){let t=DlgGObject.winId,e=DlgGObject.gObj,i=e.type,a=0;if(i==1||i==30){let t=strFromElem("goText",e.text);if(t!=e.text){e.text=t;++a}}if(i==1||i==5||i==40){if(e.xCoord!=undefined){let t=numFromElem("goXpos",e.xCoord);if(t!=e.xCoord){e.xCoord=t;++a}let i=numFromElem("goYpos",e.yCoord);if(i!=e.yCoord){e.yCoord=i;++a}}if(i==1){let t=textAlignIdx(selectedNum("goXal",1),selectedNum("goYal",1));if(t!=e.align){e.align=t;++a}}}if(i==1||i==40||i==42){let t=selectedNum("goTxtCol",e.txtColor);if(t!=e.txtColor){e.txtColor=t;++a}let s=selectedNum("goBckCol",e.fColor);if(s!=e.fColor){e.fColor=s;++a}let l=numFromElem("goPtSize",e.ptSize);if(l!=DlgGObject.ptSize){e.ptSize=l;++a}let r=selectedNum("goBCol",e.bColor);if(r!=e.bColor){e.bColor=r;++a}if(i==1){let t=numFromElem("goAngle",e.angle);if(t!=e.angle){e.angle=t;++a}}else if(i==42){let t=numFromElem("goArrLen",e.arrLen*10)*.1;if(t!=e.arrLen){e.arrLen=t;++a}}let n=selectedNum("goBWidth",e.bWidth);if(n!=e.bWidth){e.bWidth=n;++a}}if(i==5||i==30){let t=selectedNum("goSymbType",e.symbTyp);if(t!=e.symbTyp){e.symbTyp=t;++a}let i=selectedNum("goSymbFCol",e.fColor);if(i!=e.fColor){e.fColor=i;++a}let s=numFromElem("goSymbSize",DlgGObject.symbSize);if(s!=DlgGObject.symbSize){e.symbSize=.1*s;++a}let l=selectedNum("goSymbBCol",e.bColor);if(l!=e.bColor){e.bColor=l;++a}}if(i==11||i==12||i==30){let t=selectedNum("goLWidth",e.lWidth);if(t!=e.lWidth){e.lWidth=t;++a}let i=selectedNum("goLStyle",e.lStyle);if(i!=e.lStyle){e.lStyle=i;++a}let s=selectedNum("goLCol",e.lColor);if(s!=e.lColor){e.lColor=s;++a}}if(i==12){let t=selectedNum("goFCol",e.fColor);if(t!=e.fColor){e.fColor=t;++a}}if(i==11){let t=selectedNum("goStartSymbType",e.startSymbType);if(t!=e.startSymbType){e.startSymbType=t;++a}let i=numFromElem("goStartSymbSize",e.startSymbSize);if(i!=DlgGObject.startSymbSize){e.startSymbSize=.1*i;++a}let s=selectedNum("goEndSymbType",e.endSymbType);if(s!=e.endSymbType){e.endSymbType=s;++a}let l=numFromElem("goEndSymbSize",e.endSymbSize);if(l!=DlgGObject.endSymbSize){e.endSymbSize=.1*l;++a}}if(!(i==40||i==42)){let i=selectedNum("goOwner",-1);let s=selectedNum("goCoords",-1)==t?"T":"F";if(s!=e.ownCoords){e.ownCoords=s;++a}}let s=isChecked("goPrePlot")?"F":"T";if(s!=e.postData){e.postData=s;++a}let l=checkBoxState("goDragging");if(l!=e.dragging){e.dragging=l;++a}let r=checkBoxState("goDoClip");if(r!=e.clipping){e.clipping=r;++a}if(i==11||i==12){let t=checkBoxState("goSmooth");if(t!=e.doSmooth){e.doSmooth=t;++a}}hideDlg();if(!DlgGObject.requModify||a>0)sendUpdateGobjMsg(t,i,view.gObjectSet(t))}static show(t,e,i=true){let a=t.type,s=paletteName(e),l=windowNameFromId(e),r="",n;DlgGObject.gObj=t;DlgGObject.winId=e;DlgGObject.requModify=i;if(a==1||a==30)r+=DlgGObject.goStr(a==1?"Text":"Legend",t.text);if(a==1||a==5||a==40){r+='<p><table class="StdTable">';if(t.xCoord!=undefined)r+="<tr><td><b>Position</b>&emsp;</td><td>X:</td><td>"+Html.txtInput("goXpos",t.xCoord)+"&emsp;</td><td>Y:</td><td>"+Html.txtInput("goYpos",t.yCoord)+"</td></tr>";if(a==1)r+="<tr><td><b>Alignment</b>&emsp;</td><td>X:</td><td>"+Html.selectListAlignX("goXal",xAlignIdx[t.align])+"&emsp;</td><td>Y:</td><td>"+Html.selectListAlignY("goYal",yAlignIdx[t.align])+"</td></tr>";r+="</table></p>"}if(a==1||a==40||a==42){if(a==1)n="Orientation [&deg;]:</td><td>"+Html.numInput("goAngle",t.angle,0,360,5);else if(a==42)n="Arrow length [mm]:</td><td>"+Html.numInput("goArrLen",t.arrLen*10,1,100,1);else if(a==40)n="</td><td>";DlgGObject.ptSize=roundedVal(t.ptSize,0);r+="<p><fieldset><legend><b>Properties</b></legend>";r+='<table class="StdTable">';r+="<tr><td>Text color:</td><td>"+Html.selectListColor("goTxtCol",s,t.txtColor)+"</td><td>Background:</td><td>"+Html.selectListColor("goBckCol",s,t.fColor,true)+"</td></tr>";r+="<tr><td>Font size [pt]:</td><td>"+Html.numInput("goPtSize",DlgGObject.ptSize,1,99)+"</td><td>Frame color:</td><td>"+Html.selectListColor("goBCol",s,t.bColor,true)+"</td></tr>";r+="<tr><td>"+n+"</td><td>Frame width:</td><td>"+Html.selectListLineWidth("goBWidth",t.bWidth,true)+"</td></tr>";r+="</table></fieldset></p>"}if(a==5||a==30){DlgGObject.symbSize=roundedVal(t.symbSize*10,0);r+="<p><fieldset><legend><b>Symbol</b></legend>";r+='<table class="StdTable">';r+="<tr><td>Type:</td><td>"+Html.selectListSymbol("goSymbType",t.symbTyp)+"</td><td>Fill color:</td><td>"+Html.selectListColor("goSymbFCol",s,t.fColor,true)+"</td></tr>";r+="<tr><td>Size [.1 mm]:</td><td>"+Html.numInput("goSymbSize",DlgGObject.symbSize,1,499)+"</td><td>Border color:</td><td>"+Html.selectListColor("goSymbBCol",s,t.bColor,true)+"</td></tr>";r+="<tr><td></td><td></td><td>Border width:</td><td>"+Html.selectListLineWidth("goSymbBWidth",t.bWidth,true)+"</td></tr>";r+="</table></fieldset></p>"}if(a==11||a==12||a==30){r+="<p><fieldset><legend><b>Line</b></legend>";r+='<table class="StdTable">';r+="<tr><td>"+Html.selectListLineWidth("goLWidth",t.lWidth)+"</td><td>"+Html.selectListLineStyle("goLStyle",t.lStyle)+"</td><td>"+Html.selectListColor("goLCol",s,t.lColor,true)+"</td></tr>";r+="</table></fieldset></p>"}if(a==12)r+="<p><b>Fill</b>:&emsp;"+Html.selectListColor("goFCol",s,t.fColor,true)+"</p>";if(a==11){DlgGObject.startSymbSize=roundedVal(t.startSymbSize*10,0);DlgGObject.endSymbSize=roundedVal(t.endSymbSize*10,0);r+='<p><table class="StdTable"><tr><td><fieldset><legend><b>Start type</b></legend><table class="StdTable"><tr><td>Type:</td><td>'+Html.selectListLineStartEnd("goStartSymbType",t.startSymbType)+"</td></tr><tr><td>Size [.1 mm]:</td><td>"+Html.numInput("goStartSymbSize",DlgGObject.startSymbSize,1,499)+'</td></tr></table></fieldset></td><td><fieldset><legend><b>End type</b></legend><table class="StdTable"><tr><td>Type:</td><td>'+Html.selectListLineStartEnd("goEndSymbType",t.endSymbType)+"</td></tr><tr><td>Size [.1 mm]:</td><td>"+Html.numInput("goEndSymbSize",DlgGObject.endSymbSize,1,499)+"</td></tr></table></fieldset></td></tr></table></p>"}if(!(a==40||a==41||a==42))r+='<p><fieldset><legend><b>Ownership</b></legend><table class="StdTable"><tr><td>Owner:</td><td>'+Html.selectListGObjOwner("goOwner",e,t)+"</td><td>&emsp;Coordinates:</td><td>"+Html.selectListGObjCoords("goCoords",e,t)+"</td></tr></table></fieldset></p>";r+="<p>"+Html.checkBox("goPrePlot","Pre-data plot",t.postData=="F")+"&emsp;"+Html.checkBoxTF("goDoClip","Clip to window",t.clipping)+"&emsp;"+Html.checkBoxTF("goDragging","Allow dragging",t.dragging);if(a==11||a==12)r+="&emsp;"+Html.checkBoxTF("goSmooth","Bezier smoothing",t.doSmooth);else if(a==30)r+="&emsp;"+Html.checkBoxTF("goAddLgd","Add to legends",t.addLgd);r+="</p>";showDlg(gObjName(a)+" - Properties",r,Html.dlgBtn("DlgGObject.onApply()"));if(a==1||a==30){let t=$("goText");t.focus();t.select()}}}class DlgIdentKeyVars{static associate(t,e){DlgIdentKeyVars.kvIds.push(t);DlgIdentKeyVars.kvdIds.push(e)}static enableButtons(){let t=DlgIdentKeyVars.kvSel.firstSelection();let e=DlgIdentKeyVars.dvSel.firstSelection();$("IkvBtnUndoAll").disabled=DlgIdentKeyVars.kvIds.length==0;if(t==-1){$("IkvBtnAssoc").disabled=true;$("IkvBtnNotAvail").disabled=true;$("IkvBtnUndo").disabled=true;return}let i=DlgIdentKeyVars.kvIds.indexOf(keyVarIdChoices[t]);let a=i>-1?DlgIdentKeyVars.kvdIds[i]:-1;let s=false,l=false,r=false;if(e>-1&&a<=-1)s=true;if(a!=-2)l=true;if(a==-2||e>-1&&a==e)r=true;$("IkvBtnAssoc").disabled=!s;$("IkvBtnNotAvail").disabled=!l;$("IkvBtnUndo").disabled=!r}static onApply(){hideDlg();sendWsMsg('{"cmd":"assign_key_variables","keyvar_ids":'+JSON.stringify(DlgIdentKeyVars.kvIds)+',"var_ids":'+JSON.stringify(DlgIdentKeyVars.kvdIds)+"},"+msgGetDockLbls+","+msgGetCollInfo+","+msgGetCanvasViewCurrInfo+","+msgGetDrvdVarChoices)}static onAssoc(){let t=DlgIdentKeyVars.kvSel.firstSelection();let e=keyVarIdChoices[t];DlgIdentKeyVars.removeAt(DlgIdentKeyVars.kvIds.indexOf(e));DlgIdentKeyVars.associate(e,DlgIdentKeyVars.dvSel.firstSelection());DlgIdentKeyVars.updateLists()}static onClickDv(t){t.preventDefault();const e=t.target;if(e==undefined)return;let i=e.parentNode.rowIndex,a;DlgIdentKeyVars.dvSel.select(i);let s=DlgIdentKeyVars.kvdIds.indexOf(i);if(s>-1){a=keyVarIdChoices.indexOf(DlgIdentKeyVars.kvIds[s]);DlgIdentKeyVars.kvSel.select(a);DlgIdentKeyVars.kvSel.scrollTo(a)}DlgIdentKeyVars.enableButtons()}static onClickKv(t){t.preventDefault();const e=t.target;if(e==undefined)return;let i=e.parentNode.rowIndex,a;DlgIdentKeyVars.kvSel.select(i);let s=DlgIdentKeyVars.kvIds.indexOf(keyVarIdChoices[i]);if(s>-1){a=DlgIdentKeyVars.kvdIds[s];if(a>-1){DlgIdentKeyVars.dvSel.select(a);DlgIdentKeyVars.dvSel.scrollTo(a)}}DlgIdentKeyVars.enableButtons()}static onNotAvail(){let t=DlgIdentKeyVars.kvSel.firstSelection();let e=keyVarIdChoices[t];DlgIdentKeyVars.removeAt(DlgIdentKeyVars.kvIds.indexOf(e));DlgIdentKeyVars.associate(e,-2);DlgIdentKeyVars.updateLists()}static onUndo(){let t=DlgIdentKeyVars.kvSel.firstSelection();let e=DlgIdentKeyVars.kvIds.indexOf(keyVarIdChoices[t]);DlgIdentKeyVars.removeAt(e);DlgIdentKeyVars.updateLists()}static onUndoAll(){DlgIdentKeyVars.kvIds=[];DlgIdentKeyVars.kvdIds=[];DlgIdentKeyVars.updateLists()}static removeAt(t){if(t<0||t>=DlgIdentKeyVars.kvIds.length)return;DlgIdentKeyVars.kvIds.splice(t,1);DlgIdentKeyVars.kvdIds.splice(t,1)}static show(){DlgIdentKeyVars.kvIds=[...keyVarIds];DlgIdentKeyVars.kvdIds=[...keyVarDataVarIds];let t='<fieldset><div id="IkvDiv">';t+='<div id="IkvKvLbl"><b>Key variables</b></div>';t+='<div id="IkvKvTblDiv" class="has-border"></div>';t+='<div id="IkvBtnDiv"><p>'+Html.button("Associate","DlgIdentKeyVars.onAssoc()","IkvBtnAssoc")+"</p><p>"+Html.button("Not Available","DlgIdentKeyVars.onNotAvail()","IkvBtnNotAvail")+"</p><p>"+Html.button("Undo","DlgIdentKeyVars.onUndo()","IkvBtnUndo")+"</p><p>"+Html.button("Undo All","DlgIdentKeyVars.onUndoAll()","IkvBtnUndoAll")+"</p></div>";t+='<div id="IkvCvLbl"><b>Data variables</b></div>';t+='<div id="IkvCvTblDiv" class="has-border"></div>';t+="</div></fieldset>";showDlg("Identify Key Variables",t,Html.dlgBtn("DlgIdentKeyVars.onApply()"));DlgIdentKeyVars.updateLists()}static updateLists(){let t,e=keyVarIdChoices.length,i,a,s,l;let r,n,o,d,m;m='<table id="IkvKvTbl" class="StdTable">';for(t=0;t<e;++t){r=keyVarIdChoices[t];n=DlgIdentKeyVars.kvIds.indexOf(r);o=n>-1?DlgIdentKeyVars.kvdIds[n]:-1;if(o==-1)d="&ensp;";else if(o==-2)d="- ";else d="* ";m+="<tr><td>"+d+keyVarLblChoices[t]+"</td></tr>"}$("IkvKvTblDiv").innerHTML=m+"</table>";m='<table id="IkvCvTbl" class="StdTable">';for(t=0;t<dataVarCount;++t){d=DlgIdentKeyVars.kvdIds.indexOf(t)>-1?"* ":"&ensp;";m+="<tr><td>"+d+" "+(t+1)+": "+fullVarLabel(dataVarUNames[t],dataVarUUnits[t])+"</td></tr>"}$("IkvCvTblDiv").innerHTML=m+"</table>";s=$("IkvKvTbl");l=Array.from(s.rows);s.addEventListener("click",DlgIdentKeyVars.onClickKv);DlgIdentKeyVars.kvSel=new XSelector(l,false,false);i=$("IkvCvTbl");a=Array.from(i.rows);i.addEventListener("click",DlgIdentKeyVars.onClickDv);DlgIdentKeyVars.dvSel=new XSelector(a,false,false);DlgIdentKeyVars.enableButtons()}}class DlgImage{static saveAs(){saveBlobAs(DlgImage.blobBody,DlgImage.head.file)}static show(t,e){DlgImage.blobBody=t;DlgImage.head=e;let i='<div id="CustomDivArea"><img id="CustomImageArea"> </div>';showDlg(e.caption,i,Html.dlgBtnC("hideDlg()","Close")+"&emsp;&emsp;"+Html.dlgBtnC("DlgImage.saveAs()","Save As"))}}class DlgIsopynals{static onApply(){let t=view.dataWinArr[rclickWinId-1];t.drawIsop=checkBoxState("IsopDoDraw");t.isopRefPress=numFromElem("IsopRefPress",0);t.isopColor=selectedNum("IsopLineCol",8);t.isopLWidth=selectedNum("IsopLWidth",1);t.isopLStyle=selectedNum("IsopLStyle",0);hideDlg();sendWsMsg(Msg.modifyView(t.toXmlDataWindowOpen(rclickWinId)+t.toXmlIsopycnal()+t.toXmlDataWindowClose())+","+msgGetCanvasViewCurrInfo)}static show(){let t=view.dataWinArr[rclickWinId-1];let e='<p><fieldset><legend>Properties</legend><table class="StdTable">';e+="<tr><td>"+Html.numInput("IsopRefPress",t.isopRefPress,0,9999,500)+"</td><td>Reference Pressure [dbar]</td></tr>";e+="<tr><td>"+Html.selectListColor("IsopLineCol",t.palName,t.isopColor)+"</td><td>Line Color</td></tr>";e+="<tr><td>"+Html.selectListLineWidth("IsopLWidth",t.isopLWidth)+"</td><td>Line width</td></tr>";e+="<tr><td>"+Html.selectListLineStyle("IsopLStyle",t.isopLStyle)+"</td><td>Line style</td></tr></table>";e+="<p>"+Html.checkBoxTF("IsopDoDraw","Draw isopycnals",t.drawIsop)+"</p>";e+="</fieldset></p>";e+="<p>Isopycnals can be drawn if Practical Salinity is on X<br>and Potential Temperature is on Y, or if Absolute<br>Salinity is on X and Conservative Temperature is on Y.</p>";showDlg("Isopynal Properties",e,Html.dlgBtn("DlgIsopynals.onApply()"))}}class DlgIsoVars{static enableButtons(){let t=selectedNums("IsoVarList"),e=t.length;$("delIsoVarsBttn").disabled=e==0;$("edtIsoVarsBttn").disabled=e!=1;$("vsyIsoVarsBttn").disabled=e!=1;$("ssyIsoVarsBttn").disabled=e!=1;if(e!=1||t[0]!=DlgIsoVars.edtIdx)DlgIsoVars.edtIdx=-1;$("addIsoVarsBttn").innerHTML=DlgIsoVars.edtIdx>-1?"Update":"Add"}static onAdd(){let t=selectedNum("dispVarSel",-1);let e=selectedNum("surfVarSel",-1);let i=strFromElem("surfVal","first");if(i==="first"||i==="last"||i==="minimum"||i==="maximum"||numFromStr(i,missDOUBLE)!=missDOUBLE){let a=DlgIsoVars.edtIdx;if(a==-1)wrkArr.push(new IsoVar(t,e,i));else{let s=wrkArr[a];s.varId=t;s.surfVarId=e;s.surfVal=i;DlgIsoVars.edtIdx=-1}DlgIsoVars.update()}}static onApply(){view.isoVarSet.isoVarArr=wrkArr;hideDlg();sendWsMsg(Msg.setIsoVars()+","+msgGetDockIsoVarLbls+","+msgGetCanvasViewCurrInfo)}static onDelete(){let t=selectedNums("IsoVarList");if(t.length>0){wrkArr=strippedArray(wrkArr,t);DlgIsoVars.update()}}static onEdit(){DlgIsoVars.edtIdx=selectedNum("IsoVarList");DlgIsoVars.enableButtons();let t=wrkArr[DlgIsoVars.edtIdx];$("dispVarSel").selectedIndex=dockDataVarIds.indexOf(t.varId);$("surfVarSel").selectedIndex=dockDataVarIds.indexOf(t.surfVarId);setInputElemStr("surfVal",t.surfVal)}static onSSync(){let t=selectedNum("IsoVarList"),e=wrkArr.length;let i=wrkArr[t].surfVarId,a=wrkArr[t].surfVal;for(t=0;t<e;++t){wrkArr[t].surfVarId=i;wrkArr[t].surfVal=a}DlgIsoVars.update()}static onVSync(){let t=selectedNum("IsoVarList"),e=wrkArr.length,i=wrkArr[t].varId;for(t=0;t<e;++t)wrkArr[t].varId=i;DlgIsoVars.update()}static show(){wrkArr=view.isoVarSet.isoVarArr;dlgOrigVals=new Map;DlgIsoVars.edtIdx=-1;let t="<fieldset><legend><b>New</b></legend>";t+="<p>"+Html.selectList("dispVarSel",dockDataVarIds,dockDataVarLabels,1)+"&emsp;@&emsp;"+Html.selectList("surfVarSel",dockDataVarIds,dockDataVarLabels,0)+"&emsp;=&emsp;"+Html.txtInput("surfVal","first")+"</p>";t+='<span style="float:right">'+Html.button("Add","DlgIsoVars.onAdd()","addIsoVarsBttn")+"</span>";t+="</fieldset>";t+="<p><fieldset><legend><b>Already Defined</b></legend>";t+="<p>"+Html.selectList("IsoVarList",[],[],-1,1)+"</p>";t+=Html.button("Delete","DlgIsoVars.onDelete()","delIsoVarsBttn")+"&ensp;";t+=Html.button("Edit","DlgIsoVars.onEdit()","edtIsoVarsBttn");t+='<span style="float:right">'+Html.button("V-Sync","DlgIsoVars.onVSync()","vsyIsoVarsBttn")+"&ensp;"+Html.button("S-Sync","DlgIsoVars.onSSync()","ssyIsoVarsBttn")+"</span>";t+="</fieldset></p>";showDlg("Isosurface Variables",t,Html.dlgBtn("DlgIsoVars.onApply()"));$("dispVarSel").setAttribute("style","max-width:250px");$("surfVarSel").setAttribute("style","max-width:160px");$("IsoVarList").setAttribute("style","width:100%");$("IsoVarList").addEventListener("click",DlgIsoVars.enableButtons);DlgIsoVars.update()}static update(){let t,e=[],i=[],a=$("IsoVarList"),s=$("delIsoVarsBttn");for(let a=0;a<wrkArr.length;++a){t=wrkArr[a];e.push(a);i.push(dataVarAtFullLbl(t.varId,t.surfVarId,t.surfVal))}a.innerHTML=Html.selectListContents(e,i,[]);a.setAttribute("size",4);DlgIsoVars.enableButtons()}}class DlgMapWin{static onApply(){let t=view.mapWin;t.palName=selectedStr("palName","Odv");t.fontSizeFac=numFromElem("fontSizeFac",100);t.bckColor=selectedNum("bckColor",31);t.gridColor=selectedNum("gridColor",0);t.drawGrid=checkBoxState("drawGrid");t.drawLabels=checkBoxState("drawLabels");t.symbSize=numFromElem("symbSize",7)*.1;t.symbColor=selectedNum("symbColor",1);t.wLon=numFromElem("wLon",-1e10);t.eLon=numFromElem("eLon",1e10);t.sLat=numFromElem("sLat",-1e10);t.nLat=numFromElem("nLat",1e10);let e=dlgValChanged("wLon",t.wLon)||dlgValChanged("eLon",t.eLon)||dlgValChanged("sLat",t.sLat)||dlgValChanged("nLat",t.nLat);t.prjType=selectedNum("prjType",0);if(e){t.prjCntrLon=.5*(t.wLon+t.eLon);t.prjCntrLat=.5*(t.sLat+t.nLat)}else{t.prjCntrLon=numFromElem("prjCntrLon",.5*(t.wLon+t.eLon));t.prjCntrLat=numFromElem("prjCntrLat",.5*(t.sLat+t.nLat));let e=t.eLon-t.wLon;t.eLon=t.prjCntrLon+.5*e;t.wLon=t.prjCntrLon-.5*e}t.doBathy=checkBoxState("doBathy");t.doCoast=checkBoxState("doCoast");t.doTopo=checkBoxState("doTopo");t.doRivers=checkBoxState("doRivers");t.doBorders=checkBoxState("doBorders");t.fillCoast=checkBoxState("fillCoast");t.colBarAlign=isChecked("colBarAlign")?1:0;hideDlg();sendWsMsg(Msg.setMapProperties()+","+msgGetCanvasViewCurrInfo)}static onFullDomain(){setInputElemStr("wLon","");setInputElemStr("eLon","");setInputElemStr("sLat","");setInputElemStr("nLat","")}static onGlobalMap(){setInputElemStr("wLon","-180");setInputElemStr("eLon","180");setInputElemStr("sLat","-90");setInputElemStr("nLat","90")}static onPaletteChange(){let t=paletteIndex(selectedStr("palName","Odv"));updateSelectListColor("bckColor",t);updateSelectListColor("gridColor",t);updateSelectListColor("symbColor",t)}static show(){const t="DlgMapWin",e=getLastOpenElem(t);let i=view.mapWin;dlgOrigVals=new Map;let a='<div class="TabbedDlg" id="'+t+'" style="width: 480px">';a+=Html.panelBegin(t,1,"General",e==1);a+=Html.winGeneral(i.palName,i.fontSizeFac,i.bckColor,i.gridColor,i.drawGrid,i.drawLabels);a+=Html.panelEnd();a+=Html.panelBegin(t,2,"Display Style",e==2);a+='<table class="StdTable">';a+="<tr><td>Station Dot Size:</td><td>"+Html.numInput("symbSize",roundedVal(i.symbSize*10,1),-1,99)+"</td></tr>";a+="<tr><td>Station Dot Color:</td><td>"+Html.selectListColor("symbColor",i.palName,i.symbColor,false,true)+"</td></tr>";a+="</table>";a+=Html.panelEnd();dlgOrigVals.set("wLon",roundedVal(i.wLon,5));dlgOrigVals.set("eLon",roundedVal(i.eLon,5));dlgOrigVals.set("sLat",roundedVal(i.sLat,5));dlgOrigVals.set("nLat",roundedVal(i.nLat,5));a+=Html.panelBegin(t,3,"Domain",e==3);a+='<table id="MapDomainTbl">';a+="<tr><td></td><td>North</td><td></td></tr>";a+="<tr><td></td><td>"+Html.txtInput("nLat",dlgOrigVals.get("nLat"))+"</td><td></td></tr>";a+='<tr><td></td><td rowspan="6"><img src="'+resourceRoot+'img/windrose.png"></td><td></td></tr>';a+='<tr><td colspan="3">&nbsp;</td></tr>';a+="<tr><td>West</td><td></td><td>East</td><td></td></tr>";a+="<tr><td>"+Html.txtInput("wLon",dlgOrigVals.get("wLon"))+"</td><td></td><td>"+Html.txtInput("eLon",dlgOrigVals.get("eLon"))+"</td></tr>";a+='<tr><td colspan="3">&nbsp;</td></tr>';a+='<tr><td colspan="2">&nbsp;</td><td></td></tr>';a+="<tr><td></td><td>South</td><td></td><td></td><td>"+Html.button("Full Domain","DlgMapWin.onFullDomain()","btnFullDomain")+"</td></tr>";a+="<tr><td></td><td>"+Html.txtInput("sLat",dlgOrigVals.get("sLat"))+"</td><td></td><td></td><td>"+Html.button("Global Map","DlgMapWin.onGlobalMap()","btnGlobalMap")+"</td></tr>";a+="</table>";a+=Html.panelEnd();a+=Html.panelBegin(t,4,"Projection",e==4);a+=Html.selectList("prjType",[0,1,2,3,5,4,7],["Default Projection","Orthographic (North Polar)","Orthographic (Equatorial)","Orthographic (South Polar)","Orthographic (Oblique)","Mollweide","Mercator"],i.prjType);a+='<p>&nbsp;</p><table class="StdTable">';a+="<tr><td>Pole Longitude:</td><td>"+Html.txtInput("prjCntrLon",roundedVal(i.prjCntrLon,4))+" &#176E</td></tr>";a+="<tr><td>Pole Latitude:</td><td>"+Html.txtInput("prjCntrLat",roundedVal(i.prjCntrLat,4))+" &#176N</td></tr>";a+="</table>";a+=Html.panelEnd();a+=Html.panelBegin(t,5,"Layers",e==5);a+="<div>"+Html.checkBoxTF("doBathy","Ocean bathymetry",i.doBathy)+"</div>";a+="<div>"+Html.checkBoxTF("doCoast","Coastlines",i.doCoast)+"</div>";a+="<div>"+Html.checkBoxTF("doTopo","Land topography",i.doTopo)+"</div>";a+="<div>"+Html.checkBoxTF("doRivers","Lakes and rivers",i.doRivers)+"</div>";a+="<div>"+Html.checkBoxTF("doBorders","Borders",i.doBorders)+"</div>";a+="<div>&nbsp;</div>";a+="<div>"+Html.checkBoxTF("fillCoast","Fill coastlines",i.fillCoast)+"</div>";a+="<div>"+Html.checkBox("colBarAlign","Draw color bar",i.colBarAlign)+"</div>";a+=Html.panelEnd()+"</div>";showDlg("Map Properties",a,Html.dlgBtn("DlgMapWin.onApply()"));$("tabPanel"+e).click();$("palName").addEventListener("change",DlgMapWin.onPaletteChange)}}class DlgMultiSample{static onClick(t){DlgMultiSample.setCurrentRow(t.target.parentNode.id)}static onSelect(){hideDlg();let t=parseInt(DlgMultiSample.currRow.id.slice(4));let e=Msg.selectSampleByStationId(DlgMultiSample.statIds[t],DlgMultiSample.smplIds[t]);sendWsMsg(e+","+msgGetCurrInfo)}static setCurrentRow(t){let e=$(t);if(e!=null){if(DlgMultiSample.currRow!=undefined)unselect(DlgMultiSample.currRow);select(e);DlgMultiSample.currRow=e}}static show(t,e,i,a,s,l,r,n,o,d,m){DlgMultiSample.statIds=e;DlgMultiSample.smplIds=i;let c,u=e.length;let p='<div id="MultiSampleDiv" class="has-border">';p+='<table id="MultiSampleTable" class="StdTable has-altbckcolor">';p+='<tr id="headerrow"><th></th><th>Station ID</th><th>Sample</th><th>Cruise</th><th>Station</th><th>Date</th><th>Position</th><th>X</th><th>Y</th><th>Z</th></tr>';for(c=0;c<u;++c){p+='<tr id="row:'+c+'"><th>'+(c+1)+"</th><td>"+e[c]+"</td><td>"+a[c]+"</td><td>"+s[c]+"</td><td>"+l[c]+"</td><td>"+r[c]+"</td><td>"+n[c]+"</td><td>"+o[c]+"</td><td>"+d[c]+"</td><td>"+m[c]+"</td></tr>"}p+="</table></div>";showDlg(t+" Matching Samples: Select One ...",p,Html.dlgBtn("DlgMultiSample.onSelect()","Select"));let g=$("MultiSampleDiv");g.scrollTop=g.scrollHeight-g.clientHeight;$("MultiSampleTable").addEventListener("click",DlgMultiSample.onClick);DlgMultiSample.setCurrentRow("row:"+(u-1))}}class DlgMultiStation{static onClick(t){DlgMultiStation.setCurrentRow(t.target.parentNode.id)}static onSelect(){hideDlg();let t=parseInt(DlgMultiStation.currRow.id.slice(4));let e=Msg.selectSampleByStationId(DlgMultiStation.statIds[t],currSmplId);sendWsMsg(e+","+msgGetCurrInfo)}static setCurrentRow(t){let e=$(t);if(e!=null){if(DlgMultiStation.currRow!=undefined)unselect(DlgMultiStation.currRow);select(e);DlgMultiStation.currRow=e}}static show(t,e,i,a,s,l,r,n){DlgMultiStation.statIds=e;let o,d=e.length,m=dataVarFullLabel(primaryVarId);o=m.indexOf(" [");if(o>-1)m=m.substring(0,o);let c='<div id="MultiStationDiv" class="has-border">';c+='<table id="MultiStationTable" class="StdTable has-altbckcolor">';c+='<tr id="headerrow"><th></th><th>Station ID</th><th>Cruise</th><th>Station</th><th>Date</th><th>Position</th><th># Samples</th><th>'+m+" Range</th></tr>";for(o=0;o<d;++o){c+='<tr id="row:'+o+'"><th>'+(o+1)+"</th><td>"+e[o]+"</td><td>"+a[o]+"</td><td>"+s[o]+"</td><td>"+l[o]+"</td><td>"+r[o]+"</td><td>"+i[o]+"</td><td>"+n[o]+"</td></tr>"}c+="</table></div>";showDlg(t+" Matching Stations: Select One ...",c,Html.dlgBtn("DlgMultiStation.onSelect()","Select"));let u=$("MultiStationDiv");u.scrollTop=u.scrollHeight-u.clientHeight;$("MultiStationTable").addEventListener("click",DlgMultiStation.onClick);DlgMultiStation.setCurrentRow("row:"+(d-1))}}class DlgMwStats{static rXh(){$("btnXh").blur();sendWsMsg('{"cmd":"get_image","type":"x_histogram","fmt":"jpg","window_id":0}')}static rYh(){$("btnYh").blur();sendWsMsg('{"cmd":"get_image","type":"y_histogram","fmt":"jpg","window_id":0}')}static rXYh(){$("btnXYh").blur();sendWsMsg('{"cmd":"get_image","type":"xy_histogram","fmt":"jpg","window_id":0}')}static rTh(){$("btnTh").blur();sendWsMsg('{"cmd":"get_image","type":"time_histogram","fmt":"jpg","window_id":0}')}static rSh(){$("btnSh").blur();sendWsMsg('{"cmd":"get_image","type":"season_histogram","fmt":"jpg","window_id":0}')}static show(t){const e="Visible data",i="All data";let a='<table id="MwStatsTbl" class="StdTable has-border">';a+="<tr><th></th>"+Html.toolTipElem("th","Mean",e)+Html.toolTipElem("th","Stand. Dev.",e)+Html.toolTipElem("th","Count",e)+Html.toolTipElem("th","Minimum",i)+Html.toolTipElem("th","Maximum",i)+"</tr>";a+="<tr><td><b>"+t.X.label+"</b></td>"+Html.toolTipElem("td",t.X.mean,e)+Html.toolTipElem("td",t.X.stdev,e)+Html.toolTipElem("td",t.X.count,e)+Html.toolTipElem("td",t.X.min,i)+Html.toolTipElem("td",t.X.max,i)+"</tr>";a+="<tr><td><b>"+t.Y.label+"</b></td>"+Html.toolTipElem("td",t.Y.mean,e)+Html.toolTipElem("td",t.Y.stdev,e)+Html.toolTipElem("td",t.Y.count,e)+Html.toolTipElem("td",t.Y.min,i)+Html.toolTipElem("td",t.Y.max,i)+"</tr>";a+='</table><p>&nbsp;</p><table class="StdTable">';a+="<tr><td>"+Html.button("X Histogram","DlgMwStats.rXh()","btnXh")+"</td><td>"+Html.button("Y Histogram","DlgMwStats.rYh()","btnYh")+"</td><td>"+Html.button("X/Y Distribution","DlgMwStats.rXYh()","btnXYh")+"</td></tr><tr><td>"+Html.button("Time Histogram","DlgMwStats.rTh()","btnTh")+"</td><td>"+Html.button("Season Histogram","DlgMwStats.rSh()","btnSh")+"</td></tr></table>";showDlg("Map Statistics",a,Html.dlgBtn("hideDlg(true)","Close"))}}class DlgSmplFilter{static applyQf(t,e,i){let a=this.Qf.varIds.indexOf(t);if(a>-1){if(i.length==0)DlgSmplFilter.removeQ(a);else this.Qf.exclQfArrs[a]=i}else{if(i.length>0){this.Qf.varIds.push(t);this.Qf.schemaIds.push(e);this.Qf.exclQfArrs.push(i)}}}static onApply(){DlgSmplFilter.retrieveQ();DlgSmplFilter.retrieveR();hideDlg();let t=SmplFilter.toXmlS(this.Rf.varIds,this.Rf.minVals,this.Rf.maxVals,this.Qf.varIds,this.Qf.schemaIds,this.Qf.exclQfArrs);if(DlgSmplFilter.winId==-20)DlgSmplFilter.callbFct(t);else sendWsMsg(Msg.setSmplFilter(DlgSmplFilter.winId,t)+","+msgGetCanvasViewCurrInfo)}static onQVarChanged(){let t=parseInt(this.value);DlgSmplFilter.retrieveQ();DlgSmplFilter.currQVid=t;DlgSmplFilter.updateQ()}static onRVarChanged(){let t=parseInt(this.value);DlgSmplFilter.retrieveR();DlgSmplFilter.currRVid=t;DlgSmplFilter.updateR()}static relaxAllR(){this.Rf.varIds=[];this.Rf.minVals=[];this.Rf.maxVals=[];DlgSmplFilter.updateR()}static relaxCurrQ(){let t=this.Qf.varIds.indexOf(DlgSmplFilter.currQVid);if(t>-1)DlgSmplFilter.removeQ(t);DlgSmplFilter.updateQ()}static relaxCurrR(){let t=this.Rf.varIds.indexOf(DlgSmplFilter.currRVid);if(t>-1)DlgSmplFilter.removeR(t);DlgSmplFilter.updateR()}static removeQ(t){this.Qf.varIds.splice(t,1);this.Qf.schemaIds.splice(t,1);this.Qf.exclQfArrs.splice(t,1)}static removeR(t){this.Rf.varIds.splice(t,1);this.Rf.minVals.splice(t,1);this.Rf.maxVals.splice(t,1)}static retrieveCurrQ(){let t=DlgSmplFilter.currQVid,e=View.dataVarQfSetId(t);let i=qfSets.get(e),a=selectedNums("SmplFilQfList"),s=[];i.flags.map(t=>{if(!a.includes(parseInt(t)))s.push(t.charCodeAt(0))});return{vId:t,qfSetId:e,excl:s}}static retrieveQ(){let t=DlgSmplFilter.retrieveCurrQ();DlgSmplFilter.applyQf(t.vId,t.qfSetId,t.excl)}static retrieveR(){let t=numFromElem("minValSmplF",missDOUBLE);let e=numFromElem("maxValSmplF",missDOUBLE);let i=this.Rf.varIds.indexOf(DlgSmplFilter.currRVid);if(i>-1){if(t==missDOUBLE||e==missDOUBLE){this.Rf.varIds.splice(i,1);this.Rf.minVals.splice(i,1);this.Rf.maxVals.splice(i,1)}else{this.Rf.minVals[i]=t;this.Rf.maxVals[i]=e}}else{if(t!=missDOUBLE&&e!=missDOUBLE){this.Rf.varIds.push(DlgSmplFilter.currRVid);this.Rf.minVals.push(t);this.Rf.maxVals.push(e)}}}static show(t,e){const i="DlgSmplFilter",a=getLastOpenElem(i);let s="Sample Filter - ";if(t==-20)s+="Export";else if(t==-10)s+="Isosurface Variables";else s+="Window "+t;DlgSmplFilter.winId=t;DlgSmplFilter.callbFct=e;let l=new SmplFilter;if(t==-10)l=view.isoVarSet.isoVarSmplFilter;else if(t>0)l=view.dataWinArr[t-1].smplFilter;this.Rf=l.getRangeFilters();this.Qf=l.getQualityFilters();this.varIds=dataVarIds(view.drvdVarArr);this.varLbls=dataVarFullLabels(view.drvdVarArr);DlgSmplFilter.currRVid=0;DlgSmplFilter.currQVid=0;let r='<div class="TabbedDlg" id="'+i+'">';r+=Html.panelBegin(i,1,"Range",a==1);r+='<p><b>Variable</b></p><p id="SmplFilRVarP"></p>';r+="<p><b>Acceptable Range</b></p><p>"+Html.txtInput("minValSmplF")+" - "+Html.txtInput("maxValSmplF")+"</p>";r+='<p><span style="float:right">'+Html.button("Relax This","DlgSmplFilter.relaxCurrR()")+"&emsp;"+Html.button("Relax All","DlgSmplFilter.relaxAllR()")+'</span><br><div id="StatSmplR"></div></p>';r+=Html.panelEnd();r+=Html.panelBegin(i,2,"Quality",a==2);r+='<p><b>Variable</b></p><p id="SmplFilQVarP"></p>';r+='<p><b>Acceptable Quality Flags</b></p><p id="SmplFilQFlagP"></p>';r+='<p><span style="float:right">'+Html.button("Relax This","DlgSmplFilter.relaxCurrQ()")+"&emsp;"+Html.button("Apply to All Variables","DlgSmplFilter.useQForAll()")+'</span><br><div id="StatSmplQ"></div></p>';r+=Html.panelEnd()+"</div>";showDlg(s,r,Html.dlgBtn("DlgSmplFilter.onApply()"));DlgSmplFilter.updateQ();DlgSmplFilter.updateR()}static updateQ(){let t=DlgSmplFilter.currQVid,e=[],i=[];this.varLbls.map((t,e)=>i.push(this.Qf.varIds.includes(this.varIds[e])?"* "+t:t));$("SmplFilQVarP").innerHTML=Html.selectList("SmplFilQVarLst",this.varIds,i,t);$("SmplFilQVarLst").addEventListener("change",DlgSmplFilter.onQVarChanged);let a=this.Qf.varIds.indexOf(t);let s=a>-1?this.Qf.exclQfArrs[a]:[];let l=qfSets.get(View.dataVarQfSetId(t));l.flags.map(t=>{if(!s.includes(t.charCodeAt(0)))e.push(t)});$("SmplFilQFlagP").innerHTML=Html.selectListEx("SmplFilQfList",l.flags,l.flag_descriptions,e,1);$("StatSmplQ").innerText=countInfoString(this.Qf.varIds.length,this.varIds.length,"variable(s) quality filtering");$("SmplFilQfList").size=6}static updateR(){let t=[];this.varLbls.map((e,i)=>t.push(this.Rf.varIds.includes(this.varIds[i])?"* "+e:e));$("SmplFilRVarP").innerHTML=Html.selectList("SmplFilRVarLst",this.varIds,t,DlgSmplFilter.currRVid);$("SmplFilRVarLst").addEventListener("change",DlgSmplFilter.onRVarChanged);let e="",i="",a=this.Rf.varIds.indexOf(DlgSmplFilter.currRVid);if(a>-1){e=this.Rf.minVals[a];i=this.Rf.maxVals[a]}setInputElemStr("minValSmplF",e);setInputElemStr("maxValSmplF",i);$("StatSmplR").innerText=countInfoString(this.Rf.varIds.length,this.varIds.length,"variable(s) range filtering")}static useQForAll(){let t=DlgSmplFilter.retrieveCurrQ();let e,i,a=this.varIds.length;for(e=0;e<a;++e){i=this.varIds[e];if(View.dataVarQfSetId(i)==t.qfSetId)DlgSmplFilter.applyQf(i,t.qfSetId,t.excl)}DlgSmplFilter.updateQ()}}class DlgSection{static onApply(t){view.section.setVals(strFromElem("SecName",""),selectedNum("SecCoordSelect",0),numFromElem("SecWidth",200),selectedNum("SecBathySelect",2),selectedNum("SecBathyColor",17));onHideDlgFunction=noOp;hideDlg();sendWsMsg(t()+","+msgGetDockDataVarLbls+","+msgGetCanvasViewCurrInfo)}static show(t){let e=0,i=2,a=200,s=17,l="",r=view.section;dlgOrigVals=new Map;if(r.isValid()){l=r.name;e=r.type;s=r.bathyColor;i=r.bathyType;a=r.width}let n='<table class="StdTable">';n+="<tr><td>Section Name:</td><td>"+Html.txtInput("SecName",l)+"</td></tr>";n+="<tr><td>Section Coordinate:</td><td>"+Html.selectList("SecCoordSelect",[0,1,2,3],["Distance [km]","Longitude","Latitude","Time"],e)+"</td></tr>";n+="<tr><td>Mean Width [km]:</td><td>"+Html.txtInput("SecWidth",roundedVal(a,2))+"</td></tr>";n+="<tr><td>Bathymetry:</td><td>"+Html.selectList("SecBathySelect",[0,1,3,2],["No bathymetry","Station bottom depth","GEBCO_2014","ETOPO1"],i)+"</td></tr>";n+="<tr><td>Bathymetry Color:</td><td>"+Html.selectListColor("SecBathyColor",view.mapWin.palName,s)+"</td></tr>";n+="</table>";if(appState.current()==DefineSectionState2)onHideDlgFunction=defSectionAbort;showDlg("Section Properties",n,Html.dlgBtn("DlgSection.onApply("+t+")"))}}class DlgSelectItems{static onChange(){$("selCountMsg").innerText=countInfoString(selectedStrs("selectList").length,DlgSelectItems.optionCount,"items selected")}static onInvert(){Array.from($("selectList").options).map(t=>t.selected=!t.selected);DlgSelectItems.onChange()}static onSelectAll(){Array.from($("selectList").options).map(t=>t.selected=true);DlgSelectItems.onChange()}static onSelectExt(){let t=DlgSelectItems.extSelect,e=Array.from($("selectList").options);e.map(e=>e.selected=t.indexOf(parseInt(e.value))>-1?true:false);DlgSelectItems.onChange()}static show(t,e,i,a,s=[],l="Select",r=[],n=""){DlgSelectItems.optionCount=e.length;DlgSelectItems.extSelect=r;let o="<fieldset><b>Select one or more items</b></p>";o+=Html.selectListEx("selectList",e,i,s,1);o+='<p id="selCountMsg"></p>';o+=Html.button("Select All","DlgSelectItems.onSelectAll()")+"&emsp;"+Html.button("Invert Selection","DlgSelectItems.onInvert()");if(r.length>0)o+="&emsp;"+Html.button(n,"DlgSelectItems.onSelectExt()");o+="</fieldset>";showDlg(t,o,Html.dlgBtn(a,l));let d=$("selectList");d.size=Math.min(10,e.length);d.addEventListener("change",DlgSelectItems.onChange);if(s.length==0)d.selectedIndex=-1;DlgSelectItems.onChange()}}class DlgSelectSection{static onTreeItemClick(){let t=this.attributes.value.nodeValue;hideDlg();if(t.length>0){if(t.startsWith("private:")&&!privSecFileNames.includes(t.slice(8))){let e=localStorage.getItem(collectionName+"/sections/"+t.slice(8));sendWsMsg(Msg.modifyView(e)+","+msgGetDockLbls+","+msgGetCanvasViewCurrInfo)}else{sendWsMsg('{"cmd":"load_section","section":"'+t+'"},'+msgGetDockLbls+","+msgGetCanvasViewCurrInfo)}}}static show(){const t="SelectItemTree";let e=privSecFileNames.concat(localStorageKeys(collectionName+"/sections/",true));e=[...new Set(e)].sort();let i=e.length+secFilesCount;let a='<div class="TreeViewDiv has-border">';if(i>0){a+=' <ul id="'+t+'" class="TreeView">';a+=Html.treeNodeFromArr(e,true);a+=Html.treeNodeFromTree(secFilesTree,secFilesCount,false);a+="</ul>"}else a+=Html.noResults();a+="</div>";showDlg("Load Section",a,"");if(i>0)activateTree(t,DlgSelectSection.onTreeItemClick);let s=$("public-node");if(s!=null)s.click();s=$("private-node");if(s!=null)s.click()}}class DlgSelectView{static onTreeItemClick(){let t=this.attributes.value.nodeValue;hideDlg();if(t.length>0){if(t.startsWith("private:")){setViewName(t.slice(8));if(!privViewFileNames.includes(viewName))t=localStorage.getItem(collectionName+"/views/"+viewName)}else{let e=t.lastIndexOf("/"),i=t.lastIndexOf(".xview");setViewName(t.slice(e>=0?e+1:0,i))}sendWsMsg(Msg.loadView(t))}}static show(){const t="SelectItemTree";let e=privViewFileNames.concat(localStorageKeys(collectionName+"/views/",true));e=[...new Set(e)].sort();let i=e.length+viewFilesCount;let a='<div class="TreeViewDiv has-border">';if(i>0){a+=' <ul id="'+t+'" class="TreeView">';a+=Html.treeNodeFromArr(e,true);a+=Html.treeNodeFromTree(viewFilesTree,viewFilesCount,false);a+="</ul>"}else a+=Html.noResults();a+="</div>";showDlg("Load View",a,"");if(i>0)activateTree(t,DlgSelectView.onTreeItemClick);let s=$("public-node");if(s!=null)s.click();s=$("private-node");if(s!=null)s.click()}}class DlgStatFilter{static createLocalVars(){let t=view.metaVarIds(false,true,true,false);let e=view.metaVarFullLabels(false,true,true,false);let i=metaVarTypes.indexOf("METAPRIMVARMAX");if(i>-1){t.unshift(i);e.unshift(metaVarNames[i])}i=metaVarTypes.indexOf("METAPRIMVARMIN");if(i>-1){t.unshift(i);e.unshift(metaVarNames[i])}i=metaVarNames.indexOf("Accession Number");if(i>-1){t.unshift(i);e.unshift(metaVarNames[i])}let a=view.metaVarIds(false,true,false,true);let s=view.metaVarFullLabels(false,true,false,true);this.emvNIds=t;this.emvNLbls=e;this.emvSIds=a;this.emvSLbls=s;DlgStatFilter.currNumMvVid=t.length>0?t[0]:-1;DlgStatFilter.currStrMvVid=a.length>0?a[0]:-1;let l=view.statFilter;this.mvRaVarIds=[...l.mvRangeVarIds];this.mvRaMinVals=[...l.mvRangeMinVals];this.mvRaMaxVals=[...l.mvRangeMaxVals];this.mvWcVarIds=[...l.mvWildCardVarIds];this.mvWcExprs=[...l.mvWildCardExprs];this.mvWcCases=[...l.mvWildCardCases];this.xPolyPix=[];this.yPolyPix=[];this.xPoly=[...l.xPoly];this.yPoly=[...l.xPoly]}static onApply(){let t=view.statFilter;t.cruise=strFromElem("CruiseLabel","*");t.statNameMin=strFromElem("StatLabelFirst","0");t.statNameMax=strFromElem("StatLabelLast","99999999");t.statIdMin=numFromElem("StatIdFirst",1)-1;t.statIdMax=numFromElem("StatIdLast",1e8)-1;t.smplCountMin=numFromElem("SmplCountMin",0);t.smplCountMax=numFromElem("SmplCountMax",99999999);if(isChecked("StfBottle"))t.statType="B";else if(isChecked("StfCTD"))t.statType="C";else if(isChecked("StfXBT"))t.statType="X";else if(isChecked("StfAny"))t.statType="*";t.periodDay0=selectedNum("PStrtDay");t.periodDay1=selectedNum("PEndDay");t.periodMon0=selectedNum("PStrtMon");t.periodMon1=selectedNum("PEndMon");t.periodYear0=numFromElem("PStrtYr",-99999);t.periodYear1=numFromElem("PEndYr",99999);t.periodHour0=numFromElem("PStrtHour",0);t.periodHour1=numFromElem("PEndHour",23);t.periodMinute0=numFromElem("PStrtMinute",0);t.periodMinute1=numFromElem("PEndMinute",59);t.seasonDay0=selectedNum("SStrtDay");t.seasonDay1=selectedNum("SEndDay");t.seasonMon0=selectedNum("SStrtMon");t.seasonMon1=selectedNum("SEndMon");t.wLonDom=numFromElem("wLonDom",missDOUBLE);t.eLonDom=numFromElem("eLonDom",largeDOUBLE);t.sLatDom=numFromElem("sLatDom",missDOUBLE);t.nLatDom=numFromElem("nLatDom",largeDOUBLE);t.xPolyPix=[...this.xPolyPix];t.yPolyPix=[...this.yPolyPix];t.xPoly=[...this.xPoly];t.yPoly=[...this.xPoly];DlgStatFilter.retrieveMetaDataNum();DlgStatFilter.retrieveMetaDataStr();t.mvRangeVarIds=[...this.mvRaVarIds];t.mvRangeMinVals=[...this.mvRaMinVals];t.mvRangeMaxVals=[...this.mvRaMaxVals];t.mvWildCardVarIds=[...this.mvWcVarIds];t.mvWildCardExprs=[...this.mvWcExprs];t.mvWildCardCases=[...this.mvWcCases];t.reqVarIsOrLogic=checkBoxState("StfOr");t.reqVarIds=selectedNums("StfVarLst");t.historyDay0=selectedNum("PhStrtDay");t.historyDay1=selectedNum("PhEndDay");t.historyMon0=selectedNum("PhStrtMon");t.historyMon1=selectedNum("PhEndMon");t.historyYear0=numFromElem("PhStrtYr",-99999);t.historyYear1=numFromElem("PhEndYr",99999);t.historyHour0=numFromElem("PhStrtHour",0);t.historyHour1=numFromElem("PhEndHour",23);t.historyMinute0=numFromElem("PhStrtMinute",0);t.historyMinute1=numFromElem("PhEndMinute",59);t.historyUser=strFromElem("UserWc","*");t.historyAction=strFromElem("ActionWc","*");t.historyDescr=strFromElem("DescrWc","*");t.invert=checkBoxState("StfInvert","F");hideDlg();sendWsMsg(Msg.setStatFilter()+","+msgGetCanvasViewCurrInfo)}static onDefPoly(){poupBckgrd.style.display="none";startPointGetterState(DlgStatFilter.setPoly)}static onMapDomain(){this.xPolyPix=[];this.yPolyPix=[];this.xPoly=[];this.yPoly=[];DlgStatFilter.updateDomain()}static onNumMetaVarChanged(){let t=parseInt(this.value);DlgStatFilter.retrieveMetaDataNum();DlgStatFilter.currNumMvVid=t;DlgStatFilter.updateMetaDataNum()}static onStrMetaVarChanged(){let t=parseInt(this.value);DlgStatFilter.retrieveMetaDataStr();DlgStatFilter.currStrMvVid=t;DlgStatFilter.updateMetaDataStr()}static relaxAvail(){view.statFilter.setDefaultsAvail();$("StfVarLstElem").innerHTML=Html.selectListEx("StfVarLst",dataVarIds(),dataVarFullLabels(),view.statFilter.reqVarIds,1);DlgStatFilter.updateAvailInfo()}static relaxDateTime(){view.statFilter.setDefaultsDateTime();DlgStatFilter.updateDateTime()}static relaxHistory(){view.statFilter.setDefaultsHistory();DlgStatFilter.updateHistory()}static relaxMvRange(){this.mvRaVarIds=[];this.mvRaMinVals=[];this.mvRaMaxVals=[];DlgStatFilter.currNumMvVid=this.emvNIds.length>0?this.emvNIds[0]:-1;DlgStatFilter.updateMetaDataNum()}static relaxMvWildCard(){this.mvWcVarIds=[];this.mvWcExprs=[];this.mvWcCases=[];DlgStatFilter.currStrMvVid=this.emvSIds.length>0?this.emvSIds[0]:-1;DlgStatFilter.updateMetaDataStr()}static relaxNameRange(){view.statFilter.setDefaultsNameRange();DlgStatFilter.updateNameRange()}static retrieveMetaDataNum(){let t=numFromElem("rMinVal",missDOUBLE);let e=numFromElem("rMaxVal",missDOUBLE);let i=this.mvRaVarIds.indexOf(DlgStatFilter.currNumMvVid);if(i>-1){if(t==missDOUBLE||e==missDOUBLE){this.mvRaVarIds.splice(i,1);this.mvRaMinVals.splice(i,1);this.mvRaMaxVals.splice(i,1)}else{this.mvRaMinVals[i]=t;this.mvRaMaxVals[i]=e}}else{if(t!=missDOUBLE&&e!=missDOUBLE){this.mvRaVarIds.push(DlgStatFilter.currNumMvVid);this.mvRaMinVals.push(t);this.mvRaMaxVals.push(e)}}}static retrieveMetaDataStr(){let t=strFromElem("WildC","");let e=checkBoxState("WildCcase");let i=this.mvWcVarIds.indexOf(DlgStatFilter.currStrMvVid);if(i>-1){if(t.length==0){this.mvWcVarIds.splice(i,1);this.mvWcExprs.splice(i,1);this.mvWcCases.splice(i,1)}else{this.mvWcExprs[i]=t;this.mvWcCases[i]=e}}else{if(t.length>0){this.mvWcVarIds.push(DlgStatFilter.currStrMvVid);this.mvWcExprs.push(t);this.mvWcCases.push(e)}}}static setPoly(t){poupBckgrd.style.display="block";if(!t||ptgCnvsX.length<3)return;DlgStatFilter.xPoly=[];DlgStatFilter.yPoly=[];DlgStatFilter.xPolyPix=[];DlgStatFilter.yPolyPix=[];ptgCnvsX.push(ptgCnvsX[0]);ptgCnvsY.push(ptgCnvsY[0]);ptgCnvsX.map(t=>DlgStatFilter.xPolyPix.push(toOdvCanvasX(t)));ptgCnvsY.map(t=>DlgStatFilter.yPolyPix.push(toOdvCanvasY(t)));DlgStatFilter.updateDomain()}static show(){const t="DlgStatFilter",e=getLastOpenElem(t);let i=view.statFilter;dlgOrigVals=new Map;DlgStatFilter.createLocalVars();let a='<div class="TabbedDlg" id="'+t+'">';a+=Html.panelBegin(t,1,"Name / Range",e==1);a+='<table class="StdTable">';a+='<tr><td>Cruise label:</td><td colspan="3">'+Html.selectListEditable("CruiseLabel",cruiseNames,"",16.35)+"</td></tr>";a+="<tr><td>Station label:</td><td>"+Html.txtInput("StatLabelFirst")+"</td><td> - </td><td>"+Html.txtInput("StatLabelLast")+"</td></tr>";a+='<tr><td>Type:</td><td colspan="3"><input type="radio" id="StfBottle" name="StfType"/><label for="StfBottle"> Bottle</label> <input type="radio" id="StfCTD" name="StfType"/><label for="StfCTD"> CTD</label> <input type="radio" id="StfXBT" name="StfType"/><label for="StfXBT"> XBT</label> <input type="radio" id="StfAny" name="StfType"/><label for="StfAny"> Any</label> </td></tr>';a+="<tr><td>Station ID:</td><td>"+Html.txtInput("StatIdFirst")+"</td><td> - </td><td>"+Html.txtInput("StatIdLast")+"</td></tr>";a+="<tr><td>Sample count:</td><td>"+Html.txtInput("SmplCountMin")+"</td><td> - </td><td>"+Html.txtInput("SmplCountMax")+"</td></tr>";a+="</table>";a+='<p><span style="float:right">'+Html.button("<b>Relax</b>","DlgStatFilter.relaxNameRange()")+"</span></p>";a+=Html.panelEnd();a+=Html.panelBegin(t,2,"Date / Time",e==2);a+='<table id="StfDateTimeTbl" class="StdTable"></table>';a+=Html.panelEnd();a+=Html.panelBegin(t,3,"Domain",e==3);a+='<table id="StfDomainTbl">';a+="<tr><td></td><td>North</td><td></td></tr>";a+="<tr><td></td><td>"+Html.txtInput("nLatDom")+"</td><td></td></tr>";a+='<tr><td></td><td rowspan="6"><img src="'+resourceRoot+'img/windrose.png"></td><td></td></tr>';a+='<tr><td colspan="3">&nbsp;</td></tr>';a+="<tr><td>West</td><td></td><td>East</td><td></td></tr>";a+="<tr><td>"+Html.txtInput("wLonDom")+"</td><td></td><td>"+Html.txtInput("eLonDom")+"</td></tr>";a+='<tr><td colspan="3">&nbsp;</td></tr>';a+='<tr><td colspan="3">&nbsp;</td></tr>';a+="<tr><td></td><td>South</td><td></td><td></td><td>"+Html.button("Define Polygon","DlgStatFilter.onDefPoly()","StfBtnDefPoly")+"</td></tr>";a+="<tr><td></td><td>"+Html.txtInput("sLatDom")+"</td><td></td><td></td><td>"+Html.button("Map Domain","DlgStatFilter.onMapDomain()","StfBtnMapDomain")+"</td></tr>";a+="</table>";a+='<p id="StfPolyLbl">Selection polygon active</p>';a+=Html.panelEnd();a+=Html.panelBegin(t,4,"Meta Data",e==4);a+='<table id="StfMetaDataTbl"><tr>';a+='<td><fieldset id="MetaDataNumF">';a+="<legend><b>Numeric Meta Variables</b></legend>";a+='<p id="MetaDataNumP"></p><p>Acceptable Range</p><p>'+Html.txtInput("rMinVal")+" - "+Html.txtInput("rMaxVal")+"<br>&nbsp;<br>&nbsp;</p>";a+='<p id="StfMvStatRange"></p><p><span style="float:right">'+Html.button("<b>Relax</b>","DlgStatFilter.relaxMvRange()")+"</span></p>";a+="</fieldset></td>";a+='<td><fieldset id="MetaDataStrF">';a+="<legend><b>Text Meta Variables</b></legend>";a+='<p id="MetaDataStrP"></p><p>Wildcard Expression</p><p>'+Html.txtInput("WildC")+"<br>"+Html.checkBox("WildCcase","Case sensitive matching",false)+"</p>";a+='<p id="StfMvStatWildC"></p><p><span style="float:right">'+Html.button("<b>Relax</b>","DlgStatFilter.relaxMvWildCard()")+"</span></p>";a+="</fieldset></td>";a+="</tr></table>";a+=Html.panelEnd();a+=Html.panelBegin(t,5,"Availability",e==5);a+="<b>Required Variables</b>";a+='<p><div id="StfVarLstElem">'+Html.selectListEx("StfVarLst",dataVarIds(),dataVarFullLabels(),i.reqVarIds,1)+"</div></p>";a+='<p><div id="StfInfo"></div> <span style="float:right">'+Html.button("<b>Relax</b>","DlgStatFilter.relaxAvail()")+"</span></p>";a+='<p>Logic: <input type="radio" id="StfAnd" name="Logic"><label for="StfAnd"> AND</label> <input type="radio" id="StfOr" name="Logic"><label for="StfOr"> OR</label></p>';a+=Html.panelEnd();a+=Html.panelBegin(t,6,"History",e==6);a+='<table id="StfHistoryTbl" class="StdTable"></table>';a+=Html.panelEnd();a+=Html.panelBegin(t,7,"Invert",e==7);a+=Html.checkBoxTF("StfInvert","Invert selection",i.invert);a+="<p>Check this box to select all stations that do NOT<br>satisfy the selection criteria.</p>";a+=Html.panelEnd()+"</div>";showDlg("Station Filter",a,Html.dlgBtn("DlgStatFilter.onApply()"));$("tabPanel"+e).click();DlgStatFilter.updateNameRange();DlgStatFilter.updateDateTime();const s=toBool(i.reqVarIsOrLogic);$("StfOr").checked=s;$("StfAnd").checked=!s;DlgStatFilter.updateAvailInfo();DlgStatFilter.updateMetaDataNum();DlgStatFilter.updateMetaDataStr();if(this.emvNIds.length==0)setVisibility("MetaDataNumF");if(this.emvSIds.length==0)setVisibility("MetaDataStrF");DlgStatFilter.updateDomain(i.wLonDom,i.eLonDom,i.sLatDom,i.nLatDom);DlgStatFilter.updateHistory();$("StfVarLstElem").addEventListener("click",DlgStatFilter.updateAvailInfo)}static updateAvailInfo(){const t=selectedStrs("StfVarLst");$("StfInfo").innerText=t.length+" of "+dataVarUNames.length+" variables selected"}static updateDateTime(){let t=view.statFilter,e='<tr><td colspan="11"><b>Period</b></tr>';e+="<tr><td>From:</td><td>"+Html.selectListMonth("PStrtMon",t.periodMon0)+"</td><td> / </td><td>"+Html.selectListDay("PStrtDay",t.periodDay0)+"</td><td> / </td><td>"+Html.txtInput("PStrtYr",t.periodYear0,"4em")+"</td><td>&ensp;</td><td>"+Html.selectListHour("PStrtHour",t.periodHour0)+"</td><td> : </td><td>"+Html.selectListMinute("PStrtMinute",t.periodMinute0)+"</td><td></td></tr>";e+="<tr><td>To:</td><td>"+Html.selectListMonth("PEndMon",t.periodMon1)+"</td><td> / </td><td>"+Html.selectListDay("PEndDay",t.periodDay1)+"</td><td> / </td><td>"+Html.txtInput("PEndYr",t.periodYear1,"4em")+"</td><td>&ensp;</td><td>"+Html.selectListHour("PEndHour",t.periodHour1)+"</td><td> : </td><td>"+Html.selectListMinute("PEndMinute",t.periodMinute1)+"</td><td></td></tr>";e+="<tr><td>&nbsp;</td></tr>";e+='<tr><td colspan="11"><b>Season</b></td></tr>';e+="<tr><td>From:</td><td>"+Html.selectListMonth("SStrtMon",t.seasonMon0)+"</td><td> / </td><td>"+Html.selectListDay("SStrtDay",t.seasonDay0)+"</td><td></td><td></td><td></td></tr>";e+="<tr><td>To:</td><td>"+Html.selectListMonth("SEndMon",t.seasonMon1)+"</td><td> / </td><td>"+Html.selectListDay("SEndDay",t.seasonDay1)+'</td><td colspan="6"></td><td>'+Html.button("<b>Relax</b>","DlgStatFilter.relaxDateTime()")+"</td></tr>";$("StfDateTimeTbl").innerHTML=e}static updateDomain(t=missDOUBLE,e=largeDOUBLE,i=missDOUBLE,a=largeDOUBLE){setInputElemStr("wLonDom",t==missDOUBLE?"":roundedVal(t,5));setInputElemStr("eLonDom",e==largeDOUBLE?"":roundedVal(e,5));setInputElemStr("sLatDom",i==missDOUBLE?"":roundedVal(i,5));setInputElemStr("nLatDom",a==largeDOUBLE?"":roundedVal(a,5));setVisibility("StfPolyLbl",DlgStatFilter.xPoly.length>0||DlgStatFilter.xPolyPix.length>0)}static updateHistory(){let t=view.statFilter,e="20em",i='<tr><td colspan="11"><b>Period</b></tr>';i+="<tr><td>From:</td><td>"+Html.selectListMonth("PhStrtMon",t.historyMon0)+"</td><td> / </td><td>"+Html.selectListDay("PhStrtDay",t.historyDay0)+"</td><td> / </td><td>"+Html.txtInput("PhStrtYr",t.historyYear0,"4em")+"</td><td>&ensp;</td><td>"+Html.selectListHour("PhStrtHour",t.historyHour0)+"</td><td> : </td><td>"+Html.selectListMinute("PhStrtMinute",t.historyMinute0)+"</td><td></td></tr>";i+="<tr><td>To:</td><td>"+Html.selectListMonth("PhEndMon",t.historyMon1)+"</td><td> / </td><td>"+Html.selectListDay("PhEndDay",t.historyDay1)+"</td><td> / </td><td>"+Html.txtInput("PhEndYr",t.historyYear1,"4em")+"</td><td>&ensp;</td><td>"+Html.selectListHour("PhEndHour",t.historyHour1)+"</td><td> : </td><td>"+Html.selectListMinute("PhEndMinute",t.historyMinute1)+"</td><td></td></tr>";i+='<tr><td colspan="11">&nbsp;</td></tr>';i+='<tr><td colspan="2"><b>User:</b></td><td colspan="9">'+Html.txtInput("UserWc",t.historyUser,e)+"</td></tr>";i+='<tr><td colspan="2"><b>Action:</b></td><td colspan="9">'+Html.txtInput("ActionWc",t.historyAction,e)+"</td></tr>";i+='<tr><td colspan="2"><b>Description:</b></td><td colspan="9">'+Html.txtInput("DescrWc",t.historyDescr,e)+"</td><td>&emsp;&emsp;</td><td>"+Html.button("<b>Relax</b>","DlgStatFilter.relaxHistory()")+"</td></tr>";$("StfHistoryTbl").innerHTML=i}static updateMetaDataNum(){let t=[];this.emvNLbls.map((e,i)=>t.push(this.mvRaVarIds.includes(this.emvNIds[i])?"* "+e:e));$("MetaDataNumP").innerHTML=Html.selectList("MetaDataNumLst",this.emvNIds,t,DlgStatFilter.currNumMvVid);$("MetaDataNumLst").addEventListener("change",DlgStatFilter.onNumMetaVarChanged);$("rMinVal").value="";$("rMaxVal").value="";let e=this.mvRaVarIds.indexOf(DlgStatFilter.currNumMvVid);if(e>-1){$("rMinVal").value=this.mvRaMinVals[e];$("rMaxVal").value=this.mvRaMaxVals[e]}$("StfMvStatRange").innerText=this.mvRaVarIds.length+" of "+this.emvNLbls.length+" variable(s) range filtering"}static updateMetaDataStr(){let t=[];this.emvSLbls.map((e,i)=>t.push(this.mvWcVarIds.includes(this.emvSIds[i])?"* "+e:e));$("MetaDataStrP").innerHTML=Html.selectList("MetaDataStrLst",this.emvSIds,t,DlgStatFilter.currStrMvVid);$("MetaDataStrLst").addEventListener("change",DlgStatFilter.onStrMetaVarChanged);$("WildC").value="";$("WildCcase").checked=false;let e=this.mvWcVarIds.indexOf(DlgStatFilter.currStrMvVid);if(e>-1){$("WildC").value=this.mvWcExprs[e];$("WildCcase").checked=this.mvWcCases[e]=="T"?true:false}$("StfMvStatWildC").innerText=this.mvWcVarIds.length+" of "+this.emvSLbls.length+" variable(s) wildcard filtering"}static updateNameRange(){let t=view.statFilter;setInputElemStr("CruiseLabel",t.cruise);setInputElemStr("StatLabelFirst",t.statNameMin);setInputElemStr("StatLabelLast",t.statNameMax);setInputElemStr("StatIdFirst",t.statIdMin+1);setInputElemStr("StatIdLast",t.statIdMax+1);setInputElemStr("SmplCountMin",t.smplCountMin);setInputElemStr("SmplCountMax",t.smplCountMax);$("StfBottle").checked=t.statType=="B";$("StfCTD").checked=t.statType=="C";$("StfXBT").checked=t.statType=="X";$("StfAny").checked=t.statType=="*"}}class DlgTimeVarSelCnv{static onSelect(){let t=selectedNum("CnvSelList",0),e=DlgTimeVarSelCnv.dv;hideDlg();if(e.type==48)DlgTimeVarSettings.show(DlgTimeVarSelCnv.updateIdx,e,t);else{DlgDrvdVars.setTimeVarIPrms(e,t);DlgDrvdVars.newDrvdVar(DlgTimeVarSelCnv.updateIdx,e)}}static show(t,e,i,a,s){DlgTimeVarSelCnv.dv=e;DlgTimeVarSelCnv.updateIdx=t;let l="<p>Select suitable conversion for</p><p>"+i+"&emsp;>>&emsp;"+fullVarLabel(e.uname,e.uunits)+"</p>";l+=Html.selectList("CnvSelList",a,s,0);showDlg("Conversion",l,Html.dlgBtn("DlgTimeVarSelCnv.onSelect()","Select"))}}class DlgTimeVarSettings{static onApply(){let t=selectedNum("tvUnits",0),e=DlgTimeVarSettings.dv;let i=numFromElem("tvYear",missINT),a=numFromElem("tvMon",missINT);let s=numFromElem("tvDay",missINT);hideDlg();if(i!=missINT&&a!=missINT&&s!=missINT){let l=DlgTimeVarSettings.uLbls[t]+" since "+padZeros(i,4)+"-"+padZeros(a,2)+"-"+padZeros(s,2);e.units=l;e.uunits=l;DlgDrvdVars.setTimeVarIPrms(e,DlgTimeVarSettings.cnvId,t,i,a,s);DlgDrvdVars.newDrvdVar(DlgTimeVarSettings.updateIdx,e)}}static show(t,e,i){DlgTimeVarSettings.uLbls=["years","days","hours"];DlgTimeVarSettings.dv=e;DlgTimeVarSettings.updateIdx=t;DlgTimeVarSettings.cnvId=i;let a="<p>Time&emsp; [ "+Html.selectList("tvUnits",[0,1,2],DlgTimeVarSettings.uLbls,0)+"&emsp;since&emsp;"+Html.txtInput("tvYear","0000","4em")+" - "+Html.txtInput("tvMon","01","2em")+" - "+Html.txtInput("tvDay","01","2em")+" ]</p>";showDlg("Time Variable Settings",a,Html.dlgBtn("DlgTimeVarSettings.onApply()"))}}class DlgVarList{static moveBottom(){DlgVarList.moveTo(wrkArr.length-1)}static moveDown(){DlgVarList.moveTo(wrkIdx+1)}static moveTo(t){if(wrkIdx==-1)return;moveElem(wrkArr,wrkIdx,t);wrkIdx=t;DlgVarList.updateList();DlgVarList.mod=2}static moveTop(){DlgVarList.moveTo(0)}static moveUp(){DlgVarList.moveTo(wrkIdx-1)}static onApply(){hideDlg();if(DlgVarList.mod==0)return;let t=DlgVarList.isDataVars?"data":"meta";let e='{"cmd":"set_collection_'+t+'vars","modify_level":'+DlgVarList.mod+',"'+t+'_vars":'+JSON.stringify(wrkArr)+"},";sendWsMsg(e+msgGetCollInfo+","+msgGetDockLbls+","+msgGetCanvasViewCurrInfo)}static onClick(t){t.preventDefault();const e=t.target;if(e==undefined)return;DlgVarList.xSel.select(e.parentNode.rowIndex,t.shiftKey,t.ctrlKey);DlgVarList.updateStatus()}static onDelete(){let t=DlgVarList.xSel.selections(),e,i=wrkArr.length;for(e=i-1;e>=0;--e)if(t.indexOf(e)>-1)wrkArr.splice(e,1);wrkIdx=-1;DlgVarList.updateList();DlgVarList.mod=2}static onEdit(){if(wrkIdx>-1)DlgVarProps.show(wrkArr[wrkIdx],DlgVarList.onEdited)}static onEdited(t,e){if(wrkIdx>-1)wrkArr[wrkIdx]=t;else{wrkIdx=wrkArr.length;wrkArr.push(t);e=2}DlgVarList.mod=Math.max(DlgVarList.mod,e);if(e>0)DlgVarList.updateList()}static onNew(){let t="New Variable",e="unknown units";let i={id:-1,name:t,units:e,uname:t,uunits:e,cmt:"",errId:-1,dec:2,qfId:0,valType:"FLOAT",valBytes:4};wrkIdx=-1;DlgVarProps.show(i,DlgVarList.onEdited)}static onSelectEmpty(){let t,e,i=wrkArr.length;DlgVarList.xSel.clear();for(t=0;t<i;++t){e=wrkArr[t].id;if(e>-1&&dataCountsByVar[e]==0)DlgVarList.xSel.select(t,false,true)}DlgVarList.updateStatus()}static show(t){DlgVarList.isDataVars=t;DlgVarList.mod=0;let e;wrkArr=[];wrkIdx=-1;if(t){for(e=0;e<dataVarNames.length;++e)wrkArr.push({id:e,name:dataVarNames[e],units:dataVarUnits[e],uname:dataVarUNames[e],uunits:dataVarUUnits[e],cmt:dataVarComments[e],errId:dataVarErrVarIds[e],dec:dataVarDecimals[e],qfId:dataVarQfSetIds[e],type:dataVarTypes[e],valType:dataVarValTypes[e],valBytes:dataVarValBytes[e]})}else{for(e=0;e<metaVarNames.length;++e)wrkArr.push({id:e,name:metaVarNames[e],units:metaVarUnits[e],uname:metaVarUNames[e],uunits:metaVarUUnits[e],cmt:metaVarComments[e],errId:metaVarErrVarIds[e],dec:metaVarDecimals[e],qfId:metaVarQfSetIds[e],type:metaVarTypes[e],valType:metaVarValTypes[e],valBytes:metaVarValBytes[e]})}let i='<div id="vlGrid">';i+='<div id="vlTblDiv" class="has-border">';i+='<table id="vlTbl" class="StdTable"></table></div>';i+='<div id="vlButtons">';i+=Html.button("Top","DlgVarList.moveTop()","BtnVlTop");i+="<p>"+Html.button("Up","DlgVarList.moveUp()","BtnVlUp")+"</p>";i+="<p>"+Html.button("Down","DlgVarList.moveDown()","BtnVlDown")+"</p>";i+="<p>"+Html.button("Bottom","DlgVarList.moveBottom()","BtnVlBottom")+"</p>";i+="<p>&ensp;</p>";i+="<p>"+Html.button("New","DlgVarList.onNew()","BtnVlNew")+"</p>";i+="<p>"+Html.button("Edit","DlgVarList.onEdit()","BtnVlEdit")+"</p>";i+="<p>"+Html.button("Delete","DlgVarList.onDelete()","BtnVlDel")+"</p>";i+="<p>"+Html.button("Select Empty<br>Variables","DlgVarList.onSelectEmpty()","BtnVlSelEmpty")+"</p>";i+="</div>";i+='<div id="vlFooter"><div id="vlDefStatus"></div><br><div id="vlSelStatus"></div></div>';i+="</div>";showDlg((t?"Data":"Meta")+" Variables",i,Html.dlgBtn("DlgVarList.onApply()"));setVisibility("BtnVlSelEmpty",t);DlgVarList.updateList()}static updateList(){let t,e=wrkArr.length,i,a,s="";let l=-1,r=wrkIdx==-1?-1:wrkArr[wrkIdx].id;for(t=0;t<e;++t){i=wrkArr[t].id;if(r>-1&&i==r)l=t;a=i>-1?i+1+":&ensp;":"&ensp;";s+="<tr><td>"+a+fullVarLabel(wrkArr[t].uname,wrkArr[t].uunits)+"</td></tr>"}let n=$("vlTbl");n.innerHTML=s;let o=Array.from(n.rows);n.addEventListener("click",DlgVarList.onClick);DlgVarList.xSel=new XSelector(o,true,false);if(l>-1)DlgVarList.xSel.select(l);else wrkIdx=-1;DlgVarList.updateStatus()}static updateStatus(){let t=DlgVarList.xSel.selectedCount(),e=DlgVarList.xSel.size();let i=DlgVarList.xSel.firstSelection();wrkIdx=t==1?i:-1;let a=i>-1?wrkArr[i].id:-1,s=DlgVarList.isDataVars;let l=t==1&&a>-1,r=s&&a==primaryVarId;let n=!s&&a<mandatoryMetaVarCount;let o=!n&&l;let d=s?0:mandatoryMetaVarCount;$("vlDefStatus").innerText=e+" variables defined";$("vlSelStatus").innerText=t+" variables selected";$("BtnVlTop").disabled=!(o&&s&&i>d);$("BtnVlUp").disabled=!(o&&i>d);$("BtnVlDown").disabled=!(o&&i<e-1);$("BtnVlBottom").disabled=!(o&&i<e-1);$("BtnVlEdit").disabled=!(l&&!(!s&&a==11));$("BtnVlDel").disabled=!(!n&&!r&&t>0)}}class DlgVarProps{static onApply(){let t=strFromElem("varName",""),e=strFromElem("varUnits","");let i=strFromElem("varCmt",""),a=selectedNum("varErrId",-1);let s=numFromElem("varDec",2),l=selectedNum("varQfId",0);let r=selectedStr("varType",DlgVarList.isDataVars?dataVarTypeNames[0]:metaVarTypeNames[0]);let n=selectedStr("varValTyp","FLOAT");let o=numFromElem("varBytes",4),d=0,m=DlgVarProps.v;hideDlg();if(m.name!=t){m.name=t;m.uname=t;d=1}if(m.units!=e){m.units=e;m.uunits=e;d=1}if(m.cmt!=i){m.cmt=i;d=1}if(m.errId!=a){m.errId=a;d=1}if(m.dec!=s){m.dec=s;d=1}if(m.type!=r){m.type=r;d=1}if(m.qfId!=l){m.qfId=l;d=2}if(m.valType!=n){m.valType=n;d=2}if(m.valBytes!=o){m.valBytes=o;d=2}DlgVarProps.cbFct(m,d)}static show(t,e){DlgVarProps.cbFct=e;DlgVarProps.v=t;let i,a='<table id="VarPropsTbl" class="StdTable">';a+="<tr><td>Label:</td><td>"+Html.txtInput("varName",t.name,"22em")+"</td></tr>";a+="<tr><td>Units:</td><td>"+Html.txtInput("varUnits",t.units,"22em")+"</td></tr>";a+="<tr><td>Comment:</td><td>"+Html.txtInput("varCmt",t.cmt,"22em")+"</td></tr>";a+="<tr><td>Error Variable:</td><td>"+Html.selectList("varErrId",dataVarIds(),dataVarFullLabels([],false),t.errId,0,-1,"(none)")+"</td></tr>";a+="<tr><td>Decimal Places:</td><td>"+Html.numInput("varDec",t.dec,0,9)+"</td></tr>";a+="<tr><td>&ensp;</td><td>&ensp;</td></tr>";a+="<tr><td>QF Scheme:</td><td>"+Html.selectListQfScheme("varQfId",t.qfId)+"</td></tr>";a+="<tr><td>Variable Type:</td><td>"+Html.selectListVarType("varType",DlgVarList.isDataVars,t.type)+"</td></tr>";a+="<tr><td>Value Type:</td><td>"+Html.selectListValType("varValTyp",t.valType)+"</td></tr>";a+="<tr><td>Byte Length:</td><td>"+Html.numInput("varBytes",t.valBytes,1,9999)+"</td></tr>";a+="</table>";showDlg("Properties - "+t.name,a,Html.dlgBtn("DlgVarProps.onApply()"));$("varErrId").style.width="20em";$("varQfId").style.width="20em";$("varType").style.width="20em";i=$("varValTyp");i.style.width="20em";i.addEventListener("change",DlgVarProps.onValTypeChange);$("varDec").style.width="4em";i=$("varBytes");i.style.width="4em";i.disabled=t.valType!="TEXT"}static onValTypeChange(){let t=selectedStr("varValTyp","FLOAT");let e=$("varBytes");e.disabled=t!="TEXT";e.value=valueBytes(t)}}class DlgWinDataExp{static show(t){DlgWinDataExp.clickWinId=t;let e=view.mapWin.prjType,i=e==0;let a=false,s=false,l="Export data values",r="";if(t>0){let e=view.dataWinArr[t-1];let r=e.plotMode;a=e.zvId!=VID_NONE;s=a&&(r==1||r==2||r==7);if(s)l+=" and gridding misfits at data positions";if(e.xProj!=100)i=e.xProj==0&&e.yProj==0}r+="<p>"+Html.selectList("modeLst",[0,1],[l,"Export gridded field values"],0)+"</p>";r+="<p>"+Html.selectList("prjLst",[0,1],["Original X/Y values","Projected X/Y values"],0)+"</p>";r+="<p>"+Html.selectList("colSep",[0,1,2,3,4],["TAB",";",",","SPACE","/"],0)+"&emsp;Column separation character</p>";r+="<p>"+Html.checkBox("expLbl","Export variable labels",true)+"</p>";r+="<p>"+Html.checkBox("expMD","Export station metadata",false)+"</p>";r+="<p>"+Html.checkBox("expZmiss","Export data with missing Z value",true)+"</p>";showDlg("Export Window Data",r,Html.dlgBtn("DlgWinDataExp.startExport()","Start Export"));if(!s)setDisplay("modeLst",false);if(i)setDisplay("prjLst",false);if(t==0||!a)setDisplay("expZmiss",false)}static startExport(){let t=selectedNum("modeLst");let e=selectedNum("colSep");let i=selectedNum("prjLst")>0?true:false;let a=isChecked("expLbl");let s=isChecked("expMD");let l=isChecked("expZmiss");hideDlg();sendWsMsg('{"cmd":"export_window_data", "win_id":'+DlgWinDataExp.clickWinId+', "mode":'+t+', "separator_id":'+e+', "labels_export":'+a+', "metadata_export":'+s+', "z_missvals_export":'+l+', "projected_xy":'+i+"}")}}"use strict";const getCanvasWindowCmdName="get_canvas_window";const msgGetCanvas='{"cmd":"'+getCanvasWindowCmdName+'","win_id":-1,"extended_rect":false,"fmt":"png"}';const msgGetCollInfo='{"cmd":"get_collection_information"}';const msgGetDockMetaVarLbls='{"cmd":"get_dock_metavar_labels"}';const msgGetDockDataVarLbls='{"cmd":"get_dock_datavar_labels"}';const msgGetDockIsoVarLbls='{"cmd":"get_dock_isosurfacevar_labels"}';const msgGetDockMetaVarVals='{"cmd":"get_current_station_dock_metadata"}';const msgGetDockDataVarVals='{"cmd":"get_current_sample_dock_data"}';const msgGetDockIsoVarVals='{"cmd":"get_current_station_dock_isosurface_data"}';const msgGetDrvdVarChoices='{"cmd":"get_derivedvar_choices"}';const msgRemoveSection='{"cmd":"execute_option","option":"remove_section"}';const msgGetViewAsXml='{"cmd":"get_current_view_as_xml"}';const msgGetDockLbls=msgGetDockDataVarLbls+","+msgGetDockMetaVarLbls+","+msgGetDockIsoVarLbls;const msgGetDockVals=msgGetDockMetaVarVals+","+msgGetDockDataVarVals+","+msgGetDockIsoVarVals;const msgGetCurrInfo='{"cmd":"get_current_information"},'+msgGetDockVals;const msgGetCanvasViewCurrInfo=msgGetCanvas+","+msgGetViewAsXml+","+msgGetCurrInfo;class Msg{static addFooter(){return Msg.modifyView("<Canvas> <GraphicsObjects> <GObject type='1' clipping='F' post_data='T' dragging='F' own_coordinates='F'> <Annotation font_size='9' frame_color='-1' angle='0' text='=collectionName()  |  =viewName()  |  =user()  |  =date()T=time()  |  =software()' text_color='8' background_color='-1' y_coordinate='0.3' frame_width='-1' text_alignment='8' frame_type='0' x_coordinate='0.5'/> </GObject> </GraphicsObjects> </Canvas>")}static addIsoVar(t,e,i){return'{"cmd":"execute_option","option":"add_iso_var","display_var_id":'+t+',"surface_var_id":'+e+',"surface_value":"'+i+'"}'}static createSection(){let t=ptgCnvsX.length-1;if(t<1)return;let e=',"x_coords":['+toOdvCanvasX(ptgCnvsX[0]);let i=',"y_coords":['+toOdvCanvasY(ptgCnvsY[0]);for(let a=1;a<=t;a++){e+=","+toOdvCanvasX(ptgCnvsX[a]);i+=","+toOdvCanvasY(ptgCnvsY[a])}e+="]";i+="]";let a=view.section;let s='{"cmd":"execute_option","option":"set_section","name":"'+a.name+'","type":'+a.type+',"km_width":'+a.width+',"bathy_type":'+a.bathyType+',"bathy_color":'+a.bathyColor+""+e+i+"}";return s}static doAutoZoom(t){return'{"cmd":"execute_option","option":"auto-zoom","x":'+rclickOdvCnvsX+',"y":'+rclickOdvCnvsY+',"zoom-in":"'+t+'"}'}static exportAsInterruptedMap(t,e,i,a,s,l,r,n,o,d){return'{"cmd":"export_graphics","win_id":'+t+',"fmt":"'+e+'","dpi":'+i+',"transparent_background":'+a+',"draw_as_interrupted_map":true,"title":"'+s+'","label":"'+l+'","copyright":"'+r+'","font_factor":'+n+',"draw_south_polar":'+o+',"draw_north_polar":'+d+"}"}static exportGraphics(t,e,i,a,s=true){return'{"cmd":"export_graphics","win_id":'+t+',"fmt":"'+e+'","dpi":'+i+',"transparent_background":'+a+',"extended_rect":'+s+"}"}static get2DEstimates(t,e,i){return'{"cmd":"get_2d_estimates","win_id":'+t+',"x_coords":'+JSON.stringify(e)+',"y_coords":'+JSON.stringify(i)+"}"}static loadView(t,e=true,i=false){let a='{"cmd":"load_view","view":"'+t+'","view_name":"'+viewName+'"},';if(e)a+=msgGetDockLbls+",";if(i)a+=Msg.addFooter()+",";return a+msgGetCanvasViewCurrInfo}static managePrivateRsrc(t,e,i){return'{"cmd":"manage_private_resource","type":"'+t+'","file_name":"'+e+'","operation":"'+i+'"}'}static modifyView(t){return'{"cmd":"modify_view","view_snippet":"'+t+'","view_name":"'+viewName+'"}'}static selectSampleByAccessionNumber(t,e){return'{"cmd":"select_current_sample","conditions":[{"name":"Accession Number","value":"'+t+'"},{"name":"sample_id","value":"'+e+'"}]}'}static selectSampleByStationId(t,e){return'{"cmd":"select_current_sample","conditions":[{"name":"station_id","value":"'+t+'"},{"name":"sample_id","value":"'+e+'"}]}'}static selectSampleByValidStationId(t,e){return'{"cmd":"select_current_sample","conditions":[{"name":"valid_station_id","value":"'+t+'"},{"name":"sample_id","value":"'+e+'"}]}'}static setDrvdVars(){return Msg.modifyView(view.toXmlDrvdVarSet())}static setDwFullAxisRanges(t){let e=isGeoMap[t]==1?"":" <Geometry x_left='-1e10' x_right='1e10' y_bottom='-1e10' y_top='1e10'/>";return" <DataWindow window_id='"+t+"'> <Window>"+e+" <ColorScale z_range_start='-1e10' z_range_end='1e10'/> </Window> </DataWindow>"}static setDwProperties(t){let e;if(t==-1){for(let t=0;t<view.dataWinArr.length;++t)e+=view.dataWinArr[t].toXmlProps(t+1)}else e=view.dataWinArr[t-1].toXmlProps(t);return Msg.modifyView(e)}static setDwXYZVars(t){const e=view.dataWinArr[t-1];return Msg.modifyView("<DataWindow window_id='"+t+"'>"+e.toXmlAxisVars()+e.toXmlModes()+e.toXmlContours()+e.toXmlWinGen()+" </DataWindow>")}static setDwXYRanges(t,e,i,a,s){return Msg.modifyView("\"<DataWindow window_id='"+t+"'> <Window> <Geometry x_left='"+e+"' x_right='"+i+"' y_bottom='"+a+"' y_top='"+s+"'/> </Window> </DataWindow>")}static setDwXYZRanges(t,e,i,a,s,l,r){let n=view.dataWinArr[t-1];n.zBottom=l,n.zTop=r;n.xLeft=e;n.xRight=i;n.yBottom=a;n.yTop=s;if(n.xRev==="T"){n.xLeft=i;n.xRight=e}if(n.yRev==="T"){n.yBottom=s;n.yTop=a}if(n.zRev==="T"){n.zBottom=r;n.zTop=l}return"<DataWindow window_id='"+t+"'> <Window> <Geometry x_left='"+n.xLeft+"' x_right='"+n.xRight+"' y_bottom='"+n.yBottom+"' y_top='"+n.yTop+"'/> <ColorScale z_range_start='"+n.zBottom+"' z_range_end='"+n.zTop+"'/> </Window> </DataWindow>"}static setDwXYZRangesSync(t,e,i,a,s,l,r,n){let o=Msg.setDwXYZRanges(t,i,a,s,l,r,n);if(e){let e=view.dataWinArr[t-1];let d=[e.xvId,e.yvId,e.zvId],m=View.varGroupId(e.scope);for(let e=1;e<=dataWinCount;++e){let c=view.dataWinArr[e-1],u=[c.xvId,c.yvId,c.zvId];let p=d.indexOf(u[0]),g=d.indexOf(u[1]);let h=d.indexOf(u[2]);if(e==t||m!=View.varGroupId(c.scope)||p==-1&&g==-1&&h==-1)continue;let f=Math.min(c.xLeft,c.xRight);let v=Math.max(c.xLeft,c.xRight);let D=Math.min(c.yBottom,c.yTop);let S=Math.max(c.yBottom,c.yTop);let b=Math.min(c.zBottom,c.zTop);let y=Math.max(c.zBottom,c.zTop);if(p==0){f=i;v=a}else if(p==1){f=s;v=l}else if(p==2){f=r;v=n}if(g==0){D=i;S=a}else if(g==1){D=s;S=l}else if(g==2){D=r;S=n}if(h==0){b=i;y=a}else if(h==1){b=s;y=l}else if(h==2){b=r;y=n}o+=Msg.setDwXYZRanges(e,f,v,D,S,b,y)}}return Msg.modifyView(o)}static setDwZRanges(t,e,i){let a=view.dataWinArr[t-1];a.zBottom=e,a.zTop=i;if(a.zRev==="T"){a.zBottom=i;a.zTop=e}return" <DataWindow window_id='"+t+"'> <Window> <ColorScale z_range_start='"+a.zBottom+"' z_range_end='"+a.zTop+"'/> </Window> </DataWindow>"}static setDwZRangesSync(t,e,i,a){let s=Msg.setDwZRanges(t,i,a);if(e){let e=view.dataWinArr[t-1];let l=[e.zvId],r=View.varGroupId(e.scope);for(let e=1;e<=dataWinCount;++e){let n=view.dataWinArr[e-1],o=[n.xvId,n.yvId,n.zvId];let d=l.indexOf(o[0]),m=l.indexOf(o[1]);let c=l.indexOf(o[2]),u=false,p=false;if(e==t||r!=View.varGroupId(n.scope)||d==-1&&m==-1&&c==-1)continue;let g=Math.min(n.xLeft,n.xRight);let h=Math.max(n.xLeft,n.xRight);let f=Math.min(n.yBottom,n.yTop);let v=Math.max(n.yBottom,n.yTop);let D=Math.min(n.zBottom,n.zTop);let S=Math.max(n.zBottom,n.zTop);if(d==0){g=i;h=a;u=true}if(m==0){f=i;v=a;u=true}if(c==0){D=i;S=a;p=true}if(u)s+=Msg.setDwXYZRanges(e,g,h,f,v,D,S);else if(p)s+=Msg.setDwZRanges(e,D,S)}}return Msg.modifyView(s)}static setIsoVars(){return Msg.modifyView(view.isoVarSet.toXml())}static setMapDomain(t,e,i,a){view.mapWin.setDomain(t,e,i,a);let s=Msg.modifyView("<GeographicMap>"+view.mapWin.toXmlDomain()+" </GeographicMap>");if(t==missDOUBLE)s+=","+msgGetViewAsXml;return s}static setMapProperties(){return Msg.modifyView(view.mapWin.toXmlGeogrMap()+view.mapWin.toXmlProps())}static setPickedStats(){return Msg.modifyView(view.toXmlPickedStatSet())}static setSmplFilter(t,e){if(t==-10)return Msg.modifyView("<IsoSurfaceVariables>"+e+" </IsoSurfaceVariables>");else return Msg.modifyView("<DataWindow window_id='"+t+"'>"+e+" </DataWindow>")}static setSectionProps(){let t=view.section;return'{"cmd":"execute_option","option":"set_section_properties","name":"'+t.name+'","type":'+t.type+',"km_width":'+t.width+',"bathy_type":'+t.bathyType+',"bathy_color":'+t.bathyColor+"}"}static setStatFilter(){return Msg.modifyView(view.statFilter.toXml())}static updateGeometry(t,e,i,a,s){let l="",r=t>0?view.dataWinArr[t-1]:view.mapWin;r.xBbOff=roundedVal(toCmCanvasX(e),1);r.xBbLen=roundedVal(toCmCanvasX(a)-r.xBbOff,1);r.yBbOff=roundedVal(toCmCanvasY(s),1);r.yBbLen=roundedVal(toCmCanvasY(i)-r.yBbOff,1);if(t>0)l+=r.toXmlDataWindowOpen(t);else l+="<MapWindow background_color='"+r.bckColor+"'>";l+=" <Window>"+r.toXmlGeometry()+" </Window>";l+=t>0?" </DataWindow>":" </MapWindow>";return Msg.modifyView(l)}static zoom(t,e,i,a,s){return'{"cmd":"execute_option","option":"zoom","win_id":'+t+',"x_min":'+e+',"y_min":'+i+',"x_max":'+a+',"y_max":'+s+"}"}static zZoom(t,e,i){return'{"cmd":"execute_option","option":"z-zoom","win_id":'+t+',"z_bottom":'+e+',"z_top":'+i+"}"}}"use strict";const VID_NONE=-2147483646;const VID_FIRSTDRVD=32e3;const VID_SECTION_COORD=2e5;const missINT=-2147483646;const missUINT=4294967295;const missDOUBLE=-1e10;const largeDOUBLE=1e10;const cmPageWidth=29.7;const cmPageHeight=21;const xAlignIdx=[1,1,1,2,2,0,0,2,0];const yAlignIdx=[1,0,2,0,2,0,2,1,1];const startWaitingCmds=[getCanvasWindowCmdName,"export_graphics","dock_left_click_event","create_overview_plots","create_collection_snapshot","copy_collection","sort_condense_collection","login_request"];const saveFileContentsCmds=["create_overview_plots","export_data","export_graphics","export_history","export_window_data","get_2d_estimates","get_inventory_by_cruise","get_inventory_by_cruise_and_variable","get_log_file"];const smplCountWarningLimit=15e6;let wrkIdx,wrkVal,wrkArr=[],wrkArr2=[];let lastDateTime;let uiCnvsFract=.75,uiSmplLstFract=.5,uiIsovLstFract=.175,uiFullWidth=-1;let sbAllPanes,sbMsgPane,sbInfoPane,sbAccessPane;let sbSmplFilPane,sbStatFilPane,sbModePane;const imgArea=$("ImageArea"),cnvs=$("CanvasArea"),ctx=cnvs.getContext("2d");const cnvsContainer=$("CanvasContainer"),currStatList=$("CurrStatList");const currSmplList=$("CurrSmplList"),currIsoVarList=$("CurrIsoVarList");const currSmplTitleBar=$("CurrSmplListTitleBar");const currIsovTitleBar=$("CurrIsoVarListTitleBar");const gridContainer=$("GridContainer");const poupBckgrd=$("PopupBckgrd");const controlBlock=$("ControlBlock");window.addEventListener("load",onPageLoad);let menuOptionHtmls=new Map,menuOptionDescriptions=new Map;let menuOptionsByKeyName=new Map;menuOptionsByKeyName.set("ArrowDown","miNextSample");menuOptionsByKeyName.set("ArrowRight","miNextStation");menuOptionsByKeyName.set("ArrowUp","miPrevSample");menuOptionsByKeyName.set("ArrowLeft","miPrevStation");const WaitingState=0,ReadyState=1,PopupState=6,PointGetterState=7,GObjDraggingState=8;const ZoomingState=10,QuickZoomingState=11,ZZoomingHorState=12,ZZoomingVerState=13;const MoveVBarState=20,MoveHBarSmplState=21,MoveHBarIsovState=22;const DefineSectionState1=30,DefineSectionState2=31;let appState=new AppState;let cnvsState=WaitingState,zoomDraggingState=false,waitingForCmd="";let isAnonymousUser=userId==undefined?true:userId.startsWith("IP_");let isSingleSession=true;let onFinishPointGetterFunction,onFinishZoomFunction,onHideDlgFunction=noOp;let appVersion,sysInfo={},disableExports=false;let collExtension,collFormat,accessMode,dataField,dataType,collDescription;let stationCount,metaVarCount,mandatoryMetaVarCount;let dataVarCount,primaryVarId,dataCountsByVar;let metaVarNames,metaVarUNames,metaVarUnits,metaVarUUnits,metaVarComments;let metaVarTypes,metaVarValTypes,metaVarValBytes,metaVarDecimals;let metaVarErrVarIds,metaVarExtendedIds,metaVarQfSetIds;let dataVarNames,dataVarUNames,dataVarUnits,dataVarUUnits,dataVarComments;let dataVarTypes,dataVarValTypes,dataVarValBytes,dataVarDecimals;let dataVarErrVarIds,dataVarQfSetIds;let cruiseNames,keyVarIds,keyVarDataVarIds,goodCovPrms={},qfSets=new Map;let usageAgreementText,usageAgreementIntervalDays;let drvdVarIds,drvdVarNames,drvdVarUNames,drvdVarUnits,drvdVarUUnits;let dockMetaVarLabels,dockDataVarLabels,dockIsoVarLabels;let dockMetaVarIds,dockDataVarIds,dockDataVarLabelClickableFlags,dockIsoVarIds;let dockMetaValues,dockMetaValueOdvFlags,dockMetaValueClickableFlags;let dockDataValues,dockDataFlags,dockDataOdvFlags,dockDataValueClickableFlags;let dockDataInfoValues,dockDataInfoValueClickableFlags;let view,viewName,viewXmlStr,lastUndoViewXmlStr=null,lastUndoViewName;let viewFilesCount,viewFilesTree,secFilesCount,secFilesTree;let privViewFileNames,privSecFileNames;let drvdVarChoices,drvdVarGroups;let varCnvIds,varCnvLbls,varCnvFacs,varCnvOffs;let timeVarCnvIds,timeVarCnvLbls,metaTimeVarCnvIds,metaTimeVarCnvLbls;let dataVarTypeNames,metaVarTypeNames;let keyVarIdChoices,keyVarLblChoices;let paletteNames,paletteReds,paletteGreens,paletteBlues;let macroNames,privMacroNames;let availSmplCounts=[],availColl=[],availStatSet=[],availCruise=[],availStat=[];let currStatId,currValStatId,currStatAccNum,currSmplId,smplCount;let valStationCount,valDataCountsByVar,valTotalSampleCount;let dataCountsByWin;let currGObjIdx=-1;let currMiOption="";let currCnvsX=-1,currCnvsY=-1,currWinId=-2;let lclickGObjIdx=-1;let rclickCnvsX=-1,rclickCnvsY=-1,rclickOdvCnvsX=-1,rclickOdvCnvsY=-1;let rclickWinId=-1,rclickTblItem={},rclickGObjIdx=-1;let hlPolylines,hlPoints,hlDrawDataDots;let visibleDropdownMenus=[];let ptgWinId,ptgMinPtCount,ptgMaxPtCount,ptgCnvsX=[],ptgCnvsY=[];const zoomPixTol=10;let zoomCnvsLeftBegin,zoomCnvsRightBegin,zoomCnvsTopBegin,zoomCnvsBottomBegin;let zoomCnvsLeft,zoomCnvsRight,zoomCnvsTop,zoomCnvsBottom,zoomSpotId,zoomWinId;let beginCnvsX,beginCnvsY;let ctxLineWidth=1,ctxStrokeStyle="red",ctxFillStyle="red";let imgFmt="jpg",imgDpi=300;let imgOdvCnvsLeft=-1,imgOdvCnvsRight=-1,imgOdvCnvsTop=-1,imgOdvCnvsBottom=-1;let odvPixPerHtmlPix,odvPixPerCm;let odvCnvsRects,odvCnvsPolygons,colbarCnvsRects,dataWinCount;let zVarIdents,filterStatusStrings,isoVarFilterStatusString;let contourBlocks,autoContours,xDecimals,yDecimals;let isGeoMap,highlightStyles,gObjInfoArr;function closeSession(t){hideUserInterface();appState.clear();let e=window.opener;if(e!=null){window.open(e.href,e.name);window.close()}else if(returnUrl.length>0){window.open(returnUrl,"_self")}else{dlgMsgBox("<b>"+t+"</b><br><br>Your last view will be restored when you return.")}}function createContextMenus(){let t,e;t=createElem("ul","CanvasMenu","dropdown-menu");e=Html.menuItem("miRefreshCanvas","Refresh","Redraws the canvas.");e+=Html.menuItem("miSaveImageCanvas","Save Canvas As","Saves and retrieves the entire canvas as image file.");e+=Html.menuSep();e+=Html.menuItem("miFullRangeAll","Full Range All Windows","Sets the axis ranges of all data windows to full range.");e+=Html.menuSep();e+=Html.subMenu("WinPropsMenu","Window Properties");e+=Html.menuSep();e+=Html.subMenuStart("CwLayoutMenu","Layout",150);e+=Html.subMenuStart("LayoutTmpltMenu","Layout Templates",155);e+=Html.layoutTemplateMenu();e+=Html.subMenuEnd();e+=menuItem("miDwNewWin");e+=Html.menuSep();e+=Html.subMenu("GObjAddMenu"+abbrevW(-1),"Add Graphics Object");e+=Html.subMenuEnd();e+=Html.menuSep();e+=Html.menuItem("miUndo","Undo","Undo the last view change.","ctrl+z");e+=Html.menuSep();e+=Html.menuItem("miSaveViewAs","Save View As");e+=Html.menuItem("miLoadView","<b>Load View</b>");e+=Html.menuSep();e+=Html.menuItem("miCloseSession","<b>Close Session</b>");t.innerHTML=e;t.style.width="170px";t=createElem("ul","MapMenu","dropdown-menu");e=Html.menuItem("miSaveImageMap","Save Map As","Saves and retrieves the map as image file.");e+=Html.menuItem("miSaveAsInterruptedMap","Save As Interrupted Map","Saves and retrieves the map as interrupted map image file.");e+=Html.menuSep();e+=Html.menuItem("miFullDomain","Full Domain","Sets the map domain to the collection full domain.");e+=Html.menuItem("miGlobalMap","Global Map","Produces a global map.");e+=menuItem("miZoom");e+=menuItem("miAutoZoomIn");e+=menuItem("miAutoZoomOut");e+=Html.menuSep();e+=Html.subMenuStart("CurrStatMenu","Current Station by",150);e+=menuItem("miCurrStatById");e+=menuItem("miCurrStatByAccession");e+=menuItem("miCurrStatByName");e+=Html.subMenuEnd();e+=Html.menuSep();e+=Html.subMenuStart("PickedStatMenu","Manage Pick List",250);e+=Html.menuItem("miPickListAdd","Add Current Station to Pick List","Adds the current station to the list of picked stations.","+");e+=Html.menuItem("miPickListRemove","Remove Current Station from Pick List","Removes the current station from the list of picked stations.","-");e+=Html.menuItem("miPickListClear","Clear Pick List","Clears the list of picked stations.");e+=Html.subMenuEnd();e+=Html.subMenuStart("ManageSectionMenu","Manage Section");e+=Html.menuItem("miDefineSection","Define Section","Defines a new section along a user specified track.");e+=Html.menuItem("miLoadSection","Load Section","Loads a section from a file.");e+=Html.menuItem("miRemoveSection","Remove Section","Removes the current section.");e+=Html.menuItem("miSaveSectionAs","Save Section As","Saves the current section in a file.");e+=Html.menuSep();e+=Html.menuItem("miSectionProperties","<b>Section Properties</b>","Changes the section title, width and section coordinate (e.g., distance, longitude, latitude).");e+=Html.subMenuEnd();e+=Html.menuSep();e+=Html.subMenuStart("MwLayoutMenu","Layout",150);e+=Html.menuItem("miMoveResize","Move / Resize","Moves or resizes the map.");e+=Html.menuSep();e+=Html.subMenu("GObjAddMenu"+abbrevW(0),"Add Graphics Object");e+=Html.subMenuEnd();e+=Html.menuSep();e+=Html.menuItem("miStatisticsMw","Statistics","Shows mean, standard deviation, minimum, maximum and data histograms for the map.");e+=menuItem("miStatFilter");e+=Html.menuItem("miMapProperties","<b>Properties</b>","Changes properties of the map.");t.innerHTML=e;t=createElem("ul","DataWinMenu","dropdown-menu");e=Html.menuItem("miSaveImageDw","Save Plot As","Saves and retrieves the data window as image file.");e+=Html.menuItem("miSaveAsInterruptedMapDw","Save As Interrupted Map","Saves and retrieves the data window as interrupted map image file.");e+=Html.menuSep();e+=Html.menuItem("miFullRange","Full Range","Sets the axis ranges of the data window to full range.");e+=menuItem("miZoom");e+=Html.menuItem("miZZoom","Z-Zoom","Zooms into the color bar of the data window.");e+=menuItem("miAutoZoomIn");e+=menuItem("miAutoZoomOut");e+=Html.menuItem("miSetRanges","Set Ranges","Sets ranges of the X, Y, and Z axis of the data window.");e+=Html.menuSep();e+=Html.menuItem("miXVariable","X-Variable","Selects a new X variable for the data window.");e+=Html.menuItem("miYVariable","Y-Variable","Selects a new Y variable for the data window.");e+=Html.menuItem("miZVariable","Z-Variable","Selects a new Z variable for the data window.");e+=Html.menuSep();e+=Html.subMenuStart("ExtrasMenuDw","Extras",140);e+=Html.menuItem("mi2DEstimation","2D Estimation","Estimates Z-values at user-specified X-Y points using gridding parameters of the data window.");e+=Html.menuSep();e+=Html.menuItem("miIsopynals","Isopynals","Selects potential or neutral density isolines for the data window.");e+=Html.subMenuEnd();e+=Html.subMenuStart("DwLayoutMenu","Layout");e+=Html.menuItem("miDwMoveResize","Move / Resize Window","Moves or resizes the data window.");e+=Html.menuItem("miDwDelete","Delete Window","Deletes the data window.");e+=Html.menuSep();e+=menuItem("miDwNewWin");e+=Html.menuItem("miDwNewOverlay","Create Overlay Window","Creates a new overlay data window for the current window.");e+=Html.menuSep();e+=Html.menuItem("miDwMoveTop","Move to Foreground","Moves the data window to the foreground.");e+=Html.menuItem("miDwMoveBot","Move to Background","Moves the data window to the background.");e+=Html.menuSep();e+=Html.subMenu("GObjAddMenu"+abbrevW(1),"Add Graphics Object");e+=Html.subMenuEnd();e+=Html.menuSep();e+=Html.menuItem("miStatisticsDw","Statistics","Shows mean, standard deviation, standard error, minimum, maximum and data histograms for the data window.");e+=Html.subMenuStart("SmplFilterMenu","Sample Filter");e+=menuItem("miAcceptAllData");e+=menuItem("miRejectOutliers");e+=Html.menuSep();e+=menuItem("miSmplFilter");e+=Html.subMenuEnd();e+=Html.menuItem("miDwProperties","<b>Properties</b>","Changes properties of the data window.");t.innerHTML=e;t=createElem("ul","CurrStatTbMenu","dropdown-menu");t.style.width="150px";e=Html.subMenuStart("CurrStatMenu1","Current Station by",150);e+=menuItem("miCurrStatById");e+=menuItem("miCurrStatByAccession");e+=menuItem("miCurrStatByName");e+=Html.subMenuEnd();e+=Html.menuSep();e+=Html.menuItem("miBrowseHistory","Browse Station History","Shows the history records for this station.");t.innerHTML=e;t.style.width="160px";t=createElem("ul","CurrSmplTbMenu","dropdown-menu");e=Html.menuItem("miCurrSmplById","Current Sample by ID");t.innerHTML=e;t=createElem("ul","MetaVarMenu","dropdown-menu");e=menuItem("miStatFilter");e+=Html.menuSep();e+=Html.menuItem("miEditMetadata","Edit Metadata","Edits the metadata of the current station.");e+=Html.menuSep();e+=Html.menuItem("miCollectStrValsMv","Collect Unique Values","Constructs the alphabetically sorted unique value list for this meta variable and the current station set.");t.innerHTML=e;t=createElem("ul","SmplNameMenu","dropdown-menu");e=menuItem("miDrvdVars");e+=Html.menuSep();e+=Html.menuItem("miAvailabilityInfo","Availability Information","Shows data availability information for the entire collection, current station set, current cruise and current station.");e+=Html.menuSep();e+=Html.menuItem("miDisplayOrder","Display Order","Changes the order of data variables in the display list.");e+=Html.menuSep();e+=Html.menuItem("miCollectStrValsDv","Collect Unique Values","Constructs the alphabetically sorted unique value list for this data variable and the current station set.");t.innerHTML=e;t=createElem("ul","SmplValMenu","dropdown-menu");t.style.width="160px";e=Html.menuItem("miEditData","Edit Data","Edits the data values of the current variable.");e+=Html.menuItem("miEditSampleData","Edit Sample Data","Edits the data values of the current sample.");e+=Html.menuSep();e+=Html.subMenu("AssignQfMenu","Assign Quality Flag");t.innerHTML=e;t=createElem("ul","SmplInfoValMenu","dropdown-menu");t.style.width="120px";e=Html.menuItem("miEditInfoVal","Edit Info Value","Edits the data info value of the current variable.");t.innerHTML=e;t=createElem("ul","IsoVarMenu","dropdown-menu");e=Html.subMenuStart("SmplFilterMenu1","Sample Filter");e+=menuItem("miAcceptAllData");e+=menuItem("miRejectOutliers");e+=Html.menuSep();e+=menuItem("miSmplFilter");e+=Html.subMenuEnd();e+=menuItem("miIsoVars");t.innerHTML=e;t=createElem("ul","GObjActMenu","dropdown-menu");e=Html.menuItem("miGObjCopy","Copy Object");e+=Html.menuItem("miGObjDelete","Delete Object");e+=Html.menuSep();e+=Html.menuItem("miGObjMoveTop","Move to Foreground");e+=Html.menuItem("miGObjMoveUp","Move Up");e+=Html.menuItem("miGObjMoveDwn","Move Down");e+=Html.menuItem("miGObjMoveBot","Move to Background");e+=Html.menuSep();e+=Html.menuItem("miGObjDeleteAll","Delete All Objects");e+=Html.menuSep();e+=Html.menuItem("miGObjProps","<b>Properties</b>","Changes properties of the graphics object.");t.innerHTML=e;window.addEventListener("contextmenu",onRightClick)}function createDomElements(){const t="&#x02C2;",e="&#x02C3;",i="&#x02C4;",a="&#x02C5;";let s="SAVE";controlBlock.innerHTML='<p> <b>webODV Client</b> &emsp;&emsp; <button onClick="sendWebSocketMessage();"><b>Send</b></button> <button onClick="sendClientSessionRequest();"><b>Start Session</b></button> <button onClick="webSocketStop();">Disconnect</button> <button onClick="localStorage.clear();">Clear localStorage</button> &emsp;&emsp; <input type="checkbox" id="showMsgCb"> Show messages in console </p> <p> '+Html.txtInput("Identifier","","5%")+" "+Html.txtInput("Collection",s,"20%")+" "+Html.txtInput("InitialView","","10%")+" :: "+Html.txtInput("InputText","","60%")+" </p>";$("TitleBar").innerHTML='<div id="TbIconPane" class="TbPane"><img src="'+resourceRoot+'img/odv-icon.gif"></div> <div id="TbInfoPane" class="TbPane"></div> <div id="TbMenuPane" class="TbPane"></div>';$("CurrStatListTitleBar").innerHTML='<div id="CurrStatListTitleBarInfoPane" class="LbPane"></div> <div id="CurrStatListTitleBarBttn1Pane" class="LbPane"> <button class="is-dlgcolor" title="previous station" onClick="onCurrStatOrSmplByKeyCode(&quot;ArrowLeft&quot;);"><b>'+t+'</b></button> </div> <div id="CurrStatListTitleBarBttn2Pane" class="LbPane"> <button class="is-dlgcolor" title="next station" onClick="onCurrStatOrSmplByKeyCode(&quot;ArrowRight&quot;);"><b>'+e+"</b></button> </div>";currSmplTitleBar.innerHTML='<div id="CurrSmplListTitleBarInfoPane" class="LbPane"></div> <div id="CurrSmplListTitleBarBttn1Pane" class="LbPane"> <button class="is-dlgcolor" title="previous sample"" onClick="onCurrStatOrSmplByKeyCode(&quot;ArrowUp&quot;);"><b>'+i+'</b></button> </div> <div id="CurrSmplListTitleBarBttn2Pane" class="LbPane"> <button class="is-dlgcolor" title="next sample" onClick="onCurrStatOrSmplByKeyCode(&quot;ArrowDown&quot;);"><b>'+a+"</b></button> </div>";$("StatusBar").innerHTML='<div id="SbAllPanes"></div> <div id="SbMsgPane" class="SbPane has-panebckcolor"></div> <div id="SbInfoPane" class="SbPane has-panebckcolor"></div> <div id="SbAccessPane" class="SbPane has-panebckcolor"></div> <div id="SbSmplFilPane" class="SbPane has-panebckcolor"></div> <div id="SbStatFilPane" class="SbPane has-panebckcolor"></div> <div id="SbModePane" class="SbPane has-panebckcolor"></div>';sbAllPanes=$("SbAllPanes");sbMsgPane=$("SbMsgPane");sbInfoPane=$("SbInfoPane");sbAccessPane=$("SbAccessPane");sbSmplFilPane=$("SbSmplFilPane");sbStatFilPane=$("SbStatFilPane");sbModePane=$("SbModePane");poupBckgrd.innerHTML=Html.popupDlg(1)+Html.popupDlg(2)+Html.popupDlg(3);window.onmousedown=function(t){if(t.target==poupBckgrd){hideDlg(true)}}}function createMainMenus(){let t=accessMode=="RW",e,i="";e=createElem("ul","CollectionMenuDropdown","dropdown-menu");if(t){i+=Html.menuItem("miCollCopy","Copy","Creates a copy of the current collection.");i+=Html.menuItem("miCreateSnapshot","Create Snapshot","Copies the collection to ZIP package for backup or exchange.");i+=Html.menuItem("miCollRename","Rename","Renames the collection.");i+=Html.menuItem("miCollSortCondense","Sort and Condense","Sorts and condenses the collection.");i+=Html.menuSep();i+=Html.menuItem("miCollDeleteCurrStation","Delete Current Station","Deletes the current station from the collection.");i+=Html.menuItem("miCollDeleteStationSubset","Delete Station Subset","Deletes all stations shown in the map from the collection.");i+=Html.menuSep()}i+=Html.menuItem("miCollBrowseInfo","Browse Info File","Shows the collection info file.");i+=Html.subMenuStart("BrowseInvMenu","Browse Inventory &emsp;");i+=Html.menuItem("miCollInvByCruise","By Cruise","Retrieves the collection inventory by cruise.");i+=Html.menuItem("miCollInvByCruiseAndVar","By Cruise And Variable","Retrieves the collection inventory by cruise and variable.");i+=Html.subMenuEnd();i+=Html.menuItem("miCollBrowseLogfile","Browse Log File","Retrieves the collection log file.");i+=Html.menuSep();i+=Html.menuItem("miCreateOverviewPlots","Create Overview Plots","Creates overview plots showing all data in the collection.");if(t){i+=Html.menuSep();i+=Html.menuItem("miIdentifyKeyVariables","Identify Key Variables","Identifies and remembers key collection variables.");i+=Html.menuItem("miGoodCoverageCriteria","Good Coverage Criteria","Changes the good coverage criteria of the collection.");i+=Html.menuSep();i+=Html.subMenuStart("CollPropsMenu","Properties");i+=Html.menuItem("miCollPropsGeneral","General","Changes the properties of the collection.");i+=Html.menuItem("miCollPropsMetaVariables","Meta Variables","Changes the properties of meta variables.");i+=Html.menuItem("miCollPropsDataVariables","Data Variables","Changes the properties of data variables.");i+=Html.subMenuEnd()}e.innerHTML=i;e=createElem("ul","ViewMenuDropdown","dropdown-menu");i=Html.menuItem("miUndo","Undo","Undo the last view change.","ctrl+z");i+=Html.menuSep();i+=menuItem("miStatFilter");i+=Html.menuSep();i+=menuItem("miDrvdVars");i+=menuItem("miIsoVars");i+=Html.menuSep();i+=Html.subMenu("WinPropsMenuV","Window Properties");i+=Html.menuSep();i+=Html.subMenuStart("LayoutTmpltMenuV","Layout Templates",155);i+=Html.layoutTemplateMenu();i+=Html.subMenuEnd();i+=Html.menuSep();i+=Html.menuItem("miSaveViewAs","Save View As","Saves the current view settings to named file.");i+=Html.menuItem("miLoadView","<b>Load View</b>","Loads view settings from a file.");i+=Html.menuSep();i+=Html.menuItem("miCloseSession","<b>Close Session</b>","Closes the session.");e.innerHTML=i;e=createElem("ul","ExportMenuDropdown","dropdown-menu");i=Html.subMenuStart("ExportStationDataMenu","Station Data &emsp;");i+=Html.menuItem("miExpSpreadsheet","ODV Spreadsheet File","Exports the data of all stations shown in the map to an ODV spreadsheet file.");i+=Html.menuItem("miExpCollection","ODV Collection","Exports the data of all stations shown in the map to a new ODV collection.");i+=Html.menuItem("miExpNetCDF","NetCDF File","Exports the data of all stations shown in the map to a netCDF file.");i+=Html.subMenuEnd();i+=Html.menuItem("miExpHistory","Station History","Exports the history records of all stations shown in the map to a file.");i+=Html.menuSep();i+=Html.subMenu("WinDataExpMenu","Window Data");e.innerHTML=i;e=createElem("ul","HelpMenuDropdown","dropdown-menu");i=Html.menuItem("miHelpGettingStarted","Getting Started","Shows the ODV-online Getting Started document.");i+=Html.menuItem("miHelpHowToGuide","HowTo Guide","Shows the ODV-online HowTo document.");i+=Html.menuItem("miHelpOdvUserGuide","ODV User Guide","Shows the ODV Users Guide.");e.innerHTML=i}function createMultiMenuItems(){newMenuItem("miZoom","Zoom","Zooms into the map or data window.");newMenuItem("miAutoZoomIn","Auto-Zoom In","Zooms into area at current mouse position.");newMenuItem("miAutoZoomOut","Auto-Zoom Out","Zooms out and automatically enlarges the X and Y ranges.");newMenuItem("miCurrStatById","Station ID","Selects a new current station by station ID.","#");newMenuItem("miCurrStatByAccession","Accession Number","Selects a new current station by accession number.");newMenuItem("miCurrStatByName","Name","Selects a new current station by cruise label, station label and station type.");newMenuItem("miStatFilter","Station Filter","Changes the station filter settings.");newMenuItem("miDrvdVars","Derived Variables","Adds, deletes or edits derived variables.");newMenuItem("miIsoVars","Isosurface Variables &emsp;","Adds, deletes or edits isosurface variables.");newMenuItem("miDwNewWin","Create New Window","Creates a new data window.");newMenuItem("miAcceptAllData","Accept All Data","Relaxes the sample filter settings and accepts all data.");newMenuItem("miRejectOutliers","Reject Outliers","Applies sample filter settings that reject outlier data.");newMenuItem("miSmplFilter","Customize Settings","Changes sample filter settings.")}function dataVarAtFullLbl(t,e,i){return dataVarFullLabel(t)+" @ "+dataVarFullLabel(e)+" = "+i}function dataVarAtSpec(t){let e=dockDataVarIds.indexOf(primaryVarId);return dataVarAtFullLbl(t,primaryVarId,dockDataValues[e])}function dataVarDecimalCount(t,e=view.drvdVarArr){if(t<dataVarCount)return dataVarDecimals[t];else{let i=View.indexOfDrvdVar(t,e);if(i>-1)return e[i].digitsCount}return 2}function dataVarFullLabel(t,e=true,i=view.drvdVarArr){if(t<dataVarCount)return e?fullVarLabel(dataVarUNames[t],dataVarUUnits[t]):fullVarLabel(dataVarNames[t],dataVarUnits[t]);else{let a=View.indexOfDrvdVar(t,i);if(a>-1)return e?fullVarLabel(i[a].uname,i[a].uunits):fullVarLabel(i[a].name,i[a].units)}return""}function dataVarFullLabels(t=[],e=true){let i=[];if(e){dataVarUNames.map((t,e)=>i.push(e+1+": "+fullVarLabel(t,dataVarUUnits[e])));t.map(t=>{i.push("drvd: "+fullVarLabel(t.uname,t.uunits))})}else{dataVarUNames.map((t,e)=>i.push(fullVarLabel(t,dataVarUUnits[e])));t.map(t=>{i.push(fullVarLabel(t.uname,t.uunits))})}return i}function dataVarIds(t=[],e=0){let i=intArray(0+e,dataVarUNames.length);t.map(t=>{i.push(t.varId+e)});return i}function dataVarIdsFromAvail(t,e=0){let i=[];t.map((t,a)=>{if(t>0)i.push(a+e)});return i}function dataVarNameLabel(t,e=true,i=view.drvdVarArr){if(t<dataVarCount)return e?dataVarUNames[t]:dataVarNames[t];else{let a=View.indexOfDrvdVar(t,i);if(a>-1)return e?i[a].uname:i[a].name}return""}function dataVarUnitsLabel(t,e=true,i=view.drvdVarArr){if(t<dataVarCount)return e?dataVarUUnits[t]:dataVarUnits[t];else{let a=View.indexOfDrvdVar(t,i);if(a>-1)return e?i[a].uunits:i[a].units}return""}function defSectionAbort(t=DefineSectionState2){appState.leave(t);let e=sessionStorage.getItem(collectionName+"/origView");sendWsMsg(Msg.loadView(e,false))}function defSectionFinish(){appState.leave(DefineSectionState2);let t=sessionStorage.getItem(collectionName+"/origView");let e=t.indexOf("<Section")-1,i=t.indexOf("</Section>")+10;if(e==-2){e=t.indexOf("</MapWindow>")+12;i=e}let a=t.slice(0,e)+view.section.toXml()+t.slice(i);sendWsMsg(Msg.loadView(a))}function defSectionProps(t){if(!t){defSectionAbort(DefineSectionState1);return}appState.leave(DefineSectionState1);appState.enter(DefineSectionState2);DlgSection.show("Msg.createSection")}function defSectionStart(){sessionStorage.setItem(collectionName+"/origView",viewXmlStr);view.section=new Section;view.dataWinArr=[];let t=view.mapWin,e=Math.min((cmPageWidth-1)/t.xBbLen,(cmPageHeight-1)/t.yBbLen);t.xBbLen*=e;t.xBbOff=(cmPageWidth-t.xBbLen)*.5+.25;t.yBbLen*=e;t.yBbOff=(cmPageHeight-t.yBbLen)*.5+.25;appState.enter(DefineSectionState1);sendWsMsg(Msg.loadView(view.toXml(),false))}function drvdVarChoice(t){for(let e=0;e<drvdVarChoices.length;++e){if(drvdVarChoices[e].type==t)return drvdVarChoices[e]}}function enableMenu(t){let e=accessMode=="RW",i,a,s;switch(t){case"MapMenu":setElemEnabled("miSaveAsInterruptedMap",true);break;case"DataWinMenu":setElemEnabled("miSaveAsInterruptedMapDw",isGeoMap[rclickWinId]==1)?true:false;setElemEnabled("miZZoom",colbarCnvsRects[rclickWinId].left>-1);break;case"ExtrasMenuDw":let l=view.dataWinArr[rclickWinId-1],r=false;if(l.scope!=3){let t=keyVarIds.indexOf(4),e=t>-1?keyVarDataVarIds[t]:-1;let i=View.derivedVarType(l.xvId),a=View.derivedVarType(l.yvId);r=l.xvId==e&&(a==104||a==1)||i==101&&a==105}setElemEnabled("miIsopynals",r);setElemEnabled("mi2DEstimation",l.plotMode==2||l.plotMode==7);break;case"CollectionMenuDropdown":setElemEnabled("miCollCopy",e);setElemEnabled("miCreateSnapshot",e);setElemEnabled("miCollRename",e&&isSingleSession);setElemEnabled("miCollSortCondense",e&&isSingleSession);setElemEnabled("miCollDeleteCurrStation",e&&isSingleSession);setElemEnabled("miCollDeleteStationSubset",e&&isSingleSession);setElemEnabled("miIdentifyKeyVariables",e&&isSingleSession);setElemEnabled("miGoodCoverageCriteria",e&&isSingleSession);setElemEnabled("miCollPropsGeneral",e&&isSingleSession);setElemEnabled("miCollPropsMetaVariables",e&&isSingleSession);setElemEnabled("miCollPropsDataVariables",e&&isSingleSession);break;case"CurrStatTbMenu":setElemEnabled("miBrowseHistory",collFormat=="ODVCF6");break;case"MetaVarMenu":a=dockMetaVarIds[rclickTblItem.row];s=a>-1?metaVarValTypes[a]:"FLOAT";setElemEnabled("miEditMetadata",e);setElemEnabled("miCollectStrValsMv",s!="FLOAT"&&s!="DOUBLE");break;case"SmplNameMenu":a=dockDataVarIds[rclickTblItem.row];s=a<dataVarCount?dataVarValTypes[a]:"FLOAT";i=collFormat=="ODVGENERIC"||collFormat=="ODVCF5"||collFormat=="ODVCF6";setElemEnabled("miAvailabilityInfo",i);setElemEnabled("miCollectStrValsDv",s!="FLOAT"&&s!="DOUBLE");break;case"SmplValMenu":i=e&&dockDataVarIds[rclickTblItem.row]<dataVarCount;setElemEnabled("miEditData",i);setElemEnabled("miEditSampleData",e);break;case"SmplInfoValMenu":i=e&&collFormat=="ODVCF6"&&dockDataVarIds[rclickTblItem.row]<dataVarCount;setElemEnabled("miEditInfoVal",i);break;case"CurrStatMenu":case"CurrStatMenu1":setElemEnabled("miCurrStatByAccession",currStatAccNum!=missUINT);break;case"ManageSectionMenu":i=view.section.isValid();setElemEnabled("miRemoveSection",i);setElemEnabled("miSaveSectionAs",i);setElemEnabled("miSectionProperties",i);break;case"GObjActMenu":let n=gObjInfoArr[rclickGObjIdx],o=n.win_id,d=n.non_template_index;let m=view.gObjectSet(o),c=m.gObjArr,u=c.length;let p=n.automatic,g=n.type,h=GObject.isTemplate(g);setElemEnabled("miGObjCopy",!(g==15||g==30||h));setElemEnabled("miGObjDelete",!p);setElemEnabled("miGObjMoveTop",!p&&d>0);setElemEnabled("miGObjMoveUp",!p&&d>0);setElemEnabled("miGObjMoveDwn",!p&&d<u-1);setElemEnabled("miGObjMoveBot",!p&&d<u-1);setElemEnabled("miGObjProps",!p||h);break}}function finishPointGetterOrZoomState(t){if(appState.current()==PointGetterState)finishPointGetterState(t);else if(isZooming())finishZoomState(t)}function finishPointGetterState(t=false){restoreOldState();appState.leave(ReadyState);onFinishPointGetterFunction(ptgCnvsX.length>=ptgMinPtCount?t:false)}function finishZoomState(t){if(!isZooming())return;let e=appState.current();restoreOldState();if(!t)return;if(e==ZoomingState){let e=toOdvCanvasX(zoomCnvsLeft),i=toOdvCanvasX(zoomCnvsRight);let a=toOdvCanvasY(zoomCnvsTop),s=toOdvCanvasY(zoomCnvsBottom);if(onFinishZoomFunction==undefined){if(currMiOption=="miZoom"){let t=0;if(zoomCnvsLeft==zoomCnvsLeftBegin){e=missINT;++t}if(zoomCnvsRight==zoomCnvsRightBegin){i=missINT;++t}if(zoomCnvsTop==zoomCnvsTopBegin){a=missINT;++t}if(zoomCnvsBottom==zoomCnvsBottomBegin){s=missINT;++t}if(t<4)sendWsMsg(Msg.zoom(zoomWinId,e,a,i,s)+","+msgGetCanvasViewCurrInfo)}else if(currMiOption=="miMoveResize"||currMiOption=="miDwMoveResize")sendWsMsg(Msg.updateGeometry(zoomWinId,e,a,i,s)+","+msgGetCanvasViewCurrInfo)}else{if(currMiOption.startsWith("miGoEllipse"))ellipsePathFromRect(zoomCnvsLeft,zoomCnvsRight,zoomCnvsBottom,zoomCnvsTop,ptgCnvsX,ptgCnvsY);else rectPathFromRect(zoomCnvsLeft,zoomCnvsRight,zoomCnvsBottom,zoomCnvsTop,ptgCnvsX,ptgCnvsY);onFinishZoomFunction(t)}}else if(e==ZZoomingHorState){let t=view.dataWinArr[zoomWinId-1];let e=t.zBottom,i=colbarCnvsRects[zoomWinId].left;let a=(t.zTop-e)/(colbarCnvsRects[zoomWinId].right-i);let s=e+a*(toOdvCanvasX(zoomCnvsLeft)-i);let l=e+a*(toOdvCanvasX(zoomCnvsRight)-i);sendWsMsg(Msg.zZoom(zoomWinId,s,l)+","+msgGetCanvasViewCurrInfo)}else if(e==ZZoomingVerState){let t=view.dataWinArr[zoomWinId-1];let e=t.zBottom,i=colbarCnvsRects[zoomWinId].bottom;let a=(t.zTop-e)/(colbarCnvsRects[zoomWinId].top-i);let s=e+a*(toOdvCanvasX(zoomCnvsBottom)-i);let l=e+a*(toOdvCanvasX(zoomCnvsTop)-i);sendWsMsg(Msg.zZoom(zoomWinId,s,l)+","+msgGetCanvasViewCurrInfo)}}function gObjCopy(t){let e=gObjInfoArr[t];let i=view.gObjectSet(e.win_id),a=i.gObjArr,s=e.type;if(s==15||s==30||GObject.isTemplate(s))return;a.unshift(new GObject(a[e.non_template_index],true));sendUpdateGobjMsg(e.win_id,s,i)}function gObjCreate(t){if(!t)return;let e,i,a;switch(currMiOption){case"miGoAnnotationC":case"miGoAnnotationM":case"miGoAnnotationD":e=new GObject(1,ptgCnvsX,ptgCnvsY);break;case"miGoSymbolC":case"miGoSymbolM":case"miGoSymbolD":e=new GObject(5,ptgCnvsX,ptgCnvsY);break;case"miGoLineC":case"miGoLineM":case"miGoLineD":case"miGoPolylineC":case"miGoPolylineM":case"miGoPolylineD":e=new GObject(11,ptgCnvsX,ptgCnvsY);break;case"miGoPolygonC":case"miGoPolygonM":case"miGoPolygonD":e=new GObject(12,ptgCnvsX,ptgCnvsY);break;case"miGoEllipseC":case"miGoEllipseM":case"miGoEllipseD":case"miGoRectangleC":case"miGoRectangleM":case"miGoRectangleD":e=new GObject(12,ptgCnvsX,ptgCnvsY);break}view.gObjectSet(rclickWinId).gObjArr.unshift(e);DlgGObject.show(e,rclickWinId,false)}function gObjFromIndex(t){let e=gObjInfoArr[t],i=e.win_id,a=e.type,s;if(e.non_template_index>-1)s=view.gObjectSet(i).gObjArr[e.non_template_index];else if(a==40)s=view.legendGobj(i);else if(a==41)s=view.udotGobj(i);else if(a==42)s=view.uarrowGobj(i);return s}function gObjMoveTo(t){let e=gObjInfoArr[rclickGObjIdx],i=e.win_id,a=e.non_template_index;let s=view.gObjectSet(i),l=s.gObjArr,r=l.length,n=false;switch(t){case"miGObjMoveTop":if(a>0){moveElem(l,a,0);n=true}break;case"miGObjMoveUp":if(a>0){moveElem(l,a,a-1);n=true}break;case"miGObjMoveDwn":if(a<r-1){moveElem(l,a,a+1);n=true}break;case"miGObjMoveBot":if(a<r-1){moveElem(l,a,r-1);n=true}break;case"miGObjDelete":l.splice(a,1);n=true;break;case"miGObjDeleteAll":s=new GObjectSet;n=true;break}if(n)sendUpdateGobjMsg(i,e.type,s)}function hideMenus(t=-1){while(visibleDropdownMenus.length>t+1){$(visibleDropdownMenus.pop()).style.display="none"}updateSbInfoPane("")}function hideUserInterface(){hideDlg(true);hideMenus();gridContainer.style.display="none"}function isControlBlockId(t){return t=="Identifier"||t=="Collection"||t=="InputText"}function isClickable(t){let e=false,i=t.tbl,a=t.row,s=t.col;if(i=="D1"&&s==1)e=dockMetaValueClickableFlags[a]==1?true:false;else if(i=="D2"&&s==0)e=dockDataVarLabelClickableFlags[a]==1?true:false;else if(i=="D2"&&s==1)e=dockDataValueClickableFlags[a]==1?true:false;else if(i=="D2"&&s==3)e=dockDataInfoValueClickableFlags[a]==1?true:false;return e}function isZooming(){let t=appState.current();return t==ZoomingState||t==ZZoomingHorState||t==ZZoomingVerState}function layoutApply(t){hideDlg();setViewName(t.substring(2));sendWsMsg(Msg.loadView("$"+viewName+"$",false,true))}function layoutSampleCountCheck(t,e){if(e*valTotalSampleCount>smplCountWarningLimit)dlgYesNoBox("Confirm Layout Change","Drawing the selected layout may take long.<p>Really want to use the layout?</p>","layoutApply('"+t+"')");else layoutApply(t)}function localStorageKeys(t,e){let i=Object.keys(localStorage),a=t.length;if(a>0){i=i.filter(e=>e.startsWith(t));if(e)i.map((t,e)=>i[e]=t.slice(a))}return i}function menuItem(t){return menuOptionHtmls.get(t)}function newMenuItem(t,e,i,a){menuOptionHtmls.set(t,Html.menuItem(t,e,i,a))}function objectsAtCurrPos(){if(appState.current()==WaitingState)return;let t=[],e="",i="";currWinId=-2;if(currCnvsX>-1&&currCnvsY>-1){let a=toOdvCanvasX(currCnvsX),s=toOdvCanvasY(currCnvsY);t=windowIdsAt(a,s);e=gObjectsAt(a,s);currWinId=t[t.length-1];if(currWinId==0||currWinId>0&&dataCountsByWin[currWinId-1]>0){let t=toUsrX(a,currWinId),e=toUsrY(s,currWinId);if(t!=missDOUBLE&&e!=missDOUBLE){let a=isGeoMap[currWinId]?0:currWinId;let s=xDecimals[a],l=yDecimals[a];if(isGeoMap[currWinId]){let a=t<0?"&deg;W":"&deg;E";let r=e<0?"&deg;S":"&deg;N";i=":&emsp;"+Math.abs(t).toFixed(s)+a+" / "+Math.abs(e).toFixed(l)+r}else i=":&emsp;"+t.toFixed(s)+" / "+e.toFixed(l)}}}if(appState.current()!=ReadyState)return;let a=windowNameFromIds(t);if(i.length>0)a+=i;if(e.length>0)a+=" - Object: "+e;updateSbInfoPane(a);a=currWinId>0?filterStatusStrings[currWinId]:"";sbSmplFilPane.innerHTML="<div>"+a+"</div>"}function onAssignQf(){let t=selectedStr("qfList","");hideDlg();let e=dlgOrigVals.get("winId");let i="current_sample",a=dockDataVarIds[rclickTblItem.row]+1,s=false;switch(dlgOrigVals.get("assignQfMode")){case"miAssignQfAllStat":i="collection";s=true;break;case"miAssignQfCurrStat":i="current_station";s=true;break;case"miAssignQfValStat":i="valid_stations";s=true;break;case"miAssignQfWin":i="window_"+e;s=true;break}if(s)dlgYesNoBox("Change Quality Flags","Really want to change many quality flags?","onAssignQfYn("+a+",'"+i+"',"+t+","+s+")");else onAssignQfC(a,i,t,s)}function onAssignQfC(t,e,i,a){let s='{"cmd":"assign_quality_flag_value","var_id":'+t+',"context":"'+e+'","new_value":"'+i+'"}';if(a)s+=","+msgGetCanvas;sendWsMsg(s+","+msgGetDockDataVarVals+","+msgGetCurrInfo)}function onAssignQfYn(t,e,i,a){hideDlg();onAssignQfC(t,e,i,a)}function onClick(t){if(!t.target)return;if(isControlBlockId(t.target.id)){t.target.focus();return}t.preventDefault();if(visibleDropdownMenus.length>0){hideMenus();return}if(t.target.id=="CanvasArea"){let e=t.offsetX,i=t.offsetY,a,s;switch(appState.current()){case ReadyState:let l=toOdvCanvasX(e),r=toOdvCanvasY(i),n=windowIdAt(l,r);if(t.shiftKey){if(n>-1)sendWsMsg('{"cmd":"canvas_shift_left_click_event","x":'+l+',"y":'+r+"}")}else{if(n>-1&&t.detail==1)sendWsMsg('{"cmd":"canvas_left_click_event","x":'+l+',"y":'+r+"},"+msgGetDockVals);else if(n==0&&t.detail==2)processMenuOption("miPickListAdd")}break;case PointGetterState:if(t.detail==1){ptgCnvsX.push(e);ptgCnvsY.push(i)}if(ptgCnvsX.length==ptgMaxPtCount||t.detail>1)finishPointGetterState(true);break;case GObjDraggingState:appState.leave(GObjDraggingState);restorePenAndBrushStyles();clearCanvas(ctx);a=toOdvCanvasX(currCnvsX)-toOdvCanvasX(beginCnvsX);s=toOdvCanvasY(currCnvsY)-toOdvCanvasY(beginCnvsY);if(Math.abs(a)<3&&Math.abs(s)<3)return;let o=gObjInfoArr[lclickGObjIdx];sendWsMsg('{"cmd":"execute_option","option":"move_graphics_object","win_id":'+o.win_id+',"index":'+o.index+',"del_x":'+a+',"del_y":'+s+"},"+msgGetCanvasViewCurrInfo);break;case QuickZoomingState:appState.leave(QuickZoomingState);restorePenAndBrushStyles();clearCanvas(ctx);let d=toOdvCanvasX(beginCnvsX),m=toOdvCanvasX(currCnvsX);let c=toOdvCanvasY(beginCnvsY),u=toOdvCanvasY(currCnvsY);if(d==m||c==u)return;sendWsMsg(Msg.zoom(zoomWinId,Math.min(d,m),Math.min(c,u),Math.max(d,m),Math.max(c,u))+","+msgGetCanvasViewCurrInfo);break;case ZoomingState:case ZZoomingHorState:case ZZoomingVerState:zoomDraggingState=false;if(t.detail>1)finishZoomState(true);break}}else if(t.target.nodeName=="TD"){let e=tableItem(t.target.id);if(isClickable(e)){if(e.val.startsWith("http"))window.open(e.val,"ODV-online_ancillary");else sendWsMsg('{"cmd":"dock_left_click_event","dock_id":"'+e.tbl+'","row":'+e.row+',"column":'+e.col+"}")}}}function onCopyColl(){let t=$("queryStr").value;hideDlg();if(t!=collectionName)sendWsMsg('{"cmd":"copy_collection","new_name":"'+t+'"}')}function onCurrStatByAccNum(){let t=parseInt($("queryStr").value);hideDlg();sendWsMsg(Msg.selectSampleByAccessionNumber(t,currSmplId)+","+msgGetCurrInfo)}function onCurrSmplById(){let t=parseInt($("queryStr").value);hideDlg();sendWsMsg(Msg.selectSampleByValidStationId(currValStatId,t)+","+msgGetCurrInfo)}function onCurrStatById(){let t=parseInt($("queryStr").value);hideDlg();sendWsMsg(Msg.selectSampleByStationId(t,currSmplId)+","+msgGetCurrInfo)}function onCurrStatOrSmplByKeyCode(t){let e=currValStatId,i=currSmplId,a=false;switch(t){case"ArrowLeft":{e-=1;if(e<=0)e=valStationCount;a=true}break;case"ArrowRight":{e+=1;if(e>valStationCount)e=1;a=true}break;case"ArrowUp":{i-=1;if(i<=0)i=smplCount;a=true}break;case"ArrowDown":{i+=1;if(i>smplCount)i=1;a=true}break}if(a)sendWsMsg(Msg.selectSampleByValidStationId(e,i)+","+msgGetCurrInfo)}function onDeleteCurrStat(){hideDlg();sendWsMsg('{"cmd":"execute_option","option":"delete_stations","mode":1},'+msgGetCanvasViewCurrInfo)}function onDeleteStatSubset(){hideDlg();sendWsMsg('{"cmd":"execute_option","option":"delete_stations","mode":2},'+msgGetCanvasViewCurrInfo)}function onExportFileName(){let t=$("queryStr").value;hideDlg();DlgExportData.show(currMiOption,t)}function onImageReady(){let t=cnvsContainer.clientWidth,e=cnvsContainer.clientHeight;if(e>0&&imgOdvCnvsTop!=-1){let i=imgOdvCnvsRight-imgOdvCnvsLeft;let a=imgOdvCnvsBottom-imgOdvCnvsTop;let s=i/t,l=a/e;odvPixPerHtmlPix=Math.max(s,l);odvPixPerCm=Math.min(i/cmPageWidth,a/cmPageHeight);t=i/odvPixPerHtmlPix;e=a/odvPixPerHtmlPix;imgArea.style.width=imgArea.width=t;imgArea.style.height=imgArea.height=e;cnvs.style.width=cnvs.width=t;cnvs.style.height=cnvs.height=e;drawHighlighting(ctx)}}function onKeyUp(t){t.preventDefault();if(appState.current()==WaitingState||isControlBlockId(t.srcElement.id))return;if(visibleDropdownMenus.length>0){hideMenus();return}switch(appState.current()){case ReadyState:{let e=t.ctrlKey?"ctrl+":"";e+=t.key;if(menuOptionsByKeyName.has(e))processMenuOption(menuOptionsByKeyName.get(e))}break;case PopupState:{switch(t.code){case"Enter":let e=$("DlgFooter"+dlgPopupCount).querySelector("button");e.click();break;case"Escape":$("DlgCloseBtn"+dlgPopupCount).click();break}}break;case PointGetterState:case ZoomingState:case ZZoomingHorState:case ZZoomingVerState:{switch(t.code){case"Enter":finishPointGetterOrZoomState(true);break;case"Escape":finishPointGetterOrZoomState(false);break}}break}}function onLoadFile2DEst(t){let e=t.target.result.split("\n");let i,a=e.length,s,l,r,n=[],o=[];for(i=0;i<a;++i){s=e[i].split("\t");if(s.length<2)continue;l=parseFloat(s[0]);r=parseFloat(s[1]);if(isNaN(l)||isNaN(r))continue;n.push(l);o.push(r)}sendWsMsg(Msg.get2DEstimates(rclickWinId,n,o))}function onMouseDown(t){if(!t.target||t.button!=0)return;t.preventDefault();if(t.target.id=="CanvasArea"){if(appState.current()==ReadyState){if(t.ctrlKey){appState.enter(QuickZoomingState);beginCnvsX=t.offsetX;beginCnvsY=t.offsetY;zoomWinId=windowIdAt(toOdvCanvasX(beginCnvsX),toOdvCanvasY(beginCnvsY));rememberPenAndBrushStyles();ctx.strokeStyle="red";ctx.lineWidth=1}else if(t.button==0&&currGObjIdx>-1&&gObjInfoArr[currGObjIdx].dragging==1){appState.enter(GObjDraggingState);beginCnvsX=t.offsetX;beginCnvsY=t.offsetY;lclickGObjIdx=currGObjIdx}}else if(isZooming()){if(zoomSpotId==-1){currCnvsX=t.offsetX;currCnvsY=t.offsetY;updateZoomSpot()}if(zoomSpotId!=-1){beginCnvsX=currCnvsX;beginCnvsY=currCnvsY;zoomDraggingState=true}}}if(appState.current()==ReadyState){wrkArr=[];wrkArr.push(uiSmplLstFract);wrkArr.push(uiIsovLstFract);wrkArr.push(currSmplTitleBar.offsetTop);wrkArr.push(currIsovTitleBar.offsetTop);wrkArr.push(3*currSmplList.offsetHeight);if(Math.abs(t.pageX-currSmplList.offsetLeft)<3){appState.enter(MoveVBarState);lastDateTime=Date.now()}else if(t.pageX>currSmplList.offsetLeft&&Math.abs(t.pageY-currSmplTitleBar.offsetTop)<3){appState.enter(MoveHBarSmplState);lastDateTime=Date.now()}else if(t.pageX>currSmplList.offsetLeft&&Math.abs(t.pageY-currIsovTitleBar.offsetTop)<3){appState.enter(MoveHBarIsovState);lastDateTime=Date.now()}}}function onMouseEnterCurrIsoVarList(t){sbSmplFilPane.innerHTML="<div>"+isoVarFilterStatusString+"</div>"}function onMouseEnterMenuItem(t){let e=event.target,i=e.parentNode;if(i!=null)hideMenus(visibleDropdownMenus.indexOf(i.id));let a="";if(e.classList.contains("submenu-root"))showSubMenu(t);else if(menuOptionDescriptions.has(t))a=menuOptionDescriptions.get(t);updateSbInfoPane(a,false)}function onMouseLeaveCanvas(t){if(visibleDropdownMenus.length>0)return;currCnvsX=-1;currCnvsY=-1;objectsAtCurrPos()}function onMouseLeaveCurrIsoVarList(t){sbSmplFilPane.innerHTML="<div></div>"}function onMouseMove(t){t.preventDefault();if(!t.target)return;let e=appState.current();if(e==ReadyState){if(Math.abs(t.pageX-currSmplList.offsetLeft)<3)document.body.style.cursor="col-resize";else if(t.pageX>currSmplList.offsetLeft&&(Math.abs(t.pageY-currSmplTitleBar.offsetTop)<3||Math.abs(t.pageY-currIsovTitleBar.offsetTop)<3))document.body.style.cursor="row-resize";else document.body.style.cursor="default"}if(t.target.id=="CanvasArea"){currCnvsX=t.offsetX;currCnvsY=t.offsetY;objectsAtCurrPos();if(e==PointGetterState){drawPointGetterPoly(ctx)}else if(e==QuickZoomingState)drawQuickZoomRect(ctx);else if(e==GObjDraggingState)drawCurrGObjPolygon(ctx,currCnvsX-beginCnvsX,currCnvsY-beginCnvsY);else if(isZooming()&&!zoomDraggingState)updateZoomSpot();else if(zoomDraggingState){let t=currCnvsX-beginCnvsX,i=currCnvsY-beginCnvsY;beginCnvsX=currCnvsX;beginCnvsY=currCnvsY;switch(zoomSpotId){case 1:zoomCnvsLeft+=t;zoomCnvsBottom+=i;break;case 2:zoomCnvsRight+=t;zoomCnvsTop+=i;break;case 3:zoomCnvsRight+=t;zoomCnvsBottom+=i;break;case 4:zoomCnvsLeft+=t;zoomCnvsTop+=i;break;case 5:zoomCnvsTop+=i;break;case 6:zoomCnvsLeft+=t;break;case 7:zoomCnvsBottom+=i;break;case 8:zoomCnvsRight+=t;break;case 9:if(e!=ZZoomingVerState){zoomCnvsLeft+=t;zoomCnvsRight+=t}if(e!=ZZoomingHorState){zoomCnvsBottom+=i;zoomCnvsTop+=i}break}drawZoomRect(ctx)}}else{currCnvsX=-1;currCnvsY=-1;objectsAtCurrPos()}const i=100;if(e==MoveVBarState){if(Date.now()-lastDateTime>i){let e=t.pageX-cnvsContainer.offsetLeft;uiCnvsFract=Math.max(.5,Math.min(.9,e/uiFullWidth));updateGridLayout();lastDateTime=Date.now()}}else if(e==MoveHBarSmplState){if(Date.now()-lastDateTime>i){uiSmplLstFract=wrkArr[0]+(wrkArr[2]-t.pageY)/wrkArr[4];uiSmplLstFract=Math.max(.25,Math.min(.8,uiSmplLstFract));updateGridLayout();lastDateTime=Date.now()}}else if(e==MoveHBarIsovState){if(Date.now()-lastDateTime>i){uiSmplLstFract=wrkArr[0]-(wrkArr[3]-t.pageY)/wrkArr[4];uiSmplLstFract=Math.max(.25,Math.min(.8,uiSmplLstFract));uiIsovLstFract=wrkArr[0]+wrkArr[1]-uiSmplLstFract;updateGridLayout();lastDateTime=Date.now()}}}function onMouseUp(t){switch(appState.current()){case MoveVBarState:case MoveHBarSmplState:case MoveHBarIsovState:appState.leave();break}}function onPageLoad(){const t=new Map([["Chrome",57],["Firefox",52],["Safari",11],["Edge",80],["Opera",44]]);sysInfo=systemInfo();if(!t.has(sysInfo.browserName)||t.get(sysInfo.browserName)>sysInfo.browserVersion){gridContainer.style.display="none";dlgMsgBox("<b>Unsupported Browser</b><br><br>Please use a recent version of Chrome, Firefox, Safari, or Edge.");return}createDomElements();setEventListeners();updateGridLayout();if(isLocalHost)controlBlock.style.display="inline";webSocketStartup()}function onRightClick(t){const e=t.target;if(!e)return;hideMenus();t.preventDefault();if(e.id=="CanvasArea"){if(appState.current()==ReadyState){rclickCnvsX=t.offsetX;rclickCnvsY=t.offsetY;rclickOdvCnvsX=toOdvCanvasX(rclickCnvsX);rclickOdvCnvsY=toOdvCanvasY(rclickCnvsY);rclickWinId=windowIdAt(rclickOdvCnvsX,rclickOdvCnvsY);rclickGObjIdx=currGObjIdx;let e;if(rclickGObjIdx>-1)e="GObjActMenu";else if(rclickWinId==-1)e="CanvasMenu";else if(rclickWinId==0)e="MapMenu";else if(rclickWinId>0)e="DataWinMenu";else return;showMenu(e,t.pageX,t.pageY)}else if(appState.current()==PointGetterState){ptgCnvsX.pop();ptgCnvsY.pop();drawPointGetterPoly(ctx)}else if(isZooming()){restoreOldState()}}else if(e.id=="CurrStatLbl"){rclickWinId=-10;showMenu("CurrStatTbMenu",t.pageX,t.pageY)}else if(e.id=="CurrSmplLbl"){rclickWinId=-10;showMenu("CurrSmplTbMenu",t.pageX,t.pageY)}else if(e.nodeName=="TD"){rclickWinId=-10;rclickTblItem=tableItem(e.id);let i,a=rclickTblItem.tbl;if(a=="D1")i="MetaVarMenu";else if(a=="D2"){if(rclickTblItem.col==0)i="SmplNameMenu";else if(rclickTblItem.col==3)i="SmplInfoValMenu";else i="SmplValMenu"}else if(a=="D3")i="IsoVarMenu";showMenu(i,t.pageX,t.pageY)}}function onRenameColl(){let t=$("queryStr").value;hideDlg();if(t!=collectionName)sendWsMsg('{"cmd":"rename_collection","new_name":"'+t+'"},'+msgGetCollInfo)}function onSaveSection(){let t=$("queryStr").value;hideDlg();sendWsMsg(Msg.managePrivateRsrc("section",t,"save"));view.section.name=t;localStorage.setItem(collectionName+"/sections/"+t,view.section.toXml())}function onSaveView(){setViewName($("queryStr").value);hideDlg();sendWsMsg(Msg.managePrivateRsrc("view",viewName,"save"));localStorage.setItem(collectionName+"/views/"+viewName,viewXmlStr);updateSbModePane()}function onSelectFile2DEst(t){hideDlg();if(t.target.files.length==0)return;let e=new FileReader;e.addEventListener("load",onLoadFile2DEst);e.readAsText(t.target.files[0])}function onUsageAgree(){onHideDlgFunction=noOp;localStorage.setItem(collectionName+"/LastAgreeMilliSecs",Date.now());showUserInterface()}function paletteIndex(t){let e=paletteNames.indexOf(t);if(e==-1)e=paletteNames.indexOf("Odv");return e}function processMenuOption(t){hideMenus();let e=$(t);if(e!=null&&e.classList.contains("disabled"))return;let i=t.split(":"),a,s,l,r,n,o,d;currMiOption=i[0];switch(currMiOption){case"miAcceptAllData":sendWsMsg('{"cmd":"execute_option","option":"set_sample_filter","win_id":'+rclickWinId+',"type":"all_samples"}'+","+msgGetCanvasViewCurrInfo);break;case"miAssignQfAllStat":case"miAssignQfCurrSmpl":case"miAssignQfCurrStat":case"miAssignQfValStat":case"miAssignQfWin":d=rclickTblItem.row;dlgOrigVals.set("assignQfMode",i[0]);dlgOrigVals.set("winId",i[1]);dlgSelectQf(dockDataVarIds[d],dockDataFlags[d],true,"onAssignQf()");break;case"miAutoZoomIn":sendWsMsg(Msg.doAutoZoom("T")+","+msgGetCanvasViewCurrInfo);break;case"miAutoZoomOut":sendWsMsg(Msg.doAutoZoom("F")+","+msgGetCanvasViewCurrInfo);break;case"miAvailabilityInfo":sendWsMsg('{"cmd":"get_data_availability_information"}');break;case"miBrowseHistory":sendWsMsg('{"cmd":"get_current_station_history"}');break;case"miCloseSession":sendWsMsg(msgGetViewAsXml);sendWsMsg('{"cmd":"logout_request"}');break;case"miCollBrowseInfo":sendWsMsg('{"cmd":"get_info_file"}');break;case"miCollBrowseLogfile":sendWsMsg('{"cmd":"get_log_file"}');break;case"miCollDelete":break;case"miCollDeleteCurrStation":dlgYesNoBox("Confirm Station Delete","Really want to delete current station?","onDeleteCurrStat()");break;case"miCollDeleteStationSubset":dlgYesNoBox("Confirm Station Delete","Really want to delete "+valStationCount+" stations?","onDeleteStatSubset()");break;case"miCollectStrValsDv":case"miCollectStrValsMv":let e=rclickTblItem.tbl=="D1";d=rclickTblItem.row;o=e?dockMetaVarIds[d]:dockDataVarIds[d];sendWsMsg('{"cmd":"get_unique_strings","var_id":'+o+',"is_metavar":'+e+"}");break;case"miCollCopy":dlgQueryStr("Copy Collection","Enter new collection name","copy_of_"+collectionName,"onCopyColl()","Copy");break;case"miCollInvByCruise":sendWsMsg('{"cmd":"get_inventory_by_cruise"}');break;case"miCollInvByCruiseAndVar":sendWsMsg('{"cmd":"get_inventory_by_cruise_and_variable"}');break;case"miCollPropsDataVariables":DlgVarList.show(true);break;case"miCollPropsGeneral":DlgCollPropsGeneral.show();break;case"miCollPropsMetaVariables":DlgVarList.show(false);break;case"miCollRename":dlgQueryStr("Rename Collection","Enter new collection name","renamed_"+collectionName,"onRenameColl()","Rename");break;case"miCollSortCondense":sendWsMsg('{"cmd":"sort_condense_collection"}');break;case"miCreateOverviewPlots":sendWsMsg('{"cmd":"create_overview_plots"}');break;case"miCreateSnapshot":sendWsMsg('{"cmd":"create_collection_snapshot"}');break;case"miCurrSmplById":dlgQueryStr("Select Sample by ID","Sample ID:",currSmplId,"onCurrSmplById()","Select");break;case"miCurrStatById":dlgQueryStr("Select Station by ID","Station ID:",currStatId,"onCurrStatById()","Select");break;case"miCurrStatByAccession":dlgQueryStr("Select Station by Accession Number","Accession Number:",currStatAccNum,"onCurrStatByAccNum()","Select");break;case"miCurrStatByName":DlgCurrStatByName.show();break;case"miDataExpWindow 0":case"miDataExpWindow 1":case"miDataExpWindow 2":case"miDataExpWindow 3":case"miDataExpWindow 4":case"miDataExpWindow 5":case"miDataExpWindow 6":case"miDataExpWindow 7":case"miDataExpWindow 8":case"miDataExpWindow 9":case"miDataExpWindow 10":case"miDataExpWindow 11":case"miDataExpWindow 12":case"miDataExpWindow 13":case"miDataExpWindow 14":case"miDataExpWindow 15":case"miDataExpWindow 16":case"miDataExpWindow 17":case"miDataExpWindow 18":case"miDataExpWindow 19":case"miDataExpWindow 20":let s=currMiOption.split(" ");rclickWinId=parseInt(s[1]);if(rclickWinId<=view.dataWinArr.length)DlgWinDataExp.show(rclickWinId,isGeoMap[rclickWinId]);break;case"miDefineSection":defSectionStart();break;case"miDisplayOrder":DlgDispOrder.show();break;case"miDrvdVars":DlgDrvdVars.show();break;case"miDwProperties":DlgDataWin.show(rclickWinId,isGeoMap[rclickWinId]);break;case"miEditData":o=dockDataVarIds[rclickTblItem.row]+1;sendWsMsg('{"cmd":"get_current_station_data","var_id":'+o+"}");break;case"miEditInfoVal":o=dockDataVarIds[rclickTblItem.row];dlgQueryStr("Enter new info value","Info "+dataVarAtSpec(o),dockDataInfoValues[rclickTblItem.row],"changeInfoValue()");break;case"miEditMetadata":sendWsMsg('{"cmd":"get_current_station_metadata"}');break;case"miEditSampleData":sendWsMsg('{"cmd":"get_current_sample_data"}');break;case"miExpHistory":DlgExportHist.show();break;case"miExpSpreadsheet":case"miExpCollection":case"miExpNetCDF":dlgQueryStr("Export Data","Specify export file name","data_from_"+collectionName,"onExportFileName()");break;case"miFullDomain":sendWsMsg(Msg.setMapDomain(missDOUBLE,largeDOUBLE,missDOUBLE,largeDOUBLE)+","+msgGetCanvasViewCurrInfo);break;case"miFullRange":{r=Msg.setDwXYZRangesSync(rclickWinId,true,missDOUBLE,largeDOUBLE,missDOUBLE,largeDOUBLE,missDOUBLE,largeDOUBLE);sendWsMsg(r+","+msgGetCanvasViewCurrInfo)}break;case"miFullRangeAll":{r="";for(a=1;a<=dataWinCount;++a)r+=Msg.setDwFullAxisRanges(a);sendWsMsg(Msg.modifyView(r)+","+msgGetCanvasViewCurrInfo)}break;case"miGlobalMap":sendWsMsg(Msg.setMapDomain(-180,180,-90,90)+","+msgGetCanvasViewCurrInfo);break;case"miGObjCopy":gObjCopy(rclickGObjIdx);break;case"miGObjMoveTop":case"miGObjMoveUp":case"miGObjMoveDwn":case"miGObjMoveBot":case"miGObjDelete":case"miGObjDeleteAll":gObjMoveTo(i[0]);break;case"miGObjProps":DlgGObject.show(gObjFromIndex(rclickGObjIdx),gObjInfoArr[rclickGObjIdx].win_id);break;case"miGoAnnotationC":case"miGoAnnotationM":case"miGoAnnotationD":case"miGoSymbolC":case"miGoSymbolM":case"miGoSymbolD":startPointGetterState(gObjCreate,1,1);break;case"miGoLineC":case"miGoLineM":case"miGoLineD":startPointGetterState(gObjCreate,2,2);break;case"miGoPolygonC":case"miGoPolygonM":case"miGoPolygonD":case"miGoPolylineC":case"miGoPolylineM":case"miGoPolylineD":startPointGetterState(gObjCreate,2,1500);break;case"miGoEllipseC":case"miGoEllipseM":case"miGoEllipseD":case"miGoRectangleC":case"miGoRectangleM":case"miGoRectangleD":startZoomState(scaledCnvsRect(rclickWinId,.15),ZoomingState,gObjCreate);zoomCnvsLeftBegin-=1;break;case"miGoodCoverageCriteria":DlgCoverage.show();break;case"miHelpGettingStarted":window.open("https://explore.webodv.awi.de/docs/odv-online-getting-started.pdf","ODV-online-help");break;case"miHelpHowToGuide":window.open("https://explore.webodv.awi.de/docs/odv-online-howto.pdf","ODV-online-help");break;case"miHelpOdvUserGuide":window.open("https://odv.awi.de/fileadmin/user_upload/odv/misc/odvGuide.pdf","ODV-online-help");break;case"miIdentifyKeyVariables":DlgIdentKeyVars.show();break;case"miIsopynals":DlgIsopynals.show();break;case"miIsoVars":DlgIsoVars.show();break;case"miLoadSection":DlgSelectSection.show();break;case"miLoadView":DlgSelectView.show();break;case"miMapProperties":case"miWindow 0":DlgMapWin.show();break;case"miNextSample":onCurrStatOrSmplByKeyCode("ArrowDown");break;case"miNextStation":onCurrStatOrSmplByKeyCode("ArrowRight");break;case"miPickListAdd":view.pickedStatArr.push(new PickedStat(currStatId));sendWsMsg(Msg.setPickedStats()+","+msgGetCanvasViewCurrInfo);break;case"miPickListRemove":{a=indexOf(view.pickedStatArr,"statId",currStatId);if(a>-1)view.pickedStatArr.splice(a,1);sendWsMsg(Msg.setPickedStats()+","+msgGetCanvasViewCurrInfo)}break;case"miPickListClear":view.pickedStatArr=[];sendWsMsg(Msg.setPickedStats()+","+msgGetCanvasViewCurrInfo);break;case"miPrevSample":onCurrStatOrSmplByKeyCode("ArrowUp");break;case"miPrevStation":onCurrStatOrSmplByKeyCode("ArrowLeft");break;case"miRefreshCanvas":sendWsMsg(msgGetCanvas);break;case"miRejectOutliers":sendWsMsg('{"cmd":"execute_option","option":"set_sample_filter","win_id":'+rclickWinId+',"type":"no_outliers"}'+","+msgGetCanvasViewCurrInfo);break;case"miRemoveSection":if(view.section.isValid())sendWsMsg(msgRemoveSection+","+msgGetDockDataVarLbls+","+msgGetCanvasViewCurrInfo);break;case"miSaveAsInterruptedMap":case"miSaveAsInterruptedMapDw":sendWsMsg(Msg.exportAsInterruptedMap(rclickWinId,imgFmt,imgDpi,false,"","","",1,true,true));break;case"miSaveImageCanvas":case"miSaveImageMap":case"miSaveImageDw":sendWsMsg(Msg.exportGraphics(rclickWinId,imgFmt,imgDpi,false,true));break;case"miSaveSectionAs":if(view.section.isValid())dlgQueryStr("Save Section","Enter section name",view.section.name,"onSaveSection()","Save");break;case"miSaveViewAs":dlgQueryStr("Save View","Enter view name",viewName,"onSaveView()","Save");break;case"miSectionProperties":DlgSection.show("Msg.setSectionProps");break;case"miSetRanges":DlgAxisRanges.show(rclickWinId);break;case"miSmplFilter":DlgSmplFilter.show(rclickWinId);break;case"miStatFilter":DlgStatFilter.show();break;case"miStatisticsDw":sendWsMsg('{"cmd":"get_statistics_summary","window_id":'+rclickWinId+"}");break;case"miStatisticsMw":sendWsMsg('{"cmd":"get_statistics_summary","window_id":0}');break;case"miUndo":{if(lastUndoViewXmlStr!=null){setViewName(lastUndoViewName);sendWsMsg(Msg.loadView(lastUndoViewXmlStr));l=collectionName+"/lastViewXmlStr";lastUndoViewXmlStr=localStorage.getItem(l);localStorage.removeItem(l);l=collectionName+"/lastViewName";lastUndoViewName=localStorage.getItem(l);localStorage.removeItem(l)}}break;case"miWindow 1":case"miWindow 2":case"miWindow 3":case"miWindow 4":case"miWindow 5":case"miWindow 6":case"miWindow 7":case"miWindow 8":case"miWindow 9":case"miWindow 10":case"miWindow 11":case"miWindow 12":case"miWindow 13":case"miWindow 14":case"miWindow 15":case"miWindow 16":case"miWindow 17":case"miWindow 18":case"miWindow 19":case"miWindow 20":let m=currMiOption.split(" ");rclickWinId=parseInt(m[1]);if(rclickWinId<=view.dataWinArr.length)DlgDataWin.show(rclickWinId,isGeoMap[rclickWinId]);break;case"miXVariable":if(rclickWinId!=-1)DlgAxisVar.show(rclickWinId,"X");break;case"miYVariable":if(rclickWinId!=-1)DlgAxisVar.show(rclickWinId,"Y");break;case"miZVariable":if(rclickWinId!=-1)DlgAxisVar.show(rclickWinId,"Z");break;case"miZoom":case"miDwMoveResize":case"miMoveResize":{zoomWinId=rclickWinId;startZoomState(odvCnvsRects[zoomWinId],ZoomingState)}break;case"mi2DEstimation":showDlg("Select File",'<label for="fileSelector" id="fileSelectorLabel">Select File with X/Y Coordinates</label><p><input type="file" id="fileSelector"/></p>',"");$("fileSelector").addEventListener("change",onSelectFile2DEst);break;case"miDwDelete":{view.dataWinArr=strippedArray(view.dataWinArr,[rclickWinId-1]);sendWsMsg(Msg.loadView(view.toXml()))}break;case"miDwNewWin":case"miDwNewOverlay":{let t=currMiOption=="miDwNewOverlay";let e=rclickWinId>0?view.dataWinArr[rclickWinId-1]:null;let i=new DataWindow(e);i.plotMode=0;if(t){i.bckColor=missINT;i.winType=1}else{i.xBbOff+=1;i.yBbOff+=1;i.nonLinAutoAdjust="F";i.nonLinStart=-.1;i.nonLinEnd=.1}view.dataWinArr.push(i);rclickWinId=view.dataWinArr.length;if(t&&i.scope!=0)DlgAxisVar.show(rclickWinId,"Z",true);else sendWsMsg(Msg.loadView(view.toXml()))}break;case"miDwMoveTop":{moveElem(view.dataWinArr,rclickWinId-1,view.dataWinArr.length-1);sendWsMsg(Msg.loadView(view.toXml()))}break;case"miDwMoveBot":{moveElem(view.dataWinArr,rclickWinId-1,0);sendWsMsg(Msg.loadView(view.toXml()))}break;case"miZZoom":{zoomWinId=rclickWinId;n=view.dataWinArr[zoomWinId-1].colBarAlign;if(n==0)return;startZoomState(colbarCnvsRects[zoomWinId],n==2?ZZoomingHorState:ZZoomingVerState)}break;case"miFullScreenMap":case"miOnePickWin":case"miTwoPickWin":case"miSixPickWin":case"miOneSectionWin":case"miTwoSectionWin":case"miThreeSectionWin":case"miFiveSectionWin":case"miSixSectionWin":case"miOneIsoSurfaceWin":case"miTwoIsoSurfaceWin":case"miThreeIsoSurfaceWin":case"miFiveIsoSurfaceWin":layoutApply(t);break;case"miOneScatterWin":case"miFiveMixedWin":layoutSampleCountCheck(t,1);break;case"miTwoScatterWin":layoutSampleCountCheck(t,2);break;case"miSixScatterWin":layoutSampleCountCheck(t,6);break;default:consoleMsg("MenuOption "+t+" selected",true)}}function processWebSocketBlobMessage(t){let e=t.slice(0,256),i,a;let s=new FileReader;s.onload=function(e){if(i===undefined){i=e.target.result;i=i.substring(0,i.indexOf("\0"));i=JSON.parse(i);a=t.slice(256,t.size,i.media_type);switch(i.msg_type){case"canvas_image":imgOdvCnvsLeft=i.rect.left;imgOdvCnvsRight=i.rect.right;imgOdvCnvsTop=i.rect.top;imgOdvCnvsBottom=i.rect.bottom;case"custom_image":s.readAsDataURL(a);break;case"file_contents":stopWaiting(i.reply_id);if(saveFileContentsCmds.indexOf(i.reply_id)>-1){hideDlg(true);saveBlobAs(a,i.file);if(i.reply_id=="create_overview_plots")sendWsMsg(msgGetCollInfo)}else if(i.reply_id=="dock_left_click_event"||i.reply_id=="get_info_file")openBlobAsPage(a,i.file,"ODV-online-ancillary");break}}else{switch(i.msg_type){case"canvas_image":imgArea.src=e.target.result;cnvsState=ReadyState;break;case"custom_image":DlgImage.show(a,i);$("CustomImageArea").src=e.target.result;break}}};s.readAsText(e)}function processWebSocketTextMessage(t){const e=JSON.parse(t);stopWaiting(e.reply_id);if(e.success==false){stopWaiting();dlgMsgBox(e.reply_id+": "+e.msg,"Server reply");return}let i;switch(e.reply_id){case"compile_postfix_expression":dlgMsgBox(e.msg);break;case"convert_infix_to_postfix":$("PfExpr").value=e.postfix_expression;break;case"copy_collection":dlgMsgBox("Collection copied to: <b>"+e.file+"</b>");break;case"create_collection_snapshot":dlgMsgBox("File written: <b>"+e.file+"</b>");break;case"get_canvas_window":case"get_canvas_rect":if(appState.current()==WaitingState)appState.enter(ReadyState);break;case"login_request":userId=e.user;isAnonymousUser=e.is_anonymous_user;if(e.station_count==undefined)break;case"execute_option":case"load_view":case"modify_view":stationCount=e.station_count;valStationCount=e.selected_station_count;valDataCountsByVar=e.data_counts_by_var;dataCountsByWin=e.data_counts_by_win;valTotalSampleCount=e.sample_count;drvdVarNames=e.drvdvar_names;drvdVarUNames=e.drvdvar_unames;drvdVarUnits=e.drvdvar_units;drvdVarUUnits=e.drvdvar_uunits;drvdVarIds=e.drvdvar_ids;zVarIdents=e.zvar_identifiers;odvCnvsRects=e.rects;odvCnvsPolygons=e.polygons;colbarCnvsRects=e.colorbar_rects;filterStatusStrings=e.filter_status_strings;isoVarFilterStatusString=e.isosurface_var_filter_status_string;xDecimals=e.x_decimal_counts;yDecimals=e.y_decimal_counts;contourBlocks=e.contour_blocks;autoContours=e.auto_contours;dataWinCount=odvCnvsRects.length-1;gObjInfoArr=e.gobject_info;isGeoMap=e.is_geographic_map;highlightStyles=e.highlight_styles;updateSbModePane();sbStatFilPane.innerHTML="<div>"+filterStatusStrings[0]+"</div>";break;case"canvas_left_click_event":case"get_current_information":case"select_current_sample":currStatId=e.station_id;currValStatId=e.valid_station_id;currStatAccNum=e.accession_number;currSmplId=e.sample_id;smplCount=e.sample_count;hlPolylines=e.polylines;hlPoints=e.points;hlDrawDataDots=e.draw_data_dots;drawHighlighting(ctx);if(appState.current()==DefineSectionState1)startPointGetterState(defSectionProps);else if(appState.current()==DefineSectionState2)defSectionFinish();break;case"canvas_shift_left_click_event":if(e.clicked_win_id==0)DlgMultiStation.show(e.nearest_points_count,e.station_ids,e.sample_counts,e.cruise_names,e.station_specs,e.dates,e.positions,e.primary_var_ranges);else DlgMultiSample.show(e.nearest_points_count,e.station_ids,e.sample_ids,e.sample_specs,e.cruise_names,e.station_specs,e.dates,e.positions,e.x_values,e.y_values,e.z_values);break;case"dock_left_click_event":if(e.urls!=undefined&&e.urls.length>0){if(e.urls.length==1)window.open(e.urls[0],"ODV-online_ancillary");else dlgSelectItem("Select an Item",e.urls,"onSelectUrl()")}break;case"export_data":case"export_history":case"export_window_data":showAlert('<p style="line-height:150%;"><b>Data export started...</b><br>&emsp;<br>This may take a while.<br>Do not close this browser window until you have received the export zip file.<br>&emsp;<br><b>Please wait...</b></p>',"black");break;case"get_collection_information":collectionName=e.name;collExtension=e.extension;collFormat=e.format;stationCount=e.station_count;accessMode=e.access_mode;metaVarCount=e.metavar_count;mandatoryMetaVarCount=e.mandatory_metavar_count;dataVarCount=e.datavar_count;primaryVarId=e.primary_var_id;dataField=e.data_field;dataType=e.data_type;collDescription=e.description;usageAgreementText=e.usage_agreement_text;usageAgreementIntervalDays=e.usage_agreement_interval_days;metaVarNames=e.metavar_names;metaVarUNames=e.metavar_unames;metaVarUnits=e.metavar_units;metaVarUUnits=e.metavar_uunits;metaVarComments=e.metavar_comments;metaVarQfSetIds=e.metavar_qfschema_ids;metaVarTypes=e.metavar_types;metaVarValTypes=e.metavar_value_types;metaVarDecimals=e.metavar_decimals;metaVarValBytes=e.metavar_value_bytes;metaVarErrVarIds=e.metavar_error_var_ids;metaVarExtendedIds=e.extended_metavar_ids;keyVarIds=e.keyvar_ids;keyVarDataVarIds=e.keyvar_datavar_ids;goodCovPrms=e.coverage_checker;dataVarNames=e.datavar_names;dataVarUNames=e.datavar_unames;dataVarUnits=e.datavar_units;dataVarUUnits=e.datavar_uunits;dataVarComments=e.datavar_comments;dataVarQfSetIds=e.datavar_qfschema_ids;dataVarTypes=e.datavar_types;dataVarValTypes=e.datavar_value_types;dataVarDecimals=e.datavar_decimals;dataVarValBytes=e.datavar_value_bytes;dataVarErrVarIds=e.datavar_error_var_ids;dataCountsByVar=e.datavar_data_counts;cruiseNames=e.cruise_names;viewFilesCount=e.view_files_count;viewFilesTree=e.view_files_tree;secFilesCount=e.sec_files_count;secFilesTree=e.sec_files_tree;privViewFileNames=e.private_view_names;privSecFileNames=e.private_section_names;privMacroNames=e.private_macro_names;qfSets=new Map;let t,i=e.qf_schemas.length,a={};for(t=0;t<i;++t){a=e.qf_schemas[t];qfSets.set(a.schema_id,a)}if(usageAgreementText.length>0&&usageAgreeRequired(usageAgreementIntervalDays)){gridContainer.style.display="none";onHideDlgFunction=function(){sendWsMsg('{"cmd":"logout_request"}')};showMsg(collectionName+" - Data Usage Agreement",usageAgreementText,Html.dlgBtn("onUsageAgree()","I Agree"))}else showUserInterface();break;case"get_current_sample_data":DlgEditSmplData.show(e.values,e.error_values,e.flags);break;case"get_current_sample_dock_data":dockDataValues=e.values;dockDataValueClickableFlags=e.values_clickable_flags;dockDataFlags=e.flags;dockDataOdvFlags=e.odv_flags;dockDataInfoValues=e.info_values;dockDataInfoValueClickableFlags=e.info_values_clickable_flags;updateCurrSmplList(currSmplId,smplCount);break;case"get_current_station_data":DlgEditData.show(e.var_id,e.primary_var_values,e.values,e.error_values,e.flags);break;case"get_current_station_dock_metadata":dockMetaValues=e.values;dockMetaValueOdvFlags=e.odv_flags;dockMetaValueClickableFlags=e.values_clickable_flags;updateCurrStatList(currStatId);break;case"get_current_station_dock_isosurface_data":updateCurrStatIsoVarList(e.values);break;case"get_current_station_metadata":DlgEditMetaData.show(e.var_ids,e.values,e.flags);break;case"get_current_station_history":dlgMultiLineMsgBox("Current Station History",e.history_records,800,160);break;case"get_current_view_as_xml":viewXmlStr=e.view_as_xml;let s=new DOMParser;view=new View(s.parseFromString(viewXmlStr,"text/xml"));let l=localStorage.getItem(collectionName+"/lastViewXmlStr");let r=localStorage.getItem(collectionName+"/lastViewName");if(l!=null&&r!=null){lastUndoViewXmlStr=l;lastUndoViewName=r}localStorage.setItem(collectionName+"/lastViewXmlStr",viewXmlStr);localStorage.setItem(collectionName+"/lastViewName",viewName);break;case"get_data_availability_information":availSmplCounts=e.sample_counts;availColl=e.collection;availStatSet=e.station_set;availCruise=e.cruise;availStat=e.station;dlgAvailability(e.collection,e.station_set,e.cruise,e.station);break;case"get_derivedvar_choices":drvdVarChoices=e.drvdVarChoices;drvdVarGroups=e.drvdVarGroups;varCnvIds=e.varCnvIds;varCnvLbls=e.varCnvLabels;varCnvFacs=e.varCnvFacs;varCnvOffs=e.varCnvOffs;timeVarCnvIds=e.timeVarCnvIds;timeVarCnvLbls=e.timeVarCnvLabels;metaTimeVarCnvIds=e.metaTimeVarCnvIds;metaTimeVarCnvLbls=e.metaTimeVarCnvLabels;break;case"get_dock_datavar_labels":dockDataVarLabels=e.labels;dockDataVarLabelClickableFlags=e.labels_clickable_flags;dockDataVarIds=e.var_ids;break;case"get_dock_isosurfacevar_labels":dockIsoVarLabels=e.labels;dockIsoVarIds=e.var_ids;break;case"get_dock_metavar_labels":dockMetaVarLabels=e.labels;dockMetaVarIds=e.var_ids;break;case"get_macro":DlgDrvdVars.dv=Object.assign({},e.macro);DlgDrvdVars.dv.fPrms=[];DlgDrvdVars.dv.iPrms=[];DlgDrvdVars.dv.inpVarIds=[];DlgDrvdVars.dv.queryStrsInpVarLabels=[...e.queryStrsInpVarLabels];DlgDrvdVars.dv.comment=e.comment;DlgDrvdVars.identifyInpVar(0);break;case"get_setup_information":paletteNames=e.palette_names;paletteReds=e.palette_reds;paletteGreens=e.palette_greens;paletteBlues=e.palette_blues;disableExports=e.disable_exports;dataVarTypeNames=e.datavar_type_names;metaVarTypeNames=e.metavar_type_names;keyVarIdChoices=e.keyVarIdChoices;keyVarLblChoices=e.keyVarLblChoices;macroNames=e.macro_names;appVersion="ODV-online v14 | odvws "+e.odv_version+" / "+e.web_server_version;$("TbIconPane").setAttribute("title",appVersion);break;case"get_statistics_summary":if(e.window_id==0)DlgMwStats.show(e);else DlgDwStats.show(e);break;case"get_unique_strings":dlgUniqueStrings(e);break;case"import_data_incremental":stationCount=e.station_count;valStationCount=e.selected_station_count;if(e.imported_station_count>0){updateSbModePane();sendWsMsg(msgGetCanvas)}break;case"logout_request":closeSession("Thank you for using ODV-online.");break;case"manage_private_resource":privViewFileNames=e.private_view_names;privSecFileNames=e.private_section_names;privMacroNames=e.private_macro_names;break;case"notification":switch(e.notification_type){case"access_mode_change":setAccessMode(e.access_mode);break;case"session_count_change":isSingleSession=e.is_single_session;break;case"message":dlgMsgBox(e.msg);break;case"time_out_event":closeSession("ODV-online session closed because of inactivity.");break}break;case"sort_condense_collection":dlgMsgBox("Sort and Condense successful");break;break}}function restoreOldState(){sbAllPanes.innerText="";sbAllPanes.style.display="none";document.body.style.cursor="default";appState.leave();zoomDraggingState=false;zoomSpotId=-1;restorePenAndBrushStyles();drawHighlighting(ctx)}function saveSection(){let t=$("queryStr").value;hideDlg()}function sendClientSessionRequest(){if(isLocalHost){sessionId=$("Identifier").value;collectionName=$("Collection").value;initialView=$("InitialView").value}if(sessionId.length==0)return;if(sessionId.indexOf("already logged in")!==-1)dlgMsgBox(sessionId);else{let t=localStorage.getItem("lastOpenElems");if(t!=null)dlgLastOpenElems=new Map(JSON.parse(t));let e="$FullScreenMap$";viewName="FullScreenMap";if(initialView!=undefined&&initialView.length>0){e=initialView;setViewName(initialView)}if(collectionName.length>0){let t=localStorage.getItem(collectionName+"/lastViewXmlStr");let i=localStorage.getItem(collectionName+"/lastViewName");if(t!=null&&i!=null){e=t;setViewName(i)}}sendWsMsg('{"cmd":"login_request","view":"'+e+'","view_name":"'+viewName+'"}');sendWsMsg('{"cmd":"get_setup_information"},'+msgGetDrvdVarChoices+","+msgGetDockLbls+","+msgGetCollInfo)}controlBlock.blur()}function sendUpdateGobjMsg(t,e,i){let a="";if(t==-1)a+="<Canvas>"+i.toXml()+" </Canvas>";else if(t==0){a+="<MapWindow background_color='"+view.mapWin.bckColor+"'> <Window>";a+=e==40?view.mapWin.legend.toXmlLegend():i.toXml();a+=" </Window> </MapWindow>"}else if(t>0){let s=view.dataWinArr[t-1];a+="<DataWindow window_id='"+t+"' background_color='"+s.bckColor+"' highlight_style='"+s.highlightStyle+"'> <Window>";if(e==40)a+=s.legend.toXmlLegend();else if(e==41)a+=s.udot.toXmlUDot();else if(e==42)a+=s.uarrow.toXmlUArrow();else a+=i.toXml();a+=" </Window> </DataWindow>"}sendWsMsg(Msg.modifyView(a)+","+msgGetCanvasViewCurrInfo)}function setAccessMode(t){if(t==undefined)return;accessMode=t;sbAccessPane.innerHTML='<div style="text-align: center">'+accessMode+"</div>"}function setEventListeners(){window.addEventListener("resize",updateGridLayout);window.addEventListener("keyup",onKeyUp);imgArea.addEventListener("load",onImageReady);window.addEventListener("mouseup",onMouseUp);cnvsContainer.addEventListener("click",onClick);currStatList.addEventListener("click",onClick);currSmplTitleBar.addEventListener("click",onClick);currSmplList.addEventListener("click",onClick);currIsovTitleBar.addEventListener("click",onClick);currIsoVarList.addEventListener("click",onClick);cnvsContainer.addEventListener("mousedown",onMouseDown);currStatList.addEventListener("mousedown",onMouseDown);currSmplTitleBar.addEventListener("mousedown",onMouseDown);currSmplList.addEventListener("mousedown",onMouseDown);currIsovTitleBar.addEventListener("mousedown",onMouseDown);currIsoVarList.addEventListener("mousedown",onMouseDown);cnvsContainer.addEventListener("mousemove",onMouseMove);currStatList.addEventListener("mousemove",onMouseMove);currSmplTitleBar.addEventListener("mousemove",onMouseMove);currSmplList.addEventListener("mousemove",onMouseMove);currIsovTitleBar.addEventListener("mousemove",onMouseMove);currIsoVarList.addEventListener("mousemove",onMouseMove);cnvsContainer.addEventListener("mouseleave",onMouseLeaveCanvas);currIsoVarList.addEventListener("mouseenter",onMouseEnterCurrIsoVarList);currIsoVarList.addEventListener("mouseleave",onMouseLeaveCurrIsoVarList)}function setMenuAssignQF(){const t=rclickTblItem.row,e=dockDataVarIds[t];const i="<i>"+dataVarNameLabel(e)+"</i>";const a="Assign quality flag value to ";let s=view.winIdsWithVar(e);let l=" ",r,n=s.length,o,d=[];o="miAssignQfCurrSmpl";d.push(o);l=Html.menuItem(o,"Current Sample",a+"current "+i+" value.");o="miAssignQfCurrStat";d.push(o);l+=Html.menuItem(o,"All Samples of Current Station",a+"all "+i+" values of current station.");for(r=0;r<n;++r){o="miAssignQfWin:"+s[r];d.push(o);l+=Html.menuItem(o,"All Samples in Window "+s[r],a+"all "+i+" values shown in data window "+s[r]+".")}o="miAssignQfValStat";d.push(o);l+=Html.menuItem(o,"All Samples of Valid Stations",a+"all "+i+" values of all stations shown in the map.");o="miAssignQfAllStat";d.push(o);l+=Html.menuItem(o,"All Samples in Collection",a+"all "+i+" values in the collection.");$("AssignQfMenu").innerHTML=l;n=d.length;let m=accessMode=="RW"&&e<dataVarCount;for(r=0;r<n;++r)setElemEnabled(d[r],m);return n}function setMenuGObjects(){let t=abbrevW(rclickWinId);let e=Html.menuItem("miGoAnnotation"+t,"Annotation","Adds a text annotation.");e+=Html.menuItem("miGoEllipse"+t,"Ellipse","Adds an ellipse or circle.");e+=Html.menuItem("miGoLine"+t,"Line","Adds a straight line.");e+=Html.menuItem("miGoPolygon"+t,"Polygon","Adds a filled polygon.");e+=Html.menuItem("miGoPolyline"+t,"Polyline","Adds a polyline.");e+=Html.menuItem("miGoRectangle"+t,"Rectangle","Adds a rectangle.");e+=Html.menuItem("miGoSymbol"+t,"Symbol","Adds a symbol.");$("GObjAddMenu"+t).innerHTML=e;return 7}function setMenuWinDataExp(){const t="Window ",e=20;const i="Exports the data of the selected window.";let a=0,s=Math.min(e,view.dataWinArr.length);let l=Html.menuItem("miDataExp"+t+a,"Map",i);for(a=1;a<=s;++a)l+=Html.menuItem("miDataExp"+t+a,t+a,i);$("WinDataExpMenu").innerHTML=l;return s+1}function setMenuWinProps(t){const e="Window ",i=20;const a="Changes properties of the selected window.";let s=0,l=Math.min(i,view.dataWinArr.length);let r=Html.menuItem("mi"+e+s,"Map",a);for(s=1;s<=l;++s)r+=Html.menuItem("mi"+e+s,e+s,a);$(t).innerHTML=r;return l+1}function showMainMenu(t){hideMenus();let e=t+"Dropdown";enableMenu(e);let i=$(t),a=$(e);a.style.display="block";let s=i.offsetLeft,l=i.offsetTop+i.offsetHeight-8;let r=l+a.clientHeight+30-window.innerHeight;if(r>0)l-=r;r=s+a.clientWidth+20-window.innerWidth;if(r>0)s-=r;a.style.left=s+"px";a.style.top=l+"px";visibleDropdownMenus.push(e)}function showMenu(t,e,i){enableMenu(t);let a=$(t);a.style.display="block";if(e==undefined){e=a.offsetLeft;i=a.offsetTop}i-=6;let s=i+a.clientHeight+30-window.innerHeight;if(s>0)i-=s;s=e+a.clientWidth+20-window.innerWidth;if(s>0)e-=s;a.style.left=e+"px";a.style.top=i+"px";visibleDropdownMenus.push(t)}function showSubMenu(t){if(visibleDropdownMenus.length==0||visibleDropdownMenus.indexOf(t)>-1)return;let e=-1;switch(t){case"AssignQfMenu":e=setMenuAssignQF();break;case"GObjAddMenuC":case"GObjAddMenuM":case"GObjAddMenuD":e=setMenuGObjects();break;case"WinDataExpMenu":e=setMenuWinDataExp();break;case"WinPropsMenu":case"WinPropsMenuV":e=setMenuWinProps(t);break}if(e==0)return;enableMenu(t);let i=$(t);i.style.display="block";let a=i.clientHeight,s=i.clientWidth,l=0;let r=i.offsetParent,n=$(visibleDropdownMenus[0]);if(n==null){let t="error"}l=n.offsetTop+n.offsetHeight+a+16-window.innerHeight;let o=l>0?-1*a+6:-20;if(l>0&&n.offsetTop-a<0)o/=2;l=r!=null?r.offsetLeft+r.offsetWidth+s+16-window.innerWidth:0;i.style.marginTop=o+"px";if(l>0){s+=i.offsetParent.offsetWidth-17;i.style.marginLeft="-"+s+"px"}visibleDropdownMenus.push(t)}function showUserInterface(){hideDlg(true);createMultiMenuItems();createContextMenus();createMainMenus();let t=$("TbInfoPane");t.innerText=collectionName;t.setAttribute("title",collDescription);let e=Html.mainMenuItem("Collection")+"&emsp;"+Html.mainMenuItem("View");if(!disableExports)e+="&emsp;"+Html.mainMenuItem("Export");e+="&emsp;"+Html.mainMenuItem("Help");$("TbMenuPane").innerHTML=e;setAccessMode(accessMode);let i=null;if(i==null){let t=Math.min(14,metaVarNames.length-8);let e=Math.min(40,dataVarNames.length),i=4;let a=1*(t+e+i);uiSmplLstFract=e/a;uiIsovLstFract=i/a}else{let t=i.split(";");uiCnvsFract=parseFloat(t[0]);uiSmplLstFract=parseFloat(t[1]);uiIsovLstFract=parseFloat(t[2])}updateGridLayout();gridContainer.style.display="grid";sendWsMsg(msgGetCanvasViewCurrInfo)}function startPointGetterState(t,e=2,i=1500){appState.enter(ReadyState);appState.enter(PointGetterState);ptgMinPtCount=e;ptgMaxPtCount=i;ptgCnvsX.length=0;ptgCnvsY.length=0;ptgWinId=rclickWinId;clearCanvas(ctx);document.body.style.cursor="crosshair";onFinishPointGetterFunction=t;let a="<div class='is-red'><b>Get Points.</b> left mouse click: add point; right mouse click: remove last point &emsp;&emsp;";a+="<button class='is-red' title='Applies the entered points' onClick='finishPointGetterState(true);'><b>Apply</b></button>&emsp;&emsp;<button class='is-red' title='Cancels the operation' onClick='finishPointGetterState(false);'><b>Cancel</b></button>";sbAllPanes.innerHTML=a+"</div>";sbAllPanes.style.display="block"}function startWaitingFor(t,e="<b>Processing...</b>"){if(waitingForCmd.length==0){document.body.classList.add("Waiting");waitingForCmd=t;showAlert(e)}}function startZoomState(t,e,i){if(t.left==-1)return;appState.enter(e);zoomCnvsLeft=zoomCnvsLeftBegin=toHtmlCanvasX(t.left);zoomCnvsRight=zoomCnvsRightBegin=toHtmlCanvasX(t.right);zoomCnvsTop=zoomCnvsTopBegin=toHtmlCanvasY(t.top);zoomCnvsBottom=zoomCnvsBottomBegin=toHtmlCanvasY(t.bottom);rememberPenAndBrushStyles();zoomSpotId=-1;drawZoomRect(ctx);objectsAtCurrPos();onFinishZoomFunction=i;sbAllPanes.innerHTML="<div class='is-red'><b>Zooming:</b>  click and hold left mouse button to drag zoom rectangle, corners or edges &emsp;&emsp;&emsp;<button class='is-red' title='Applies the current zoom rectangle' onClick='finishZoomState(true);'><b>Apply</b></button>&emsp;&emsp;<button class='is-red' title='Cancels the zoom operation' onClick='finishZoomState(false);'><b>Cancel</b></button></div>";sbAllPanes.style.display="block"}function stopWaiting(t){if(waitingForCmd.length>0&&(t==undefined||t===waitingForCmd)){document.body.classList.remove("Waiting");waitingForCmd="";hideDlg();setDisplay("DlgHeader1",true)}}function updateCurrSmplList(t,e){let i=$("CurrSmplListTitleBarInfoPane");i.innerHTML='<b><div id="CurrSmplLbl">Sample: '+Math.min(t,e)+" / "+e+"</div></b>";const a="is-blue has-pointercursor";let s,l,r='<table id="CurrSmplTbl" class="has-altbckcolor">';let n,o,d,m,c,u,p,g,h,f;for(s=0;s<dockDataFlags.length;s++){n=dockDataInfoValues[s].length>0?"&#x24D8;":"";o=colorClassFromOdvFlag(dockDataOdvFlags[s]);d=o;m=dockDataVarIds[s];if(dockDataValueClickableFlags[s]==1)d=a;u=dockDataValues[s];if(u.length==0)u="no data";h=dockDataFlags[s];f=-1;p=0;if(m<dataVarCount){p=dataVarQfSetIds[m];if(dataVarComments[m].length>0){let t=dataVarComments[m].split(" | ");c+="\n";for(l=0;l<t.length;++l)c+="\n"+t[l]}}if(qfSets.has(p)){g=qfSets.get(p);f=g.flags.indexOf(h)}c=dataVarFullLabel(m);if(m<dataVarCount&&dataVarComments[m].length>0)c+=" - "+dataVarComments[m];c+="\n\nValue:&emsp;"+u;if(f>-1)c+="\nQF:&emsp;"+g.flag_descriptions[f];if(dockDataInfoValues[s].length>0)c+="\nINFO:&emsp;"+dockDataInfoValues[s];r+="<tr>";r+='<td id="D2:'+s+':0" title="'+c+'"';if(dockDataVarLabelClickableFlags[s]==1)r+=' class="'+a+'"';r+=">"+dockDataVarLabels[s]+"</td>";r+='<td id="D2:'+s+':1" class="'+d+'">'+dockDataValues[s]+"</td>";r+='<td id="D2:'+s+':2" class="'+o+'">'+h+"</td>";r+='<td id="D2:'+s+':3"';if(dockDataInfoValueClickableFlags[s]==1)r+=' class="is-bold '+a+'"';r+=">"+n+"</td>";r+="</tr>"}let v=currSmplList.scrollTop;currSmplList.innerHTML=r+"</table>";currSmplList.scrollTop=v}function updateCurrStatIsoVarList(t){$("CurrIsoVarListTitleBarInfoPane").innerHTML="<b><div>Isosurface Values</div></b>";let e='<table id="IsovarTbl" class="has-altbckcolor">';for(let i=0;i<t.length;i++){e+='<tr title="'+dockIsoVarLabels[i]+": "+t[i]+'"><td id="D3:'+i+':0">'+dockIsoVarLabels[i]+'</td><td id="D3:'+i+':1">'+t[i]+"</td></tr>"}let i=currIsoVarList.scrollTop;currIsoVarList.innerHTML=e+"</table>";currIsoVarList.scrollTop=i}function updateCurrStatList(t){let e='<b><div id="CurrStatLbl">Station ID: '+t+"</div></b>",i;$("CurrStatListTitleBarInfoPane").innerHTML=e;const a="is-blue has-pointercursor";let s,l,r;e='<table id="CurrStatTbl" class="has-altbckcolor">';for(s=0;s<dockMetaValues.length;s++){l=colorClassFromOdvFlag(dockMetaValueOdvFlags[s]);r=l;if(dockMetaValueClickableFlags[s]==1)r=a;i=dockMetaVarLabels[s]+": "+dockMetaValues[s];e+='<tr><td id="D1:'+s+':0" title="'+i+'">'+dockMetaVarLabels[s]+'</td><td id="D1:'+s+':1" class="'+r+'">'+dockMetaValues[s]+"</td></tr>"}let n=currStatList.scrollTop;currStatList.innerHTML=e+"</table>";currStatList.scrollTop=n}function updateGridLayout(){let t=$("odvonline_iframe"),e=isLocalHost?75:0;if(t==null)t=document.documentElement;uiFullWidth=t.clientWidth-2*gridContainer.offsetLeft;let i=t.clientHeight-2*gridContainer.offsetTop-e-78;let a=uiCnvsFract*uiFullWidth;gridContainer.style.gridTemplateColumns="[cl0] "+a+"px [cl1] "+(uiFullWidth-a)+"px [cl2]";gridContainer.style.gridTemplateRows="[rl-1] "+e+"px [rl0] 26px [rl1] 26px [rl2] 1fr [rl3] 26px [rl4] "+uiSmplLstFract*i+"px [rl5] 26px [rl6] "+uiIsovLstFract*i+"px [rl7] 22px [rl8]";onImageReady()}function updateSbInfoPane(t,e=true){if(e){sbInfoPane.classList.remove("has-hovbckcolor");sbInfoPane.classList.add("has-panebckcolor");sbInfoPane.innerHTML='<div style="float: right">'+t+" &emsp;</div>"}else{sbInfoPane.classList.remove("has-panebckcolor");sbInfoPane.classList.add("has-hovbckcolor");sbInfoPane.innerHTML="<div>"+t+"</div>"}}function updateSbModePane(){sbModePane.innerHTML="<div>"+valStationCount+" / "+stationCount+": "+viewName+"</div>"}function usageAgreeRequired(t){let e=parseInt(localStorage.getItem(collectionName+"/LastAgreeMilliSecs"));if(isNaN(e))e=0;let i=Date.now(),a=(i-e)/864e5;return a>t}function webSocketStop(){imgArea.src="";appState.clear();if(websocket)websocket.close()}function windowNameFromId(t){if(t==-1)return"Canvas";else if(t==0)return"Map";else if(t>0)return"Window "+t;else return""}function windowNameFromIds(t){let e=t.length;if(e==1)return windowNameFromId(t[0]);else if(e>1)return"Window "+t[e-1]+" on "+t[e-2];else return""}function zMatchingWinId(t,e){return indexOf2(zVarIdents,"var_id",e,"var_group",View.varGroupId(t))}
